import{t as e}from"../index-7487ad29.js";import{T as l}from"./topoBar-8cfeab2a.js";import{g as a,p as o}from"./property.api-14e5b6df.js";import{_ as t}from"./plugin-vue_export-helper-3b0dab4c.js";import{B as s,g as n,c as i,v as u,w as m,C as d,u as p,d as r,f as v,x as g,D as c,a as b,i as V}from"./element-plus-89dd23ed.js";import{d as E,r as y,j as _,f as h,aa as f,o as A,c as N,X as R,U as T,a as U,Q as x,u as M,M as S,a4 as C}from"./@vue-bb747027.js";import"./vue-router-6370cc0f.js";import"./axios-ff411c8f.js";import"./mitt-106818fe.js";import"./lodash-es-7a4ab7c3.js";import"./@popperjs-66964824.js";import"./@vueuse-09ca9f25.js";import"./@element-plus-ccefd8d4.js";import"./async-validator-b6f94fc9.js";import"./@ctrl-d2fe7c9e.js";import"./normalize-wheel-es-233dc293.js";import"./oem-517c1d66.js";const I={class:"settings-page"},K={class:"settings-content"},B={class:"settings-header"},P={class:"section-title"},w={class:"section-title"},W={class:"section-desc"},k={class:"section-title"},j={class:"section-desc"},O={class:"settings-actions"},L={class:"section-title"},G={class:"section-title"},H={class:"section-desc"},D={class:"section-title"},X={class:"section-desc"},$={class:"settings-actions"},q={class:"rag-weight-slider"},J={class:"rag-weight-values"},Y={class:"settings-actions"};var F=t(E({__name:"index",setup(t){const E=y("llm"),F=y(!1),z=y(!1),Q=y({provider:"open-ai",useRag:!0,useTools:!0,temperature:0,ollamaModelName:"qwen3:14b-q8_0",ollamaBaseUrl:"http://172.16.8.107:11434",ollamaKeepAliveSeconds:3600,ollamaContextLength:32768,openAiModelName:"qwen-plus",openAiBaseUrl:"https://dashscope.aliyuncs.com",openAiCompletionsPath:"/compatible-mode/v1/chat/completions",openAiKey:"",openAiContextLength:32768}),Z=y({provider:"open-ai",ollamaModelName:"nomic-embed-text:latest",ollamaBaseUrl:"http://127.0.0.1:11434",ollamaKeepAliveSeconds:3600,openAiModelName:"text-embedding-v4",openAiBaseUrl:"https://dashscope.aliyuncs.com",openAiEmbeddingsPath:"/compatible-mode/v1/embeddings",openAiKey:""}),ee=y(""),le=y({topK:5,metricType:"COSINE",metricScoreExpr:"> 0.7",denseWeight:.5,sparseWeight:.5}),ae=(e,l=!1)=>null==e?l:"1"===e.trim()||"true"===e.trim().toLowerCase(),oe=(e,l)=>{if(null==e)return l;const a=Number(e);return Number.isFinite(a)?a:l},te=()=>{const e=le.value.denseWeight,l=le.value.sparseWeight,a=e+l;if(!Number.isFinite(a)||a<=0)return le.value.denseWeight=.5,void(le.value.sparseWeight=.5);le.value.denseWeight=e/a,le.value.sparseWeight=l/a},se=_({get:()=>Math.round(100*le.value.denseWeight),set:e=>{const l=Math.min(100,Math.max(0,e));le.value.denseWeight=l/100,le.value.sparseWeight=(100-l)/100}}),ne=l=>{const a=Math.min(100,Math.max(0,Math.round(l))),o=100-a;return`${e("settings.rag.weight.dense")}: ${a}% / ${e("settings.rag.weight.sparse")}: ${o}%`},ie=async()=>{z.value=!0;try{ee.value!==JSON.stringify(Z.value)&&await(async()=>{await V.confirm(e("settings.embedding.rebuild.confirm"),e("settings.embedding.rebuild.title"),{confirmButtonText:e("settings.embedding.rebuild.confirm.ok"),cancelButtonText:e("settings.embedding.rebuild.confirm.cancel"),type:"warning"})})(),await o((()=>{te();const e=e=>null==e?"":String(e);return[{propertyName:"llm-provider",propertyValue:e(Q.value.provider)},{propertyName:"llm-use-rag",propertyValue:e(Q.value.useRag)},{propertyName:"llm-use-tools",propertyValue:e(Q.value.useTools)},{propertyName:"llm-temperature",propertyValue:e(Q.value.temperature)},{propertyName:"llm-ollama-model-name",propertyValue:e(Q.value.ollamaModelName)},{propertyName:"llm-ollama-base-url",propertyValue:e(Q.value.ollamaBaseUrl)},{propertyName:"llm-ollama-keep-alive-seconds",propertyValue:e(Q.value.ollamaKeepAliveSeconds)},{propertyName:"llm-ollama-context-length",propertyValue:e(Q.value.ollamaContextLength)},{propertyName:"llm-open-ai-model-name",propertyValue:e(Q.value.openAiModelName)},{propertyName:"llm-open-ai-base-url",propertyValue:e(Q.value.openAiBaseUrl)},{propertyName:"llm-open-ai-completions-path",propertyValue:e(Q.value.openAiCompletionsPath)},{propertyName:"llm-open-ai-key",propertyValue:e(Q.value.openAiKey)},{propertyName:"llm-open-ai-context-length",propertyValue:e(Q.value.openAiContextLength)},{propertyName:"embedding-provider",propertyValue:e(Z.value.provider)},{propertyName:"embedding-ollama-model-name",propertyValue:e(Z.value.ollamaModelName)},{propertyName:"embedding-ollama-base-url",propertyValue:e(Z.value.ollamaBaseUrl)},{propertyName:"embedding-ollama-keep_alive_seconds",propertyValue:e(Z.value.ollamaKeepAliveSeconds)},{propertyName:"embedding-open-ai-model-name",propertyValue:e(Z.value.openAiModelName)},{propertyName:"embedding-open-ai-base-url",propertyValue:e(Z.value.openAiBaseUrl)},{propertyName:"embedding-open-ai-embeddings-path",propertyValue:e(Z.value.openAiEmbeddingsPath)},{propertyName:"embedding-open-ai-key",propertyValue:e(Z.value.openAiKey)},{propertyName:"RETRIEVE_TOP_K",propertyValue:e(le.value.topK)},{propertyName:"RETRIEVE_METRIC_TYPE",propertyValue:e(le.value.metricType)},{propertyName:"RETRIEVE_METRIC_SCORE_COMPARE_EXPR",propertyValue:e(le.value.metricScoreExpr)},{propertyName:"RETRIEVE_DENSE_WEIGHT",propertyValue:e(le.value.denseWeight)},{propertyName:"RETRIEVE_SPARSE_WEIGHT",propertyValue:e(le.value.sparseWeight)}]})()),ee.value=JSON.stringify(Z.value),b.success(e("settings.save.success"))}catch(l){"cancel"!==l&&b.error(e("settings.save.failed"))}finally{z.value=!1}};return h((()=>{(async()=>{F.value=!0;try{const e=["llm-provider","llm-use-rag","llm-use-tools","llm-temperature","llm-ollama-model-name","llm-ollama-base-url","llm-ollama-keep-alive-seconds","llm-ollama-context-length","llm-open-ai-model-name","llm-open-ai-base-url","llm-open-ai-completions-path","llm-open-ai-key","llm-open-ai-context-length","embedding-provider","embedding-ollama-model-name","embedding-ollama-base-url","embedding-ollama-keep_alive_seconds","embedding-open-ai-model-name","embedding-open-ai-base-url","embedding-open-ai-embeddings-path","embedding-open-ai-key","RETRIEVE_TOP_K","RETRIEVE_METRIC_TYPE","RETRIEVE_METRIC_SCORE_COMPARE_EXPR","RETRIEVE_DENSE_WEIGHT","RETRIEVE_SPARSE_WEIGHT"],o=(l=await a(e))?.data?.data?l.data.data:l?.data??{};Q.value.provider=o["llm-provider"]||Q.value.provider,Q.value.useRag=ae(o["llm-use-rag"],Q.value.useRag),Q.value.useTools=ae(o["llm-use-tools"],Q.value.useTools),Q.value.temperature=oe(o["llm-temperature"],Q.value.temperature),Q.value.ollamaModelName=o["llm-ollama-model-name"]||Q.value.ollamaModelName,Q.value.ollamaBaseUrl=o["llm-ollama-base-url"]||Q.value.ollamaBaseUrl,Q.value.ollamaKeepAliveSeconds=oe(o["llm-ollama-keep-alive-seconds"],Q.value.ollamaKeepAliveSeconds),Q.value.ollamaContextLength=oe(o["llm-ollama-context-length"],Q.value.ollamaContextLength),Q.value.openAiModelName=o["llm-open-ai-model-name"]||Q.value.openAiModelName,Q.value.openAiBaseUrl=o["llm-open-ai-base-url"]||Q.value.openAiBaseUrl,Q.value.openAiCompletionsPath=o["llm-open-ai-completions-path"]||Q.value.openAiCompletionsPath,Q.value.openAiKey=o["llm-open-ai-key"]||Q.value.openAiKey,Q.value.openAiContextLength=oe(o["llm-open-ai-context-length"],Q.value.openAiContextLength),Z.value.provider=o["embedding-provider"]||Z.value.provider,Z.value.ollamaModelName=o["embedding-ollama-model-name"]||Z.value.ollamaModelName,Z.value.ollamaBaseUrl=o["embedding-ollama-base-url"]||Z.value.ollamaBaseUrl,Z.value.ollamaKeepAliveSeconds=oe(o["embedding-ollama-keep_alive_seconds"],Z.value.ollamaKeepAliveSeconds),Z.value.openAiModelName=o["embedding-open-ai-model-name"]||Z.value.openAiModelName,Z.value.openAiBaseUrl=o["embedding-open-ai-base-url"]||Z.value.openAiBaseUrl,Z.value.openAiEmbeddingsPath=o["embedding-open-ai-embeddings-path"]||Z.value.openAiEmbeddingsPath,Z.value.openAiKey=o["embedding-open-ai-key"]||Z.value.openAiKey,ee.value=JSON.stringify(Z.value),le.value.topK=oe("RETRIEVE_TOP_K"in o?o.RETRIEVE_TOP_K:void 0,le.value.topK),le.value.metricType=o.RETRIEVE_METRIC_TYPE||le.value.metricType,le.value.metricScoreExpr=o.RETRIEVE_METRIC_SCORE_COMPARE_EXPR||le.value.metricScoreExpr,le.value.denseWeight=oe("RETRIEVE_DENSE_WEIGHT"in o?o.RETRIEVE_DENSE_WEIGHT:void 0,le.value.denseWeight),le.value.sparseWeight=oe("RETRIEVE_SPARSE_WEIGHT"in o?o.RETRIEVE_SPARSE_WEIGHT:void 0,le.value.sparseWeight),te()}catch(o){b.error(e("settings.load.failed"))}finally{F.value=!1}var l})()})),(a,o)=>{const t=f("loading");return A(),N("div",I,[R(l),T((A(),N("div",K,[U("div",B,[U("h2",null,x(M(e)("settings.title")),1)]),R(M(c),{modelValue:E.value,"onUpdate:modelValue":o[25]||(o[25]=e=>E.value=e),class:"settings-tabs"},{default:S((()=>[R(M(s),{label:M(e)("settings.llm.section"),name:"llm"},{default:S((()=>[R(M(n),{model:Q.value,"label-width":"180px"},{default:S((()=>[U("div",P,x(M(e)("settings.basic.section")),1),R(M(i),{label:M(e)("settings.provider")},{default:S((()=>[R(M(u),{modelValue:Q.value.provider,"onUpdate:modelValue":o[0]||(o[0]=e=>Q.value.provider=e),class:"settings-select"},{default:S((()=>[R(M(m),{label:M(e)("settings.provider.openai"),value:"open-ai"},null,8,["label"]),R(M(m),{label:M(e)("settings.provider.ollama"),value:"ollama"},null,8,["label"])])),_:1},8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.use.rag")},{default:S((()=>[R(M(d),{modelValue:Q.value.useRag,"onUpdate:modelValue":o[1]||(o[1]=e=>Q.value.useRag=e)},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.use.tools")},{default:S((()=>[R(M(d),{modelValue:Q.value.useTools,"onUpdate:modelValue":o[2]||(o[2]=e=>Q.value.useTools=e)},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.temperature")},{default:S((()=>[R(M(p),{modelValue:Q.value.temperature,"onUpdate:modelValue":o[3]||(o[3]=e=>Q.value.temperature=e),min:0,max:2,step:.1},null,8,["modelValue"])])),_:1},8,["label"]),U("div",w,x(M(e)("settings.ollama.section")),1),U("div",W,x(M(e)("settings.ollama.desc")),1),R(M(i),{label:M(e)("settings.model.name")},{default:S((()=>[R(M(r),{modelValue:Q.value.ollamaModelName,"onUpdate:modelValue":o[4]||(o[4]=e=>Q.value.ollamaModelName=e)},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.base.url")},{default:S((()=>[R(M(r),{modelValue:Q.value.ollamaBaseUrl,"onUpdate:modelValue":o[5]||(o[5]=e=>Q.value.ollamaBaseUrl=e)},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.keep.alive.seconds")},{default:S((()=>[R(M(p),{modelValue:Q.value.ollamaKeepAliveSeconds,"onUpdate:modelValue":o[6]||(o[6]=e=>Q.value.ollamaKeepAliveSeconds=e),min:1},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.context.length")},{default:S((()=>[R(M(p),{modelValue:Q.value.ollamaContextLength,"onUpdate:modelValue":o[7]||(o[7]=e=>Q.value.ollamaContextLength=e),min:1},null,8,["modelValue"])])),_:1},8,["label"]),U("div",k,x(M(e)("settings.openai.section")),1),U("div",j,x(M(e)("settings.openai.desc")),1),R(M(i),{label:M(e)("settings.model.name")},{default:S((()=>[R(M(r),{modelValue:Q.value.openAiModelName,"onUpdate:modelValue":o[8]||(o[8]=e=>Q.value.openAiModelName=e)},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.base.url")},{default:S((()=>[R(M(r),{modelValue:Q.value.openAiBaseUrl,"onUpdate:modelValue":o[9]||(o[9]=e=>Q.value.openAiBaseUrl=e)},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.completions.path")},{default:S((()=>[R(M(r),{modelValue:Q.value.openAiCompletionsPath,"onUpdate:modelValue":o[10]||(o[10]=e=>Q.value.openAiCompletionsPath=e)},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.api.key")},{default:S((()=>[R(M(r),{modelValue:Q.value.openAiKey,"onUpdate:modelValue":o[11]||(o[11]=e=>Q.value.openAiKey=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.context.length")},{default:S((()=>[R(M(p),{modelValue:Q.value.openAiContextLength,"onUpdate:modelValue":o[12]||(o[12]=e=>Q.value.openAiContextLength=e),min:1},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["model"]),U("div",O,[R(M(v),{type:"primary",loading:z.value,onClick:ie},{default:S((()=>[C(x(M(e)("settings.save")),1)])),_:1},8,["loading"])])])),_:1},8,["label"]),R(M(s),{label:M(e)("settings.embedding.section"),name:"embedding"},{default:S((()=>[R(M(n),{model:Z.value,"label-width":"180px"},{default:S((()=>[U("div",L,x(M(e)("settings.basic.section")),1),R(M(i),{label:M(e)("settings.provider")},{default:S((()=>[R(M(u),{modelValue:Z.value.provider,"onUpdate:modelValue":o[13]||(o[13]=e=>Z.value.provider=e),class:"settings-select"},{default:S((()=>[R(M(m),{label:M(e)("settings.provider.openai"),value:"open-ai"},null,8,["label"]),R(M(m),{label:M(e)("settings.provider.ollama"),value:"ollama"},null,8,["label"])])),_:1},8,["modelValue"])])),_:1},8,["label"]),U("div",G,x(M(e)("settings.ollama.section")),1),U("div",H,x(M(e)("settings.ollama.desc")),1),R(M(i),{label:M(e)("settings.model.name")},{default:S((()=>[R(M(r),{modelValue:Z.value.ollamaModelName,"onUpdate:modelValue":o[14]||(o[14]=e=>Z.value.ollamaModelName=e)},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.base.url")},{default:S((()=>[R(M(r),{modelValue:Z.value.ollamaBaseUrl,"onUpdate:modelValue":o[15]||(o[15]=e=>Z.value.ollamaBaseUrl=e)},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.keep.alive.seconds")},{default:S((()=>[R(M(p),{modelValue:Z.value.ollamaKeepAliveSeconds,"onUpdate:modelValue":o[16]||(o[16]=e=>Z.value.ollamaKeepAliveSeconds=e),min:1},null,8,["modelValue"])])),_:1},8,["label"]),U("div",D,x(M(e)("settings.openai.section")),1),U("div",X,x(M(e)("settings.openai.desc")),1),R(M(i),{label:M(e)("settings.model.name")},{default:S((()=>[R(M(r),{modelValue:Z.value.openAiModelName,"onUpdate:modelValue":o[17]||(o[17]=e=>Z.value.openAiModelName=e)},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.base.url")},{default:S((()=>[R(M(r),{modelValue:Z.value.openAiBaseUrl,"onUpdate:modelValue":o[18]||(o[18]=e=>Z.value.openAiBaseUrl=e)},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.embeddings.path")},{default:S((()=>[R(M(r),{modelValue:Z.value.openAiEmbeddingsPath,"onUpdate:modelValue":o[19]||(o[19]=e=>Z.value.openAiEmbeddingsPath=e)},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.api.key")},{default:S((()=>[R(M(r),{modelValue:Z.value.openAiKey,"onUpdate:modelValue":o[20]||(o[20]=e=>Z.value.openAiKey=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["model"]),U("div",$,[R(M(v),{type:"primary",loading:z.value,onClick:ie},{default:S((()=>[C(x(M(e)("settings.save")),1)])),_:1},8,["loading"])])])),_:1},8,["label"]),R(M(s),{label:M(e)("settings.rag.section"),name:"rag"},{default:S((()=>[R(M(n),{model:le.value,"label-width":"220px"},{default:S((()=>[R(M(i),{label:M(e)("settings.rag.topk")},{default:S((()=>[R(M(p),{modelValue:le.value.topK,"onUpdate:modelValue":o[21]||(o[21]=e=>le.value.topK=e),min:1},null,8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.rag.metric.type.dense")},{default:S((()=>[R(M(u),{modelValue:le.value.metricType,"onUpdate:modelValue":o[22]||(o[22]=e=>le.value.metricType=e),class:"settings-select"},{default:S((()=>[R(M(m),{label:"COSINE",value:"COSINE"}),R(M(m),{label:"IP",value:"IP"}),R(M(m),{label:"L2",value:"L2"})])),_:1},8,["modelValue"])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.rag.metric.type.sparse")},{default:S((()=>[R(M(u),{"model-value":"BM25",class:"settings-select",disabled:""},{default:S((()=>[R(M(m),{label:"BM25",value:"BM25"})])),_:1})])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.rag.weight.label")},{default:S((()=>[U("div",q,[R(M(g),{modelValue:se.value,"onUpdate:modelValue":o[23]||(o[23]=e=>se.value=e),min:0,max:100,"show-tooltip":!0,"format-tooltip":ne},null,8,["modelValue"]),U("div",J,[U("span",null,x(M(e)("settings.rag.weight.dense"))+": "+x(se.value)+"%",1),U("span",null,x(M(e)("settings.rag.weight.sparse"))+": "+x(100-se.value)+"%",1)])])])),_:1},8,["label"]),R(M(i),{label:M(e)("settings.rag.metric.score.expr")},{default:S((()=>[R(M(r),{modelValue:le.value.metricScoreExpr,"onUpdate:modelValue":o[24]||(o[24]=e=>le.value.metricScoreExpr=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["model"]),U("div",Y,[R(M(v),{type:"primary",loading:z.value,onClick:ie},{default:S((()=>[C(x(M(e)("settings.save")),1)])),_:1},8,["loading"])])])),_:1},8,["label"])])),_:1},8,["modelValue"])])),[[t,F.value]])])}}}),[["__scopeId","data-v-cd8f9178"]]);export{F as default};
