import{h as e,t as a,_ as t}from"../index-7487ad29.js";import{d as l,r as s,at as r,f as o,aa as n,o as i,c as d,a as u,X as c,M as p,a4 as v,Q as m,u as g,al as h,U as b,A as f,K as _,ab as E,n as w,j as k,s as y,O as R}from"./@vue-bb747027.js";import{g as T,p as x}from"./oem-517c1d66.js";import{_ as V}from"./plugin-vue_export-helper-3b0dab4c.js";import{f as I,d as C,p as S,q as M,r as P,s as W,i as K,a as O,t as j,m as $,c as N,u as A,g as U,v as D,w as H,x as B,y as z,A as F}from"./element-plus-89dd23ed.js";import{T as G}from"./topoBar-8cfeab2a.js";import{C as q}from"./@element-plus-ccefd8d4.js";import{g as L,p as X}from"./property.api-14e5b6df.js";function Y(e){if(!e||isNaN(e))return"";const a=new Date(e);let t=a.getMonth()+1;t<10&&(t="0"+t);let l=a.getDate();l<10&&(l="0"+l);let s=a.getHours();s<10&&(s="0"+s);let r=a.getMinutes();r<10&&(r="0"+r);let o=a.getSeconds();return o<10&&(o="0"+o),a.getFullYear()+"-"+t+"-"+l+" "+s+":"+r+":"+o}const Q=a=>e.post(`/v1${T}rest/${x}/knowledge/delete`,a),J=a=>e.put(`/v1${T}rest/${x}/knowledge`,a),Z=()=>{window.open(`/v1${T}rest/${x}/knowledge/json-template`)},ee=a=>{const t=new FormData;return t.append("jsonTemplate",a),e.post(`/v1${T}rest/${x}/knowledge/json-template`,t)};const ae={class:"kb-table-container"},te={class:"header-actions"},le={class:"btn-area"},se={class:"search-area"},re={class:"table-wrapper"},oe={class:"outline-preview"},ne={class:"outline-full"},ie={class:"text-chunk-preview"},de={class:"text-chunk-full"},ue={class:"pagination-wrapper"};var ce=V(l({__name:"KnowledgeBaseList",setup(l){const k=s([]),y=s(!1),R=s(1),V=s(10),j=s(0),$=s(""),N=s([]),A=r((()=>t((()=>import("./KbAddDialog-dc086f6b.js")),["chunks/KbAddDialog-dc086f6b.js","assets/KbAddDialog-92b5fee8.css","index-7487ad29.js","assets/index-e387b3d1.css","chunks/@vue-bb747027.js","chunks/vue-router-6370cc0f.js","chunks/axios-ff411c8f.js","chunks/element-plus-89dd23ed.js","chunks/@popperjs-66964824.js","chunks/@vueuse-09ca9f25.js","chunks/@element-plus-ccefd8d4.js","chunks/lodash-es-7a4ab7c3.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/QAForm-6fab092d.js","assets/QAForm-15570946.css","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/oem-517c1d66.js","chunks/topoBar-8cfeab2a.js","assets/topoBar-2d62cac5.css","chunks/property.api-14e5b6df.js"]))),U=r((()=>t((()=>import("./KbEditDialog-79edca00.js")),["chunks/KbEditDialog-79edca00.js","assets/KbEditDialog-acbaba86.css","index-7487ad29.js","assets/index-e387b3d1.css","chunks/@vue-bb747027.js","chunks/vue-router-6370cc0f.js","chunks/axios-ff411c8f.js","chunks/element-plus-89dd23ed.js","chunks/@popperjs-66964824.js","chunks/@vueuse-09ca9f25.js","chunks/@element-plus-ccefd8d4.js","chunks/lodash-es-7a4ab7c3.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/QAForm-6fab092d.js","assets/QAForm-15570946.css","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/oem-517c1d66.js","chunks/topoBar-8cfeab2a.js","assets/topoBar-2d62cac5.css","chunks/property.api-14e5b6df.js"]))),D=s(!1),H=s(!1),B=s(null),z=async()=>{y.value=!0;try{const s=(await(a=(R.value-1)*V.value,t=V.value+1,l=$.value,e.get(`/v1${T}rest/${x}/knowledge`,{params:{offset:a,limit:t,search:l}}))).data?.data||[];s.length>V.value?(k.value=s.slice(0,V.value),j.value=(R.value+1)*V.value):(k.value=s,j.value=(R.value-1)*V.value+s.length)}catch(s){k.value=[],j.value=0}finally{y.value=!1}var a,t,l},F=e=>{V.value=e,z()},G=e=>{R.value=e,z()},q=()=>{R.value=1,z()},L=async()=>{try{await w(),D.value=!0}catch(e){}},X=()=>{D.value=!1,z()},J=()=>{H.value=!1,z()},Z=e=>{N.value=e},ee=()=>{0!==N.value.length&&K.confirm(`Á°ÆËÆ§Âà†Èô§ÈÄâ‰∏≠ÁöÑ ${N.value.length} È°πÊï∞ÊçÆÂêóÔºü`,"Ë≠¶Âëä",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{const e=N.value.map((e=>e.textChunkId));await Q(e),O.success("Âà†Èô§ÊàêÂäü"),z()})).catch((()=>{}))};return o((()=>{z()})),(e,t)=>{const l=n("loading");return i(),d("div",ae,[u("div",te,[u("div",le,[c(g(I),{type:"primary",onClick:z},{default:p((()=>[v(m("üîÑ "+g(a)("common.refresh")),1)])),_:1}),c(g(I),{type:"primary",onClick:L},{default:p((()=>[v(m("‚ûï "+g(a)("common.add")),1)])),_:1}),c(g(I),{type:"danger",disabled:0===N.value.length,onClick:ee},{default:p((()=>[v(m("üóëÔ∏è "+g(a)("common.delete")),1)])),_:1},8,["disabled"])]),u("div",se,[c(g(C),{modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=e=>$.value=e),placeholder:g(a)("common.search.placeholder.keyword"),clearable:"",style:{width:"240px"},onKeyup:h(q,["enter"]),onClear:q},null,8,["modelValue","placeholder"]),c(g(I),{type:"primary",onClick:q},{default:p((()=>[v(m("üîçÔ∏è "+g(a)("common.search")),1)])),_:1})])]),u("div",re,[b((i(),f(g(P),{ref:"tableRef",data:k.value,style:{width:"100%",height:"100%"},border:"",onSelectionChange:Z},{default:p((()=>[c(g(S),{type:"selection",width:"55",align:"center"}),c(g(S),{label:g(a)("kb.outline"),width:"300"},{default:p((e=>[c(g(M),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>{return[u("div",oe,m((a=e.row.outline,a&&0!==a.length?a.length<=3?a.join(" | "):`${a.slice(0,3).join(", ")}... (+${a.length-3}È°π)`:"-")),1)];var a})),default:p((()=>[u("div",ne,[(i(!0),d(_,null,E(e.row.outline,((e,a)=>(i(),d("div",{key:a},m(a+1)+". "+m(e),1)))),128))])])),_:2},1024)])),_:1},8,["label"]),c(g(S),{label:g(a)("kb.textChunk"),width:"300"},{default:p((e=>[c(g(M),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>[u("div",ie,m(e.row.textChunk),1)])),default:p((()=>[u("div",de,m(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),c(g(S),{prop:"description",label:g(a)("kb.description"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),c(g(S),{prop:"dimension",label:g(a)("kb.dimension"),width:"130"},null,8,["label"]),c(g(S),{prop:"embeddingModel",label:g(a)("kb.embeddingModel"),width:"150"},null,8,["label"]),c(g(S),{prop:"embeddingProvider",label:g(a)("kb.embeddingProvider"),width:"150"},null,8,["label"]),c(g(S),{prop:"createTime",label:g(a)("common.create.time"),width:"180"},{default:p((e=>[v(m(g(Y)(e.row.createTime)),1)])),_:1},8,["label"]),c(g(S),{prop:"updateTime",label:g(a)("common.update.time"),width:"180"},{default:p((e=>[v(m(g(Y)(e.row.updateTime)),1)])),_:1},8,["label"]),c(g(S),{prop:"createUsername",label:g(a)("kb.create.username"),width:"150"},null,8,["label"]),c(g(S),{label:g(a)("common.action"),width:"120",align:"center",fixed:"right"},{default:p((e=>[c(g(I),{type:"primary",link:"",onClick:a=>{return t=e.row,B.value={...t,outline:t.outline?[...t.outline]:[]},void(H.value=!0);var t}},{default:p((()=>[v(m(g(a)("common.edit")),1)])),_:1},8,["onClick"]),c(g(I),{type:"danger",link:"",onClick:a=>{var t;(t=e.row)?.textChunkId&&K.confirm("Á°ÆËÆ§Âà†Èô§ËØ•Êù°Êï∞ÊçÆÂêóÔºü","Ë≠¶Âëä",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{await Q([t.textChunkId]),O.success("Âà†Èô§ÊàêÂäü"),z()})).catch((()=>{}))}},{default:p((()=>[v(m(g(a)("common.delete")),1)])),_:1},8,["onClick"])])),_:1},8,["label"])])),_:1},8,["data"])),[[l,y.value]])]),u("div",ue,[c(g(W),{"current-page":R.value,"onUpdate:currentPage":t[1]||(t[1]=e=>R.value=e),"page-size":V.value,"onUpdate:pageSize":t[2]||(t[2]=e=>V.value=e),"page-sizes":[10,20,50,100],total:j.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:F,onCurrentChange:G},null,8,["current-page","page-size","total"])]),c(g(A),{modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=e=>D.value=e),onAddSuccess:X},null,8,["modelValue"]),c(g(U),{modelValue:H.value,"onUpdate:modelValue":t[4]||(t[4]=e=>H.value=e),knowledge:B.value,onEditSuccess:J},null,8,["modelValue","knowledge"])])}}}),[["__scopeId","data-v-6e5e5748"]]);const pe={class:"hit-test-container"},ve={class:"hit-test-result"},me={class:"table-wrapper"},ge={class:"outline-preview"},he={class:"outline-full"},be={class:"text-chunk-full"},fe={class:"header-with-tooltip"},_e={class:"text-chunk-preview"},Ee={class:"text-chunk-full"},we={class:"hit-test-form"};var ke=V(l({__name:"HitTest",setup(t){const l=s({text:"",topK:5}),r=s(),o=s(!1),h=s([]),_=e=>Number.isFinite(e)?e.toFixed(4):"-",E=async()=>{r.value&&await r.value.validate((async a=>{if(a)try{o.value=!0;const a=await(t=l.value.text,s=l.value.topK,e.get(`/v1${T}rest/${x}/knowledge/retrieve`,{params:{"query-text":t,"top-k":s}}));h.value=a.data?.data||[]}catch(r){}finally{o.value=!1}var t,s}))};let w=!0;const k=e=>{"Enter"!==e.key||e.shiftKey||(w=!0,e.preventDefault())},y=()=>{w=!1},R=()=>{w&&(w=!1,E())};return(e,t)=>{const s=n("loading");return i(),d("div",pe,[u("div",ve,[u("div",me,[b((i(),f(g(P),{ref:"tableRef",data:h.value,style:{width:"100%",height:"100%"},border:""},{default:p((()=>[c(g(S),{label:g(a)("kb.outline"),width:"300"},{default:p((e=>[c(g(M),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>[u("div",ge,m(e.row.outline),1)])),default:p((()=>[u("div",he,[u("div",be,m(e.row.outline),1)])])),_:2},1024)])),_:1},8,["label"]),c(g(S),{prop:"denseMetricType",label:g(a)("kb.knowledge.hit.test.dense.metric"),width:"170"},null,8,["label"]),c(g(S),{label:g(a)("kb.knowledge.hit.test.dense.score"),width:"170",formatter:e=>_(e.denseScore)},{header:p((()=>[u("div",fe,[u("span",null,m(g(a)("kb.knowledge.hit.test.dense.score")),1),c(g(j),{effect:"dark",placement:"top","raw-content":!0,content:g(a)("kb.knowledge.hit.test.score.tip")},{default:p((()=>[c(g($),{class:"info-icon"},{default:p((()=>[c(g(q))])),_:1})])),_:1},8,["content"])])])),_:1},8,["label","formatter"]),c(g(S),{prop:"sparseMetricType",label:g(a)("kb.knowledge.hit.test.sparse.metric"),width:"170"},null,8,["label"]),c(g(S),{label:g(a)("kb.knowledge.hit.test.sparse.score"),width:"170",formatter:e=>_(e.sparseScore)},null,8,["label","formatter"]),c(g(S),{label:g(a)("kb.knowledge.hit.test.hybrid.score"),width:"170",formatter:e=>_(e.hybridScore??e.score)},null,8,["label","formatter"]),c(g(S),{label:g(a)("kb.textChunk"),width:"400"},{default:p((e=>[c(g(M),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>[u("div",_e,m(e.row.textChunk),1)])),default:p((()=>[u("div",Ee,m(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),c(g(S),{prop:"isFiltered",label:g(a)("kb.knowledge.hit.test.is.hit"),width:"150",formatter:e=>e.isFiltered?g(a)("common.no"):g(a)("common.yes")},null,8,["label","formatter"]),c(g(S),{prop:"dimension",label:g(a)("kb.dimension"),width:"130"},null,8,["label"]),c(g(S),{prop:"embeddingModel",label:g(a)("kb.embeddingModel"),width:"150"},null,8,["label"]),c(g(S),{prop:"embeddingProvider",label:g(a)("kb.embeddingProvider"),width:"150"},null,8,["label"])])),_:1},8,["data"])),[[s,o.value]])])]),u("div",we,[c(g(U),{ref_key:"formRef",ref:r,model:l.value,"label-width":"120px"},{default:p((()=>[c(g(N),{label:"TOP-K",prop:"topK",rules:[{required:!0,message:g(a)("common.input.required")}]},{default:p((()=>[c(g(A),{class:"top-k-input",modelValue:l.value.topK,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.topK=e),min:1,max:15,"controls-position":"right"},null,8,["modelValue"])])),_:1},8,["rules"]),c(g(N),{label:g(a)("kb.knowledge.hit.test.text"),prop:"text",class:"input-area",rules:[{required:!0,message:g(a)("common.input.required")}]},{default:p((()=>[c(g(C),{modelValue:l.value.text,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.text=e),class:"text-input",placeholder:g(a)("kb.knowledge.hit.test.text.placeholder"),type:"textarea",autosize:{minRows:5,maxRows:10},maxlength:4e3,"show-word-limit":"",onKeydown:k,onInput:y,onKeyup:R},null,8,["modelValue","placeholder"]),c(g(I),{type:"primary",onClick:E},{default:p((()=>[...t[2]||(t[2]=[v("Êèê‰∫§",-1)])])),_:1})])),_:1},8,["label","rules"])])),_:1},8,["model"])])])}}}),[["__scopeId","data-v-dceb1c4e"]]);const ye={class:"rag-settings-page"},Re={class:"section-title"},Te={class:"rag-weight-slider"},xe={class:"rag-weight-values"},Ve={class:"settings-actions"};var Ie=V(l({__name:"RagSettings",setup(e){const t=s(!1),l=s(!1),r=s({topK:5,metricType:"COSINE",metricScoreExpr:"> 0.7",denseWeight:.5,sparseWeight:.5}),h=()=>{const e=r.value.denseWeight,a=r.value.sparseWeight,t=e+a;if(!Number.isFinite(t)||t<=0)return r.value.denseWeight=.5,void(r.value.sparseWeight=.5);r.value.denseWeight=e/t,r.value.sparseWeight=a/t},f=k({get:()=>Math.round(100*r.value.denseWeight),set:e=>{const a=Math.min(100,Math.max(0,e));r.value.denseWeight=a/100,r.value.sparseWeight=(100-a)/100}}),_=e=>{const t=Math.min(100,Math.max(0,Math.round(e))),l=100-t;return`${a("settings.rag.weight.dense")}: ${t}% / ${a("settings.rag.weight.sparse")}: ${l}%`},E=(e,a)=>{if(null==e)return a;const t=Number(e);return Number.isFinite(t)?t:a},w=async()=>{l.value=!0;try{h(),await X([{propertyName:"RETRIEVE_TOP_K",propertyValue:String(r.value.topK)},{propertyName:"RETRIEVE_METRIC_TYPE",propertyValue:r.value.metricType},{propertyName:"RETRIEVE_METRIC_SCORE_COMPARE_EXPR",propertyValue:r.value.metricScoreExpr},{propertyName:"RETRIEVE_DENSE_WEIGHT",propertyValue:String(r.value.denseWeight)},{propertyName:"RETRIEVE_SPARSE_WEIGHT",propertyValue:String(r.value.sparseWeight)}]),O.success(a("settings.save.success"))}catch(e){O.error(a("settings.save.failed"))}finally{l.value=!1}};return o((()=>{(async()=>{t.value=!0;try{const a=(e=await L(["RETRIEVE_TOP_K","RETRIEVE_METRIC_TYPE","RETRIEVE_METRIC_SCORE_COMPARE_EXPR","RETRIEVE_DENSE_WEIGHT","RETRIEVE_SPARSE_WEIGHT"]))?.data?.data?e.data.data:e?.data??{};r.value.topK=E("RETRIEVE_TOP_K"in a?a.RETRIEVE_TOP_K:void 0,r.value.topK),r.value.metricType=a.RETRIEVE_METRIC_TYPE||r.value.metricType,r.value.metricScoreExpr=a.RETRIEVE_METRIC_SCORE_COMPARE_EXPR||r.value.metricScoreExpr,r.value.denseWeight=E("RETRIEVE_DENSE_WEIGHT"in a?a.RETRIEVE_DENSE_WEIGHT:void 0,r.value.denseWeight),r.value.sparseWeight=E("RETRIEVE_SPARSE_WEIGHT"in a?a.RETRIEVE_SPARSE_WEIGHT:void 0,r.value.sparseWeight),h()}catch(l){O.error(a("settings.load.failed"))}finally{t.value=!1}var e})()})),(e,s)=>{const o=n("loading");return b((i(),d("div",ye,[u("div",Re,m(g(a)("settings.rag.section")),1),c(g(U),{model:r.value,"label-width":"220px"},{default:p((()=>[c(g(N),{label:g(a)("settings.rag.topk")},{default:p((()=>[c(g(A),{modelValue:r.value.topK,"onUpdate:modelValue":s[0]||(s[0]=e=>r.value.topK=e),min:1},null,8,["modelValue"])])),_:1},8,["label"]),c(g(N),{label:g(a)("settings.rag.metric.type.dense")},{default:p((()=>[c(g(D),{modelValue:r.value.metricType,"onUpdate:modelValue":s[1]||(s[1]=e=>r.value.metricType=e),class:"settings-select"},{default:p((()=>[c(g(H),{label:"COSINE",value:"COSINE"}),c(g(H),{label:"IP",value:"IP"}),c(g(H),{label:"L2",value:"L2"})])),_:1},8,["modelValue"])])),_:1},8,["label"]),c(g(N),{label:g(a)("settings.rag.metric.type.sparse")},{default:p((()=>[c(g(D),{"model-value":"BM25",class:"settings-select",disabled:""},{default:p((()=>[c(g(H),{label:"BM25",value:"BM25"})])),_:1})])),_:1},8,["label"]),c(g(N),{label:g(a)("settings.rag.weight.label")},{default:p((()=>[u("div",Te,[c(g(B),{modelValue:f.value,"onUpdate:modelValue":s[2]||(s[2]=e=>f.value=e),min:0,max:100,"show-tooltip":!0,"format-tooltip":_},null,8,["modelValue"]),u("div",xe,[u("span",null,m(g(a)("settings.rag.weight.dense"))+": "+m(f.value)+"%",1),u("span",null,m(g(a)("settings.rag.weight.sparse"))+": "+m(100-f.value)+"%",1)])])])),_:1},8,["label"]),c(g(N),{label:g(a)("settings.rag.metric.score.expr")},{default:p((()=>[c(g(C),{modelValue:r.value.metricScoreExpr,"onUpdate:modelValue":s[3]||(s[3]=e=>r.value.metricScoreExpr=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["model"]),u("div",Ve,[c(g(I),{type:"primary",loading:l.value,onClick:w},{default:p((()=>[v(m(g(a)("settings.save")),1)])),_:1},8,["loading"])])])),[[o,t.value]])}}}),[["__scopeId","data-v-26bd28c5"]]);const Ce={class:"layout-container"},Se={class:"content-wrapper"},Me={class:"main-content"},Pe={class:"content-area"},We={key:1,class:"placeholder"};var Ke=V(l({__name:"index",setup(e){const t=s(!1),l=s("1"),r=y(ce),o=(e,a)=>{},n=(e,a)=>{},h=(e,a)=>{switch(l.value=e,e){default:r.value=ce;break;case"2":r.value=ke;break;case"3":r.value=Ie}};return(e,s)=>(i(),d("div",Ce,[c(G),u("div",Se,[c(g(F),{"default-active":l.value,class:"el-menu-vertical-demo",collapse:t.value,onOpen:o,onClose:n,onSelect:h},{default:p((()=>[c(g(z),{index:"1"},{default:p((()=>[v(m(g(a)("kb.knowledge.list")),1)])),_:1}),c(g(z),{index:"2"},{default:p((()=>[v(m(g(a)("kb.knowledge.hit.test")),1)])),_:1}),c(g(z),{index:"3"},{default:p((()=>[v(m(g(a)("settings.rag.section")),1)])),_:1})])),_:1},8,["default-active","collapse"]),u("main",Me,[u("div",Pe,[r.value?(i(),f(R(r.value),{key:0})):(i(),d("div",We,[...s[0]||(s[0]=[u("p",null,"ËØ∑ÈÄâÊã©‰∏Ä‰∏™ËèúÂçïÈ°π",-1)])]))])])])]))}}),[["__scopeId","data-v-e012f15a"]]),Oe=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"}));export{Oe as a,Z as d,ee as i,J as p};
