import{d as e,r as a,w as l,U as s,f as t,a1 as r,ah as o,R as i,o as u,c as d,a as n,P as c,H as v,O as p,L as m,J as h,u as f,a2 as g,ag as b,G as w}from"./@vue-b6573999.js";import{d as z}from"./vue-router-e68aa853.js";import{l as x}from"./login.api-cea65cec.js";import{a as _}from"./axios-ff411c8f.js";import{t as y}from"../index-8cbb132f.js";import{b as k,c as L,d as j,f as S,g as U,h as V}from"./element-plus-594afa91.js";import{_ as C}from"./plugin-vue_export-helper-3b0dab4c.js";import"./mitt-106818fe.js";import"./lodash-es-0d8c957d.js";import"./@vueuse-f9ccc613.js";import"./@popperjs-19b81b33.js";import"./@element-plus-142e0c99.js";import"./async-validator-b6f94fc9.js";import"./@ctrl-d2fe7c9e.js";const R={class:"slider-container"},X={class:"slider-square"},Y={class:"box"},E=e({__name:"SlipCaptcha",props:{loading:{type:Boolean,default:!1}},emits:["validPass"],setup(e,{expose:m,emit:h}){const f=a(!1),g=e;l((()=>g.loading),(e=>{f.value=e}));const b=h;m({updateSlideCaptcha:S});const w=a(null),z=a(null),x=a({hash:"",puzzleUrl:"",width:300,height:150,sliderUrl:"",sliderSize:0,sliderY:0,sliderLeft:0,blockX:0,blockY:0,scaleRatio:1,sliderText:""}),L=s({originX:0}),j=s({class:"",height:0});function S(){f.value=!0,z.value.style.transform="translate3d(0, 0, 0)",x.value.sliderLeft=0,_.get("/v1/auth/captcha/slide?"+(new Date).getTime()).then((e=>{x.value.hash=e.data.hash,x.value.puzzleUrl=e.data.puzzleUrl,x.value.width=e.data.width,x.value.height=e.data.height,x.value.sliderUrl=e.data.sliderUrl,x.value.sliderSize=e.data.sliderSize,x.value.sliderY=e.data.sliderY,x.value.blockY=x.value.sliderY})).then((()=>{if(x.value.sliderText=y("captcha.tip"),j.height=0,j.class="",x.value.sliderLeft=0,z.value&&(z.value.style.left="0"),w.value){const e=w.value.getBoundingClientRect();x.value.scaleRatio=e.width/x.value.width,x.value.sliderY=x.value.sliderY*x.value.scaleRatio,x.value.sliderSize=x.value.sliderSize*x.value.scaleRatio}})).finally((()=>{f.value=!1}))}t((()=>{T(),S()}));const U=a(!1),V=e=>{U.value=!0,x.value.sliderText="",L.originX=e.pageX||e.touches?.[0]?.pageX,z.value.style.willChange="transform",e.preventDefault()},C=e=>{if(!U.value)return;const a=e.pageX||e.touches?.[0]?.pageX;if(!a)return;const l=a-L.originX,s=(x.value.width-x.value.sliderSize)*x.value.scaleRatio,t=Math.max(0,Math.min(l,s));z.value.style.transform=`translate3d(${t}px, 0, 0)`,x.value.sliderLeft=t,e.preventDefault()},E=()=>{if(!U.value)return;U.value=!1,z.value.style.willChange="auto";const e=x.value.sliderLeft/x.value.scaleRatio;var a,l;(a=e,l=x.value.hash,_.get("/v1/auth/captcha/slide/validate",{params:{"slider-x":a,hash:l}})).then((e=>{e.data.result?b("validPass",{hash:x.value.hash,code:e.data.code}):(k.error(y("captcha.validate.fail")),S())}))},T=()=>{document.addEventListener("mousemove",C),document.addEventListener("mouseup",E),document.addEventListener("touchmove",C,{passive:!1}),document.addEventListener("touchend",E)};return r((()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",E),document.removeEventListener("touchmove",C),document.removeEventListener("touchend",E)})),(e,a)=>{const l=o("loading");return i((u(),d("div",R,[n("div",{class:"slider-canvas",onClick:S},[n("div",{ref_key:"puzzle",ref:w,class:"puzzle-image",style:c({backgroundImage:`url(${x.value.puzzleUrl})`,width:"100%",height:"100%",position:"absolute",top:0,left:0,backgroundSize:"cover"})},null,4),n("div",{ref_key:"block",ref:z,class:"slider-block",style:c({backgroundImage:`url(${x.value.sliderUrl})`,width:x.value.sliderSize+"px",height:x.value.sliderSize+"px",top:x.value.blockY+"px",left:"0px",position:"absolute",backgroundSize:"cover"})},null,4),n("div",{class:v(`result-mask ${j.class}`),style:c({height:`${j.height}px`})},null,6)]),n("div",X,[n("div",Y,[n("div",{class:"slider-square-icon",style:c({transform:`translateX(${x.value.sliderLeft}px)`}),onMousedown:V,onTouchstart:V},null,36),n("span",null,p(x.value.sliderText),1)])])])),[[l,f.value]])}}});const T={class:"login-container"};var $=C(e({__name:"Login",setup(e){const l=z(),t=a(),r=a(!1),o=a(!1),i=s({username:"",password:""}),c={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},v=()=>{o.value=!0},p=e=>{x(i.username,i.password,e.code,e.hash).then((()=>{l.push("/")}))};return(e,a)=>(u(),d(w,null,[n("div",T,[m(f(U),{ref:"loginForm",model:i,rules:c,"label-position":"left","label-width":"0px",class:"login-form",onKeyup:b(v,["enter"])},{default:h((()=>[a[5]||(a[5]=n("div",{class:"logo-container"},[n("h2",{class:"logo-text"},"Jrag")],-1)),m(f(L),{prop:"username"},{default:h((()=>[m(f(j),{modelValue:i.username,"onUpdate:modelValue":a[0]||(a[0]=e=>i.username=e),placeholder:"用户名"},null,8,["modelValue"])])),_:1}),m(f(L),{prop:"password"},{default:h((()=>[m(f(j),{modelValue:i.password,"onUpdate:modelValue":a[1]||(a[1]=e=>i.password=e),type:"password",placeholder:"密码"},null,8,["modelValue"])])),_:1}),m(f(L),null,{default:h((()=>[m(f(S),{type:"primary",onClick:v,class:"submit-btn"},{default:h((()=>a[4]||(a[4]=[g(" 登录 ",-1)]))),_:1,__:[4]})])),_:1})])),_:1,__:[5]},8,["model"])]),m(f(V),{modelValue:o.value,"onUpdate:modelValue":a[2]||(a[2]=e=>o.value=e),class:"captcha-dialog","align-center":"",loading:r.value,"show-close":"",onClose:a[3]||(a[3]=e=>r.value=!1)},{default:h((()=>[m(E,{ref_key:"slideCaptchaRef",ref:t,loading:r.value,onValidPass:p},null,8,["loading"])])),_:1},8,["modelValue","loading"])],64))}}),[["__scopeId","data-v-1bf049ac"]]);export{$ as default};
