import{t as e}from"../index-42d8866b.js";import{p as a,d as l,i as o}from"./index-ee2a7ea1.js";import{_ as s}from"./plugin-vue_export-helper-3b0dab4c.js";import{c as t,d as n,f as d,g as u,a as r,m as c,D as i,F as m,C as p,x as v,h as f}from"./element-plus-82bb4bf2.js";import{d as g,r as b,aa as h,o as _,c as y,U as w,A as j,M as k,X as V,u as q,a as x,a4 as F,Q as C,J as B,w as M}from"./@vue-bb747027.js";import{D as U}from"./@element-plus-ccefd8d4.js";import"./vue-router-6370cc0f.js";import"./axios-ff411c8f.js";import"./mitt-106818fe.js";import"./lodash-es-99da8f02.js";import"./@popperjs-66964824.js";import"./@vueuse-09ca9f25.js";import"./async-validator-b6f94fc9.js";import"./@ctrl-d2fe7c9e.js";import"./normalize-wheel-es-233dc293.js";import"./oem-517c1d66.js";import"./topoBar-278bdce0.js";const A={class:"qa-form-container"},R={class:"submit-btn-container"};var D=s(g({__name:"QAForm",emits:["add-success","loading-change"],setup(l,{expose:o,emit:s}){const c=b(),i=b(!1);o({clearForm:function(){p.value.question="",p.value.answer="",p.value.description="",p.value.tags=[],c.value&&c.value.clearValidate()}});const m=s,p=b({question:"",answer:"",description:"",tags:[]}),v={question:[{required:!0,message:e("common.input.required"),trigger:"blur"}],answer:[{required:!0,message:e("common.input.required"),trigger:"blur"}]};const f=async()=>{c.value&&await c.value.validate((async l=>{if(l){i.value=!0,m("loading-change",!0);try{const l=[{outline:[p.value.question],textChunk:p.value.answer,description:p.value.description}];await a(l),r.success(e("common.success")),m("add-success")}catch(o){r.error(e("common.fail"))}finally{i.value=!1,m("loading-change",!1)}}}))};return(a,l)=>{const o=h("loading");return _(),y("div",A,[w((_(),j(q(u),{ref_key:"qaFormRef",ref:c,model:p.value,rules:v,"label-width":"100px",class:"qa-form"},{default:k((()=>[V(q(t),{label:q(e)("kb.question"),prop:"question"},{default:k((()=>[V(q(n),{modelValue:p.value.question,"onUpdate:modelValue":l[0]||(l[0]=e=>p.value.question=e),placeholder:q(e)("common.placeholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),V(q(t),{label:q(e)("kb.answer"),prop:"answer"},{default:k((()=>[V(q(n),{modelValue:p.value.answer,"onUpdate:modelValue":l[1]||(l[1]=e=>p.value.answer=e),placeholder:q(e)("common.placeholder"),type:"textarea",rows:6},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),V(q(t),{label:q(e)("kb.description")},{default:k((()=>[V(q(n),{modelValue:p.value.description,"onUpdate:modelValue":l[2]||(l[2]=e=>p.value.description=e),placeholder:q(e)("common.placeholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),V(q(t),null,{default:k((()=>[x("div",R,[V(q(d),{type:"primary",onClick:f},{default:k((()=>[F(C(q(e)("common.submit")),1)])),_:1})])])),_:1})])),_:1},8,["model"])),[[o,i.value]])])}}}),[["__scopeId","data-v-5dac4550"]]);const I={class:"json-template-form-container"},S={class:"download-template"},z={class:"upload-section",style:{"margin-top":"20px"}},J={class:"el-upload__text"},K={key:0,class:"file-info",style:{"margin-top":"10px"}},L={class:"submit-btn-container"};var Q=s(g({__name:"JsonTemplateForm",emits:["add-success","loading-change"],setup(a,{expose:s,emit:t}){const n=t;s({clearForm:D});const u=b(!1),p=b(!1),v=b(null),f=b([]),g=b(),h=async()=>{try{u.value=!0,await l()}catch(a){r.error(e("common.download.failed"))}finally{u.value=!1}},w=(e,a)=>{a.length>1?f.value=[e]:f.value=a,v.value=e.raw||null},j=e=>{g.value.clearFiles();const a=e[0];a.uid=m(),g.value.handleStart(a)},M=()=>{v.value=null,f.value=[]},A=async()=>{if(v.value)try{p.value=!0,n("loading-change",!0),await o(v.value),r.success(e("common.success")),n("add-success"),D()}catch(a){!a.response&&(r.error(e("common.file.change")),D())}finally{p.value=!1,n("loading-change",!1)}else r.warning(e("kb.please.select.file"))},R=e=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["Bytes","KB","MB","GB"][a]};function D(){v.value=null,f.value=[],g.value?.clearFiles()}return(a,l)=>(_(),y("div",I,[x("div",S,[V(q(d),{type:"primary",onClick:h,loading:u.value},{default:k((()=>[F(C(q(e)("kb.download.json.template")),1)])),_:1},8,["loading"])]),x("div",z,[V(q(i),{ref_key:"uploadRef",ref:g,"auto-upload":!1,multiple:!1,"on-change":w,"on-remove":M,"on-exceed":j,"file-list":f.value,accept:".json",limit:1,drag:""},{default:k((()=>[V(q(c),{class:"el-icon--upload"},{default:k((()=>[V(q(U))])),_:1}),x("div",J,[x("em",null,C(q(e)("kb.json.template.drop.or.click.upload")),1)])])),_:1},8,["file-list"])]),v.value?(_(),y("div",K,[x("p",null,C(q(e)("common.selected.file"))+": "+C(v.value.name)+" ("+C(R(v.value.size))+") ",1)])):B("",!0),x("div",L,[V(q(d),{type:"success",disabled:!v.value,loading:p.value,onClick:A},{default:k((()=>[F(C(q(e)("common.submit")),1)])),_:1},8,["disabled","loading"])])]))}}),[["__scopeId","data-v-ddab4930"]]);const T={class:"container"};var G=s(g({__name:"KbAddDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","add-success"],setup(a,{emit:l}){const o=b(),s=b(),t=a,n=l,d=b("qa"),u=b(t.modelValue),r=b(!1);M((()=>t.modelValue),(e=>{u.value=e}));const c=e=>{r.value=e},i=()=>{n("add-success"),m()},m=()=>{d.value="qa",o.value.clearForm(),s.value.clearForm(),n("update:modelValue",!1)};return(a,l)=>(_(),j(q(f),{title:q(e)("kb.knowledge.add"),"close-on-click-modal":!1,onClose:m,modelValue:u.value,"onUpdate:modelValue":l[1]||(l[1]=e=>u.value=e),"append-to-body":"",width:"1000px",draggable:"",loading:r.value},{default:k((()=>[x("div",T,[V(q(p),{modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=e=>d.value=e),type:"card"},{default:k((()=>[V(q(v),{label:q(e)("kb.knowledge.add.qa"),name:"qa"},{default:k((()=>[V(D,{ref_key:"qaFormRef",ref:o,onAddSuccess:i,onLoadingChange:c},null,512)])),_:1},8,["label"]),V(q(v),{label:q(e)("kb.knowledge.add.json.template"),name:"json"},{default:k((()=>[V(Q,{ref_key:"jsonTemplateFormRef",ref:s,onAddSuccess:i,onLoadingChange:c},null,512)])),_:1},8,["label"])])),_:1},8,["modelValue"])])])),_:1},8,["title","modelValue","loading"]))}}),[["__scopeId","data-v-1c93acaf"]]);export{G as default};
