import{d as e,r as a,w as s,o as t,c as l,a as n,I as o,u as i,G as c,S as r,J as u,a2 as v,M as d,Q as h,R as f,af as m,n as p,H as g,L as y,f as w,C as b,F as x,ae as k}from"./@vue-c3e0918f.js";import{o as C,p as A,r as j,e as P,q as E}from"./@element-plus-fd8db016.js";import{M as H}from"./markdown-it-b5917cbb.js";import{g as T,d as q,c as I,a as L,o as M,s as S,b as F,e as N,f as U,h as B}from"./ai.api-ad10b1cd.js";import{t as O,l as z}from"../index-5fa700fd.js";import{_ as R}from"./plugin-vue_export-helper-3b0dab4c.js";import{d as Q,f as _,b as G,i as W,j as J,k as V,l as X,m as Z,n as Y,o as D}from"./element-plus-922bb8b1.js";import{u as K}from"./vue-router-abf6aa45.js";import{M as $}from"./menuCard-e88b8362.js";import{e as ee}from"./lodash-es-ca13b026.js";import"./mdurl-265342ab.js";import"./uc.micro-caa990fc.js";import"./entities-a9d5f18d.js";import"./linkify-it-fb3f2949.js";import"./punycode.js-94cdf097.js";import"./sse.js-610fcddf.js";import"./axios-ff411c8f.js";import"./mitt-106818fe.js";import"./@vueuse-fa6e8f14.js";import"./async-validator-b6f94fc9.js";import"./@popperjs-19b81b33.js";import"./normalize-wheel-es-233dc293.js";import"./@ctrl-d2fe7c9e.js";const ae={class:"chat-manage-container"},se={class:"chat-manage-card"},te={class:"chat-manage-header"},le={class:"chat-list"},ne={class:"list-title fx"},oe={class:"text"},ie={class:"list-content"},ce=["onClick"];var re=R(e({__name:"chatManage",props:{newChat:{type:Function,required:!0,default:()=>{}},historyChat:{type:Function,required:!0,default:()=>{}},currContextId:{type:String,default:""},messageContext:{type:Array,default:()=>[]}},emits:["showChatManage"],setup(e,{expose:w,emit:b}){const x=e,k=a(),A=a(!1),j=a(""),P=a([]),E=a([]),H=a(x.currContextId),I=b;s((()=>x.currContextId),(e=>{H.value=e}));const L=()=>{I("showChatManage",!1),x.messageContext?.length?(H.value="",x.newChat(),M()):G({message:O("ai.already.latest.chat"),type:"success"})},M=()=>{T().then((e=>{P.value=e.data.data,F(j.value,P.value)}))},S=e=>{const a=[];e?a.push(e):P.value.forEach((e=>{a.push(e.contextId)})),W.confirm(O("ai.delete.warning"),O(e?"ai.delete.chat.confirm":"ai.delete.all.chat.confirm"),{confirmButtonText:O("common.ok"),cancelButtonText:O("common.cancel"),type:"warning"}).then((()=>{q(a).then((a=>{M(),e===H.value&&L()}))}))};s((()=>j.value),(e=>{F(e)}));const F=(e,a)=>{const s=new RegExp(e,"i"),t=a||P.value;E.value=t.filter((e=>s.test(e.title)))};return w({getHistoryListData:M}),(e,a)=>(t(),l("div",ae,[n("div",se,[n("div",te,[A.value?(t(),o(i(Q),{key:0,ref_key:"searchInputRef",ref:k,modelValue:j.value,"onUpdate:modelValue":a[0]||(a[0]=e=>j.value=e),class:"search-input",placeholder:e.$t("ai.search.history.context"),"suffix-icon":i(C),autofocus:"",onBlur:a[1]||(a[1]=e=>A.value=!1)},null,8,["modelValue","placeholder","suffix-icon"])):(t(),l(c,{key:1},[r(i(_),{type:"primary",class:"add",round:"",onClick:L},{default:u((()=>[a[4]||(a[4]=n("i",{class:"iconfont icon-chat-new"},null,-1)),v(d(e.$t("ai.add.new.chat")),1)])),_:1}),r(i(_),{class:"search-button",icon:i(C),circle:"",onClick:a[2]||(a[2]=e=>(A.value=!0,void p((()=>{j.value="",k.value.focus()}))))},null,8,["icon"])],64))]),h(n("div",le,[n("div",ne,[n("div",oe,d(e.$t("ai.history.chat")),1),n("div",{class:"delete",onClick:a[3]||(a[3]=e=>S())},[a[5]||(a[5]=n("i",{class:"iconfont icon-trash-alt"},null,-1)),v(d(e.$t("ai.delete.all.chat")),1)])]),n("div",ie,[(t(!0),l(c,null,m(E.value,((e,s)=>(t(),l("div",{key:s,class:g(["list-item fx",{active:H.value===e.contextId}])},[n("div",{class:"cont fx",style:{height:"100%"},onClick:a=>{return s=e.contextId,I("showChatManage",!1),H.value=s,x.historyChat(s),void(j.value="");var s}},[a[6]||(a[6]=n("i",{class:"iconfont icon-lishiduihua"},null,-1)),n("p",null,d(e.title),1)],8,ce),r(i(X),{trigger:"hover",teleported:!1},{dropdown:u((()=>[r(i(J),null,{default:u((()=>[r(i(V),{onClick:y((a=>S(e.contextId)),["stop"])},{default:u((()=>[a[7]||(a[7]=n("i",{class:"iconfont icon-trash-alt"},null,-1)),v(" "+d(i(O)("common.delete")),1)])),_:1},8,["onClick"])])),_:2},1024)])),default:u((()=>[a[8]||(a[8]=n("span",{class:"el-dropdown-link"},[n("span",{class:"iconfont icon-vgengduo"},"...")],-1))])),_:2},1024)],2)))),128))])],512),[[f,E.value?.length]])])]))}}),[["__scopeId","data-v-c5432ace"]]);const ue=e=>e&&0!==e.length?e.map((e=>`- [${e.fullFileName}](${e.url})`)).join("\n"):"";const ve={key:0,class:"chat-view"},de={class:"message-init"},he={class:"title"},fe={class:"hot-questions"},me={class:"fx hot-questions-title"},pe={class:"fx"},ge={class:"question-list"},ye=["onClick"],we={key:0,class:"message-list"},be={class:"message-content"},xe=["innerHTML"],ke={class:"src-file"},Ce=["innerHTML"],Ae={class:"support"},je=["onClick"],Pe=["onClick"],Ee=["innerHTML"],He={class:"avatar-wrap"},Te={class:"input-area"};var qe=R(e({__name:"ChatView",props:{isFullscreen:{type:Boolean,default:!1},isMobile:{type:Boolean,default:!1}},setup(e,{expose:s}){const o=new H({html:!0,linkify:!0,typographer:!0});o.renderer.rules.paragraph_open=function(e,a){return'<p style="line-height: var(--n-font-line-height-4);">'},o.renderer.rules.link_open=function(e,a,s,t,l){return e[a].attrPush(["target","_blank"]),l.renderToken(e,a,s)};const y=a(!1),k=a(null),C=a();let T;const q=a(),R=a(!0),J=a([]),V=a(""),X=a(!1),K=a(!0);let $;const ee=e=>{if(X.value)G.info(O("ai.assistant.waiting"));else if(e&&(V.value=e),V.value.trim()){X.value=!0,se();const e={index:J.value.length,content:V.value,role:"user"};J.value.push(e),V.value="";const a={contextId:C.value,messages:J.value};$=L(a),$.onopen=()=>{T=M(C.value),K.value&&(J.value.push({index:J.value.length,role:"assistant",content:""}),K.value=!1),se()},$.onmessage=e=>{try{const a=JSON.parse(e.data);ae(a)}catch(a){}},$.onerror=e=>{401===e.responseCode?window.location.assign("/#/login"):0!==e.responseCode&&(G.error(O("ai.assistant.service.unavailable")),X.value=!1,K.value=!0)}}},ae=e=>{te(),R.value&&se(),e.message&&("system"===e.message?.role?(J.value[J.value.length-1]=e.message,J.value.push({index:J.value.length,role:"assistant",content:""})):"assistant"===e.message?.role&&(J.value[J.value.length-1].index,e.message.index,!0===e.done?(J.value[J.value.length-1].content+=e.message.content,X.value=!1,K.value=!0,p((()=>{$.close(),T&&T.readyState===T.OPEN&&T.close()}))):(e.message.srcFile&&e.message.srcFile.length>0&&(J.value[J.value.length-1].srcFile=e.message.srcFile),e.message.content&&(J.value[J.value.length-1].content+=e.message.content)))),S({contextId:C.value,messages:J.value})},se=()=>{p((()=>{q.value&&q.value.wrapRef.scrollTo({top:q.value.wrapRef.scrollHeight,behavior:"smooth"})}))},te=()=>{if(q.value){const{scrollTop:e,scrollHeight:a,clientHeight:s}=q.value.wrapRef;R.value=e+100>a-s}};let le=!0;const ne=e=>{"Enter"!==e.key||e.shiftKey||(le=!0,e.preventDefault())},oe=()=>{le=!1},ie=()=>{le&&(le=!1,ee())},ce=a([]),qe=()=>{F().then((e=>{ce.value=e.data.data}))},Ie=(e,a)=>{a.feedback=e,B({contextId:C.value,index:a.index,feedback:e}).then((a=>{1===e&&G({message:"😊",type:"info"}),2===e&&G({message:"😭",type:"info"})}))},Le=()=>{Se(),V.value="",J.value=[],R.value=!0,N().then((e=>{C.value=e.data.contextId})),qe(),se()},Me=e=>{Se(),V.value="",e!==C.value&&k.value.getHistoryListData(),C.value=e,U(e).then((e=>{J.value=e.data.messages,se()}))},Se=()=>{X.value=!1,K.value=!0,$&&$.close(),T&&T.readyState===T.OPEN&&T.close()};return w((()=>{I().then((e=>{2===e.status?W.alert(O("ai.api.key.invalid"),{type:"error",message:O("ai.api.key.invalid.desc"),callback:()=>{}}):Le()}))})),b((()=>{Se()})),s({showChatManage:y,chatManageRef:k,getHistoryListData:()=>k.value.getHistoryListData(),newChat:Le}),(a,s)=>(t(),l("div",{class:g(["chat-container",{fullscreen:e.isFullscreen,"is-mobile":e.isMobile}])},[h(r(re,{class:"chat-manage",ref_key:"chatManageRef",ref:k,"new-chat":Le,"history-chat":Me,"curr-context-id":C.value,"message-context":J.value,onShowChatManage:s[0]||(s[0]=e=>y.value=e)},null,8,["curr-context-id","message-context"]),[[f,y.value||e.isFullscreen]]),!y.value||e.isFullscreen||e.isMobile&&!y.value?(t(),l("div",ve,[r(i(Y),{ref_key:"scrollbarRef",ref:q,class:"scroll",onScroll:te},{default:u((()=>[n("div",de,[s[4]||(s[4]=n("div",{class:"ai-logo"},[n("span",{style:{"font-size":"100px"}},"🤖")],-1)),n("h2",he,d(a.$t("ai.hi.assistant")),1),n("div",fe,[n("div",me,[n("strong",pe,[r(i(Z),null,{default:u((()=>[r(i(A))])),_:1}),v(" "+d(a.$t("ai.hot.question")),1)]),n("span",{class:"change fx",onClick:qe},[v(d(a.$t("ai.refresh.hot.question")),1),r(i(Z),null,{default:u((()=>[r(i(j))])),_:1})])]),n("div",ge,[(t(!0),l(c,null,m(ce.value,((e,a)=>(t(),l("div",{key:a,class:"question",onClick:a=>{return s=e.question,void ee(s);var s}},[s[3]||(s[3]=n("strong",{class:"qa"},"HOT",-1)),v(d(e.question),1)],8,ye)))),128))])])]),J.value?.length?(t(),l("div",we,[(t(!0),l(c,null,m(J.value,((e,m)=>(t(),l("div",{key:m,class:g(["message-row",[e.role]])},["assistant"===e.role?(t(),l(c,{key:0},[n("div",{class:g(["avatar-wrap",[X.value&&m===J.value.length-1?"thinking-avatar":""]])},[r(i(D),{size:50,class:"ai-chat-logo"},{default:u((()=>[...s[5]||(s[5]=[n("span",{style:{"font-size":"30px",margin:"auto"}},"🤖",-1)])])),_:1})],2),n("div",be,[n("div",{innerHTML:i(o).render(e.content+(X.value&&m===J.value.length-1?"...":""))},null,8,xe),h(n("div",ke,[s[6]||(s[6]=n("br",null,null,-1)),n("p",null,d(a.$t("ai.source")),1),n("div",{innerHTML:i(o).render(i(ue)(e.srcFile))},null,8,Ce)],512),[[f,e.srcFile&&e.srcFile.length>0]]),h(n("div",Ae,[n("span",{class:g(["feedback-icon-good",{good:1===e.feedback}]),onClick:a=>Ie(1,e)},"👍",10,je),s[7]||(s[7]=v("   ",-1)),n("span",{class:g(["feedback-icon-bad",{bad:2===e.feedback}]),onClick:a=>Ie(2,e)},"👎",10,Pe)],512),[[f,"user"===i(z)&&e?.content&&!X.value]])])],64)):"user"===e.role?(t(),l(c,{key:1},[n("div",{class:"message-content",innerHTML:i(o).render(e.content)},null,8,Ee),n("div",He,[r(i(D),{size:50},{default:u((()=>[...s[8]||(s[8]=[n("img",{src:"data:image/png;base64,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"},null,-1)])])),_:1})])],64)):x("",!0)],2)))),128))])):x("",!0),R.value?x("",!0):(t(),l("div",{key:1,class:"scroll-to-bottom-button",onClick:se},[r(i(Z),null,{default:u((()=>[r(i(P))])),_:1})]))])),_:1},512),n("div",Te,[r(i(Q),{modelValue:V.value,"onUpdate:modelValue":s[1]||(s[1]=e=>V.value=e),class:"chat-input",placeholder:i(O)("ai.input.placeholder"),type:"textarea",autosize:{minRows:5,maxRows:10},maxlength:102400,"show-word-limit":"",onKeydown:ne,onInput:oe,onKeyup:ie},null,8,["modelValue","placeholder"]),r(i(_),{type:"primary",class:"chat-button",icon:i(E),circle:"",disabled:!V.value?.length,onClick:s[2]||(s[2]=e=>ee())},null,8,["icon","disabled"])])])):x("",!0)],2))}}),[["__scopeId","data-v-7aa7c25c"]]);const Ie={class:"top-bar"},Le={class:"menu-button-box"};var Me=R(e({__name:"AIAssistantPage",setup(e){const s=K(),o=a(null),i=a(null),c=a(!1),u=a(!0),d=a(!1),m=()=>{o.value.showChatManage=!o.value.showChatManage,o.value.showChatManage&&p((()=>{o.value.chatManageRef?.getHistoryListData()}))},y=()=>{i.value.show()},x=()=>{(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<768||s.query?.isMobile?(d.value=!0,u.value=!1,document.body.style.minWidth="0px"):(d.value=!1,u.value=!0,document.body.style.minWidth="768px")},C=()=>{if(d.value){const e=document.querySelector(".web-app");e&&(e.style.height=window.innerHeight+"px")}else{const e=document.querySelector(".web-app");e&&(e.style.height="")}};return w((()=>{x(),C(),d.value?C():p((()=>{o.value.getHistoryListData()})),window.addEventListener("resize",ee((()=>{x(),C()}),10)),window.addEventListener("orientationchange",(()=>{setTimeout((()=>{C()}),100)}))})),b((()=>{window.removeEventListener("resize",x),window.removeEventListener("orientationchange",C)})),(e,a)=>{const s=k("draggable");return t(),l("div",{class:g(["ai-assistant-page",{"full-page":u.value,"mobile-page":d.value}])},[n("div",Ie,[a[3]||(a[3]=n("h3",null,"🤖 数据通信百科助手",-1)),n("div",Le,[h((t(),l("span",{class:g(["menu-button",{active:o.value?.showChatManage}]),onClick:m},[...a[1]||(a[1]=[v(" ⌥ ",-1)])],2)),[[f,d.value],[s,{device:"mobile"}]]),n("span",{class:g(["menu-button",{active:c.value}]),onClick:y},[...a[2]||(a[2]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},[n("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),n("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),n("line",{x1:"3",y1:"18",x2:"21",y2:"18"})],-1)])],2)])]),r($,{ref_key:"menuCardRef",ref:i,class:"menu-card",onShowChange:a[0]||(a[0]=e=>c.value=e)},null,512),r(qe,{ref_key:"chatViewRef",ref:o,class:"chat-view","is-fullscreen":u.value,"is-mobile":d.value},null,8,["is-fullscreen","is-mobile"])],2)}}}),[["__scopeId","data-v-5d71127a"]]);export{Me as default};
