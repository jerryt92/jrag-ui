import{h as e,t as a,_ as t}from"../index-9ed092b7.js";import{d as l,r as s,at as r,f as o,aa as n,o as i,c as d,a as u,X as p,M as c,a4 as v,Q as m,u as g,al as h,U as b,A as f,K as _,ab as E,n as w,j as k,s as y,O as R}from"./@vue-bb747027.js";import{g as T,p as x}from"./oem-517c1d66.js";import{_ as V}from"./plugin-vue_export-helper-3b0dab4c.js";import{f as I,d as S,p as C,q as M,r as P,s as W,i as K,a as O,t as $,m as j,c as N,u as A,g as U,v as D,w as H,x as z,y as F,A as G}from"./element-plus-89dd23ed.js";import{T as B}from"./topoBar-db3eede8.js";import{C as q}from"./@element-plus-ccefd8d4.js";import{g as L,p as X}from"./property.api-a7ae1176.js";function Y(e){if(!e||isNaN(e))return"";const a=new Date(e);let t=a.getMonth()+1;t<10&&(t="0"+t);let l=a.getDate();l<10&&(l="0"+l);let s=a.getHours();s<10&&(s="0"+s);let r=a.getMinutes();r<10&&(r="0"+r);let o=a.getSeconds();return o<10&&(o="0"+o),a.getFullYear()+"-"+t+"-"+l+" "+s+":"+r+":"+o}const Q=a=>e.put(`/v1${T}rest/${x}/knowledge`,a),J=()=>{window.open(`/v1${T}rest/${x}/knowledge/json-template`)},Z=a=>{const t=new FormData;return t.append("jsonTemplate",a),e.post(`/v1${T}rest/${x}/knowledge/json-template`,t)};const ee={class:"kb-table-container"},ae={class:"header-actions"},te={class:"btn-area"},le={class:"search-area"},se={class:"table-wrapper"},re={class:"outline-preview"},oe={class:"outline-full"},ne={class:"text-chunk-preview"},ie={class:"text-chunk-full"},de={class:"pagination-wrapper"};var ue=V(l({__name:"KnowledgeBaseList",setup(l){const k=s([]),y=s(!1),R=s(1),V=s(10),$=s(0),j=s(""),N=s([]),A=r((()=>t((()=>import("./KbAddDialog-5d223383.js")),["chunks/KbAddDialog-5d223383.js","assets/KbAddDialog-afed4f14.css","index-9ed092b7.js","assets/index-e387b3d1.css","chunks/@vue-bb747027.js","chunks/vue-router-6370cc0f.js","chunks/axios-ff411c8f.js","chunks/element-plus-89dd23ed.js","chunks/@popperjs-66964824.js","chunks/@vueuse-09ca9f25.js","chunks/@element-plus-ccefd8d4.js","chunks/lodash-es-7a4ab7c3.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/oem-517c1d66.js","chunks/topoBar-db3eede8.js","assets/topoBar-2d62cac5.css","chunks/property.api-a7ae1176.js"]))),U=s(!1),D=async()=>{y.value=!0;try{const s=(await(a=(R.value-1)*V.value,t=V.value+1,l=j.value,e.get(`/v1${T}rest/${x}/knowledge`,{params:{offset:a,limit:t,search:l}}))).data?.data||[];s.length>V.value?(k.value=s.slice(0,V.value),$.value=(R.value+1)*V.value):(k.value=s,$.value=(R.value-1)*V.value+s.length)}catch(s){k.value=[],$.value=0}finally{y.value=!1}var a,t,l},H=e=>{V.value=e,D()},z=e=>{R.value=e,D()},F=()=>{R.value=1,D()},G=async()=>{try{await w(),U.value=!0}catch(e){}},B=()=>{U.value=!1,D()},q=e=>{N.value=e},L=()=>{0!==N.value.length&&K.confirm(`Á°ÆËÆ§Âà†Èô§ÈÄâ‰∏≠ÁöÑ ${N.value.length} È°πÊï∞ÊçÆÂêóÔºü`,"Ë≠¶Âëä",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{const a=N.value.map((e=>e.textChunkId));var t;await(t=a,e.post(`/v1${T}rest/${x}/knowledge/delete`,t)),O.success("Âà†Èô§ÊàêÂäü"),D()})).catch((()=>{}))};return o((()=>{D()})),(e,t)=>{const l=n("loading");return i(),d("div",ee,[u("div",ae,[u("div",te,[p(g(I),{type:"primary",onClick:D},{default:c((()=>[v(m("üîÑ "+g(a)("common.refresh")),1)])),_:1}),p(g(I),{type:"primary",onClick:G},{default:c((()=>[v(m("‚ûï "+g(a)("common.add")),1)])),_:1}),p(g(I),{type:"danger",disabled:0===N.value.length,onClick:L},{default:c((()=>[v(m("üóëÔ∏è "+g(a)("common.delete")),1)])),_:1},8,["disabled"])]),u("div",le,[p(g(S),{modelValue:j.value,"onUpdate:modelValue":t[0]||(t[0]=e=>j.value=e),placeholder:g(a)("common.search.placeholder.keyword"),clearable:"",style:{width:"240px"},onKeyup:h(F,["enter"]),onClear:F},null,8,["modelValue","placeholder"]),p(g(I),{type:"primary",onClick:F},{default:c((()=>[v(m("üîçÔ∏è "+g(a)("common.search")),1)])),_:1})])]),u("div",se,[b((i(),f(g(P),{ref:"tableRef",data:k.value,style:{width:"100%",height:"100%"},border:"",onSelectionChange:q},{default:c((()=>[p(g(C),{type:"selection",width:"55",align:"center"}),p(g(C),{label:g(a)("kb.outline"),width:"300"},{default:c((e=>[p(g(M),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:c((()=>{return[u("div",re,m((a=e.row.outline,a&&0!==a.length?a.length<=3?a.join(" | "):`${a.slice(0,3).join(", ")}... (+${a.length-3}È°π)`:"-")),1)];var a})),default:c((()=>[u("div",oe,[(i(!0),d(_,null,E(e.row.outline,((e,a)=>(i(),d("div",{key:a},m(a+1)+". "+m(e),1)))),128))])])),_:2},1024)])),_:1},8,["label"]),p(g(C),{label:g(a)("kb.textChunk"),width:"300"},{default:c((e=>[p(g(M),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:c((()=>[u("div",ne,m(e.row.textChunk),1)])),default:c((()=>[u("div",ie,m(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),p(g(C),{prop:"description",label:g(a)("kb.description"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),p(g(C),{prop:"dimension",label:g(a)("kb.dimension"),width:"130"},null,8,["label"]),p(g(C),{prop:"embeddingModel",label:g(a)("kb.embeddingModel"),width:"150"},null,8,["label"]),p(g(C),{prop:"embeddingProvider",label:g(a)("kb.embeddingProvider"),width:"150"},null,8,["label"]),p(g(C),{prop:"createTime",label:g(a)("common.create.time"),width:"180"},{default:c((e=>[v(m(g(Y)(e.row.createTime)),1)])),_:1},8,["label"]),p(g(C),{prop:"updateTime",label:g(a)("common.update.time"),width:"180"},{default:c((e=>[v(m(g(Y)(e.row.updateTime)),1)])),_:1},8,["label"]),p(g(C),{prop:"createUsername",label:g(a)("kb.create.username"),width:"150"},null,8,["label"])])),_:1},8,["data"])),[[l,y.value]])]),u("div",de,[p(g(W),{"current-page":R.value,"onUpdate:currentPage":t[1]||(t[1]=e=>R.value=e),"page-size":V.value,"onUpdate:pageSize":t[2]||(t[2]=e=>V.value=e),"page-sizes":[10,20,50,100],total:$.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:H,onCurrentChange:z},null,8,["current-page","page-size","total"])]),p(g(A),{modelValue:U.value,"onUpdate:modelValue":t[3]||(t[3]=e=>U.value=e),onAddSuccess:B},null,8,["modelValue"])])}}}),[["__scopeId","data-v-7fb40b10"]]);const pe={class:"hit-test-container"},ce={class:"hit-test-result"},ve={class:"table-wrapper"},me={class:"outline-preview"},ge={class:"outline-full"},he={class:"text-chunk-full"},be={class:"header-with-tooltip"},fe={class:"text-chunk-preview"},_e={class:"text-chunk-full"},Ee={class:"hit-test-form"};var we=V(l({__name:"HitTest",setup(t){const l=s({text:"",topK:5}),r=s(),o=s(!1),h=s([]),_=e=>Number.isFinite(e)?e.toFixed(4):"-",E=async()=>{r.value&&await r.value.validate((async a=>{if(a)try{o.value=!0;const a=await(t=l.value.text,s=l.value.topK,e.get(`/v1${T}rest/${x}/knowledge/retrieve`,{params:{"query-text":t,"top-k":s}}));h.value=a.data?.data||[]}catch(r){}finally{o.value=!1}var t,s}))};let w=!0;const k=e=>{"Enter"!==e.key||e.shiftKey||(w=!0,e.preventDefault())},y=()=>{w=!1},R=()=>{w&&(w=!1,E())};return(e,t)=>{const s=n("loading");return i(),d("div",pe,[u("div",ce,[u("div",ve,[b((i(),f(g(P),{ref:"tableRef",data:h.value,style:{width:"100%",height:"100%"},border:""},{default:c((()=>[p(g(C),{label:g(a)("kb.outline"),width:"300"},{default:c((e=>[p(g(M),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:c((()=>[u("div",me,m(e.row.outline),1)])),default:c((()=>[u("div",ge,[u("div",he,m(e.row.outline),1)])])),_:2},1024)])),_:1},8,["label"]),p(g(C),{prop:"denseMetricType",label:g(a)("kb.knowledge.hit.test.dense.metric"),width:"170"},null,8,["label"]),p(g(C),{label:g(a)("kb.knowledge.hit.test.dense.score"),width:"170",formatter:e=>_(e.denseScore)},{header:c((()=>[u("div",be,[u("span",null,m(g(a)("kb.knowledge.hit.test.dense.score")),1),p(g($),{effect:"dark",placement:"top","raw-content":!0,content:g(a)("kb.knowledge.hit.test.score.tip")},{default:c((()=>[p(g(j),{class:"info-icon"},{default:c((()=>[p(g(q))])),_:1})])),_:1},8,["content"])])])),_:1},8,["label","formatter"]),p(g(C),{prop:"sparseMetricType",label:g(a)("kb.knowledge.hit.test.sparse.metric"),width:"170"},null,8,["label"]),p(g(C),{label:g(a)("kb.knowledge.hit.test.sparse.score"),width:"170",formatter:e=>_(e.sparseScore)},null,8,["label","formatter"]),p(g(C),{label:g(a)("kb.knowledge.hit.test.hybrid.score"),width:"170",formatter:e=>_(e.hybridScore??e.score)},null,8,["label","formatter"]),p(g(C),{label:g(a)("kb.textChunk"),width:"400"},{default:c((e=>[p(g(M),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:c((()=>[u("div",fe,m(e.row.textChunk),1)])),default:c((()=>[u("div",_e,m(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),p(g(C),{prop:"isFiltered",label:g(a)("kb.knowledge.hit.test.is.hit"),width:"150",formatter:e=>e.isFiltered?g(a)("common.no"):g(a)("common.yes")},null,8,["label","formatter"]),p(g(C),{prop:"dimension",label:g(a)("kb.dimension"),width:"130"},null,8,["label"]),p(g(C),{prop:"embeddingModel",label:g(a)("kb.embeddingModel"),width:"150"},null,8,["label"]),p(g(C),{prop:"embeddingProvider",label:g(a)("kb.embeddingProvider"),width:"150"},null,8,["label"])])),_:1},8,["data"])),[[s,o.value]])])]),u("div",Ee,[p(g(U),{ref_key:"formRef",ref:r,model:l.value,"label-width":"120px"},{default:c((()=>[p(g(N),{label:"TOP-K",prop:"topK",rules:[{required:!0,message:g(a)("common.input.required")}]},{default:c((()=>[p(g(A),{class:"top-k-input",modelValue:l.value.topK,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.topK=e),min:1,max:15,"controls-position":"right"},null,8,["modelValue"])])),_:1},8,["rules"]),p(g(N),{label:g(a)("kb.knowledge.hit.test.text"),prop:"text",class:"input-area",rules:[{required:!0,message:g(a)("common.input.required")}]},{default:c((()=>[p(g(S),{modelValue:l.value.text,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.text=e),class:"text-input",placeholder:g(a)("kb.knowledge.hit.test.text.placeholder"),type:"textarea",autosize:{minRows:5,maxRows:10},maxlength:4e3,"show-word-limit":"",onKeydown:k,onInput:y,onKeyup:R},null,8,["modelValue","placeholder"]),p(g(I),{type:"primary",onClick:E},{default:c((()=>[...t[2]||(t[2]=[v("Êèê‰∫§",-1)])])),_:1})])),_:1},8,["label","rules"])])),_:1},8,["model"])])])}}}),[["__scopeId","data-v-dceb1c4e"]]);const ke={class:"rag-settings-page"},ye={class:"section-title"},Re={class:"rag-weight-slider"},Te={class:"rag-weight-values"},xe={class:"settings-actions"};var Ve=V(l({__name:"RagSettings",setup(e){const t=s(!1),l=s(!1),r=s({topK:5,metricType:"COSINE",metricScoreExpr:"> 0.7",denseWeight:.5,sparseWeight:.5}),h=()=>{const e=r.value.denseWeight,a=r.value.sparseWeight,t=e+a;if(!Number.isFinite(t)||t<=0)return r.value.denseWeight=.5,void(r.value.sparseWeight=.5);r.value.denseWeight=e/t,r.value.sparseWeight=a/t},f=k({get:()=>Math.round(100*r.value.denseWeight),set:e=>{const a=Math.min(100,Math.max(0,e));r.value.denseWeight=a/100,r.value.sparseWeight=(100-a)/100}}),_=e=>{const t=Math.min(100,Math.max(0,Math.round(e))),l=100-t;return`${a("settings.rag.weight.dense")}: ${t}% / ${a("settings.rag.weight.sparse")}: ${l}%`},E=(e,a)=>{if(null==e)return a;const t=Number(e);return Number.isFinite(t)?t:a},w=async()=>{l.value=!0;try{h(),await X([{propertyName:"RETRIEVE_TOP_K",propertyValue:String(r.value.topK)},{propertyName:"RETRIEVE_METRIC_TYPE",propertyValue:r.value.metricType},{propertyName:"RETRIEVE_METRIC_SCORE_COMPARE_EXPR",propertyValue:r.value.metricScoreExpr},{propertyName:"RETRIEVE_DENSE_WEIGHT",propertyValue:String(r.value.denseWeight)},{propertyName:"RETRIEVE_SPARSE_WEIGHT",propertyValue:String(r.value.sparseWeight)}]),O.success(a("settings.save.success"))}catch(e){O.error(a("settings.save.failed"))}finally{l.value=!1}};return o((()=>{(async()=>{t.value=!0;try{const a=(e=await L(["RETRIEVE_TOP_K","RETRIEVE_METRIC_TYPE","RETRIEVE_METRIC_SCORE_COMPARE_EXPR","RETRIEVE_DENSE_WEIGHT","RETRIEVE_SPARSE_WEIGHT"]))?.data?.data?e.data.data:e?.data??{};r.value.topK=E("RETRIEVE_TOP_K"in a?a.RETRIEVE_TOP_K:void 0,r.value.topK),r.value.metricType=a.RETRIEVE_METRIC_TYPE||r.value.metricType,r.value.metricScoreExpr=a.RETRIEVE_METRIC_SCORE_COMPARE_EXPR||r.value.metricScoreExpr,r.value.denseWeight=E("RETRIEVE_DENSE_WEIGHT"in a?a.RETRIEVE_DENSE_WEIGHT:void 0,r.value.denseWeight),r.value.sparseWeight=E("RETRIEVE_SPARSE_WEIGHT"in a?a.RETRIEVE_SPARSE_WEIGHT:void 0,r.value.sparseWeight),h()}catch(l){O.error(a("settings.load.failed"))}finally{t.value=!1}var e})()})),(e,s)=>{const o=n("loading");return b((i(),d("div",ke,[u("div",ye,m(g(a)("settings.rag.section")),1),p(g(U),{model:r.value,"label-width":"220px"},{default:c((()=>[p(g(N),{label:g(a)("settings.rag.topk")},{default:c((()=>[p(g(A),{modelValue:r.value.topK,"onUpdate:modelValue":s[0]||(s[0]=e=>r.value.topK=e),min:1},null,8,["modelValue"])])),_:1},8,["label"]),p(g(N),{label:g(a)("settings.rag.metric.type.dense")},{default:c((()=>[p(g(D),{modelValue:r.value.metricType,"onUpdate:modelValue":s[1]||(s[1]=e=>r.value.metricType=e),class:"settings-select"},{default:c((()=>[p(g(H),{label:"COSINE",value:"COSINE"}),p(g(H),{label:"IP",value:"IP"}),p(g(H),{label:"L2",value:"L2"})])),_:1},8,["modelValue"])])),_:1},8,["label"]),p(g(N),{label:g(a)("settings.rag.metric.type.sparse")},{default:c((()=>[p(g(D),{"model-value":"BM25",class:"settings-select",disabled:""},{default:c((()=>[p(g(H),{label:"BM25",value:"BM25"})])),_:1})])),_:1},8,["label"]),p(g(N),{label:g(a)("settings.rag.weight.label")},{default:c((()=>[u("div",Re,[p(g(z),{modelValue:f.value,"onUpdate:modelValue":s[2]||(s[2]=e=>f.value=e),min:0,max:100,"show-tooltip":!0,"format-tooltip":_},null,8,["modelValue"]),u("div",Te,[u("span",null,m(g(a)("settings.rag.weight.dense"))+": "+m(f.value)+"%",1),u("span",null,m(g(a)("settings.rag.weight.sparse"))+": "+m(100-f.value)+"%",1)])])])),_:1},8,["label"]),p(g(N),{label:g(a)("settings.rag.metric.score.expr")},{default:c((()=>[p(g(S),{modelValue:r.value.metricScoreExpr,"onUpdate:modelValue":s[3]||(s[3]=e=>r.value.metricScoreExpr=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["model"]),u("div",xe,[p(g(I),{type:"primary",loading:l.value,onClick:w},{default:c((()=>[v(m(g(a)("settings.save")),1)])),_:1},8,["loading"])])])),[[o,t.value]])}}}),[["__scopeId","data-v-26bd28c5"]]);const Ie={class:"layout-container"},Se={class:"content-wrapper"},Ce={class:"main-content"},Me={class:"content-area"},Pe={key:1,class:"placeholder"};var We=V(l({__name:"index",setup(e){const t=s(!1),l=s("1"),r=y(ue),o=(e,a)=>{},n=(e,a)=>{},h=(e,a)=>{switch(l.value=e,e){default:r.value=ue;break;case"2":r.value=we;break;case"3":r.value=Ve}};return(e,s)=>(i(),d("div",Ie,[p(B),u("div",Se,[p(g(G),{"default-active":l.value,class:"el-menu-vertical-demo",collapse:t.value,onOpen:o,onClose:n,onSelect:h},{default:c((()=>[p(g(F),{index:"1"},{default:c((()=>[v(m(g(a)("kb.knowledge.list")),1)])),_:1}),p(g(F),{index:"2"},{default:c((()=>[v(m(g(a)("kb.knowledge.hit.test")),1)])),_:1}),p(g(F),{index:"3"},{default:c((()=>[v(m(g(a)("settings.rag.section")),1)])),_:1})])),_:1},8,["default-active","collapse"]),u("main",Ce,[u("div",Me,[r.value?(i(),f(R(r.value),{key:0})):(i(),d("div",Pe,[...s[0]||(s[0]=[u("p",null,"ËØ∑ÈÄâÊã©‰∏Ä‰∏™ËèúÂçïÈ°π",-1)])]))])])])]))}}),[["__scopeId","data-v-e012f15a"]]),Ke=Object.freeze(Object.defineProperty({__proto__:null,default:We},Symbol.toStringTag,{value:"Module"}));export{Ke as a,J as d,Z as i,Q as p};
