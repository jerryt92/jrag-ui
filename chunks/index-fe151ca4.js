import{h as e,t as a,_ as l}from"../index-80ed62ab.js";import{d as t,r as o,as as n,h as r,aj as s,o as i,c as d,a as u,V as c,K as p,a2 as v,O as m,u as h,ag as b,R as f,A as w,I as g,a9 as k,n as _,s as y,L as x}from"./@vue-59afabc7.js";import{g as C,p as j}from"./oem-517c1d66.js";import{_ as $}from"./plugin-vue_export-helper-3b0dab4c.js";import{f as T,d as V,p as K,q as z,r as P,s as S,i as I,a as M,t as R,m as U,c as q,u as D,g as O,v as F,w as A}from"./element-plus-0ba3eeaf.js";import{T as B}from"./topoBar-f0bc9c59.js";import{C as E}from"./@element-plus-2a802d7d.js";function L(e){if(!e||isNaN(e))return"";const a=new Date(e);let l=a.getMonth()+1;l<10&&(l="0"+l);let t=a.getDate();t<10&&(t="0"+t);let o=a.getHours();o<10&&(o="0"+o);let n=a.getMinutes();n<10&&(n="0"+n);let r=a.getSeconds();return r<10&&(r="0"+r),a.getFullYear()+"-"+l+"-"+t+" "+o+":"+n+":"+r}const H=a=>e.put(`/v1${C}rest/${j}/knowledge`,a),N=()=>{window.open(`/v1${C}rest/${j}/knowledge/json-template`)},Y=a=>{const l=new FormData;return l.append("jsonTemplate",a),e.post(`/v1${C}rest/${j}/knowledge/json-template`,l)};const G={class:"kb-table-container"},J={class:"header-actions"},Q={class:"btn-area"},W={class:"search-area"},X={class:"table-wrapper"},Z={class:"outline-preview"},ee={class:"outline-full"},ae={class:"text-chunk-preview"},le={class:"text-chunk-full"},te={class:"pagination-wrapper"};var oe=$(t({__name:"KnowledgeBaseList",setup(t){const y=o([]),x=o(!1),$=o(1),R=o(10),U=o(0),q=o(""),D=o([]),O=n((()=>l((()=>import("./KbAddDialog-e406e078.js")),["chunks/KbAddDialog-e406e078.js","assets/KbAddDialog-afed4f14.css","index-80ed62ab.js","assets/index-653b7e5e.css","chunks/@vue-59afabc7.js","chunks/vue-router-98dd41e0.js","chunks/axios-ff411c8f.js","chunks/element-plus-0ba3eeaf.js","chunks/@vueuse-29d1f792.js","chunks/@element-plus-2a802d7d.js","chunks/lodash-es-c824589e.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/@popperjs-19b81b33.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/oem-517c1d66.js","chunks/topoBar-f0bc9c59.js","assets/topoBar-a7b50646.css"]))),F=o(!1),A=async()=>{x.value=!0;try{const o=(await(a=($.value-1)*R.value,l=R.value+1,t=q.value,e.get(`/v1${C}rest/${j}/knowledge`,{params:{offset:a,limit:l,search:t}}))).data?.data||[];o.length>R.value?(y.value=o.slice(0,R.value),U.value=($.value+1)*R.value):(y.value=o,U.value=($.value-1)*R.value+o.length)}catch(o){y.value=[],U.value=0}finally{x.value=!1}var a,l,t},B=e=>{R.value=e,A()},E=e=>{$.value=e,A()},H=()=>{$.value=1,A()},N=async()=>{try{await _(),F.value=!0}catch(e){}},Y=()=>{F.value=!1,A()},oe=e=>{D.value=e},ne=()=>{0!==D.value.length&&I.confirm(`ç¡®è®¤åˆ é™¤é€‰ä¸­çš„ ${D.value.length} é¡¹æ•°æ®å—ï¼Ÿ`,"è­¦å‘Š",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}).then((async()=>{const a=D.value.map((e=>e.textChunkId));var l;await(l=a,e.post(`/v1${C}rest/${j}/knowledge/delete`,l)),M.success("åˆ é™¤æˆåŠŸ"),A()})).catch((()=>{}))};return r((()=>{A()})),(e,l)=>{const t=s("loading");return i(),d("div",G,[u("div",J,[u("div",Q,[c(h(T),{type:"primary",onClick:A},{default:p((()=>[v(m("ğŸ”„ "+h(a)("common.refresh")),1)])),_:1}),c(h(T),{type:"primary",onClick:N},{default:p((()=>[v(m("â• "+h(a)("common.add")),1)])),_:1}),c(h(T),{type:"danger",disabled:0===D.value.length,onClick:ne},{default:p((()=>[v(m("ğŸ—‘ï¸ "+h(a)("common.delete")),1)])),_:1},8,["disabled"])]),u("div",W,[c(h(V),{modelValue:q.value,"onUpdate:modelValue":l[0]||(l[0]=e=>q.value=e),placeholder:h(a)("common.search.placeholder.keyword"),clearable:"",style:{width:"240px"},onKeyup:b(H,["enter"]),onClear:H},null,8,["modelValue","placeholder"]),c(h(T),{type:"primary",onClick:H},{default:p((()=>[v(m("ğŸ”ï¸ "+h(a)("common.search")),1)])),_:1})])]),u("div",X,[f((i(),w(h(P),{ref:"tableRef",data:y.value,style:{width:"100%",height:"100%"},border:"",onSelectionChange:oe},{default:p((()=>[c(h(K),{type:"selection",width:"55",align:"center"}),c(h(K),{label:h(a)("kb.outline"),width:"300"},{default:p((e=>[c(h(z),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>{return[u("div",Z,m((a=e.row.outline,a&&0!==a.length?a.length<=3?a.join(" | "):`${a.slice(0,3).join(", ")}... (+${a.length-3}é¡¹)`:"-")),1)];var a})),default:p((()=>[u("div",ee,[(i(!0),d(g,null,k(e.row.outline,((e,a)=>(i(),d("div",{key:a},m(a+1)+". "+m(e),1)))),128))])])),_:2},1024)])),_:1},8,["label"]),c(h(K),{label:h(a)("kb.textChunk"),width:"300"},{default:p((e=>[c(h(z),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>[u("div",ae,m(e.row.textChunk),1)])),default:p((()=>[u("div",le,m(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),c(h(K),{prop:"description",label:h(a)("kb.description"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),c(h(K),{prop:"dimension",label:h(a)("kb.dimension"),width:"130"},null,8,["label"]),c(h(K),{prop:"embeddingModel",label:h(a)("kb.embeddingModel"),width:"150"},null,8,["label"]),c(h(K),{prop:"embeddingProvider",label:h(a)("kb.embeddingProvider"),width:"150"},null,8,["label"]),c(h(K),{prop:"createTime",label:h(a)("common.create.time"),width:"180"},{default:p((e=>[v(m(h(L)(e.row.createTime)),1)])),_:1},8,["label"]),c(h(K),{prop:"updateTime",label:h(a)("common.update.time"),width:"180"},{default:p((e=>[v(m(h(L)(e.row.updateTime)),1)])),_:1},8,["label"]),c(h(K),{prop:"createUsername",label:h(a)("kb.create.username"),width:"150"},null,8,["label"])])),_:1},8,["data"])),[[t,x.value]])]),u("div",te,[c(h(S),{"current-page":$.value,"onUpdate:currentPage":l[1]||(l[1]=e=>$.value=e),"page-size":R.value,"onUpdate:pageSize":l[2]||(l[2]=e=>R.value=e),"page-sizes":[10,20,50,100],total:U.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:B,onCurrentChange:E},null,8,["current-page","page-size","total"])]),c(h(O),{modelValue:F.value,"onUpdate:modelValue":l[3]||(l[3]=e=>F.value=e),onAddSuccess:Y},null,8,["modelValue"])])}}}),[["__scopeId","data-v-7fb40b10"]]);const ne={class:"hit-test-container"},re={class:"hit-test-result"},se={class:"table-wrapper"},ie={class:"header-with-tooltip"},de={class:"outline-preview"},ue={class:"outline-full"},ce={class:"text-chunk-full"},pe={class:"text-chunk-preview"},ve={class:"text-chunk-full"},me={class:"hit-test-form"};var he=$(t({__name:"HitTest",setup(l){const t=o({text:"",topK:5}),n=o(),r=o(!1),b=o([]),g=async()=>{n.value&&await n.value.validate((async a=>{if(a)try{r.value=!0;const a=await(l=t.value.text,o=t.value.topK,e.get(`/v1${C}rest/${j}/knowledge/retrieve`,{params:{"query-text":l,"top-k":o}}));b.value=a.data?.data||[]}catch(n){}finally{r.value=!1}var l,o}))};let k=!0;const _=e=>{"Enter"!==e.key||e.shiftKey||(k=!0,e.preventDefault())},y=()=>{k=!1},x=()=>{k&&(k=!1,g())};return(e,l)=>{const o=s("loading");return i(),d("div",ne,[u("div",re,[u("div",se,[f((i(),w(h(P),{ref:"tableRef",data:b.value,style:{width:"100%",height:"100%"},border:""},{default:p((()=>[c(h(K),{label:h(a)("kb.knowledge.hit.test.score"),width:"180",formatter:e=>e.score.toFixed(2)},{header:p((()=>[u("div",ie,[u("span",null,m(h(a)("kb.knowledge.hit.test.score")),1),c(h(R),{effect:"dark",placement:"top","raw-content":!0,content:h(a)("kb.knowledge.hit.test.score.tip")},{default:p((()=>[c(h(U),{class:"info-icon"},{default:p((()=>[c(h(E))])),_:1})])),_:1},8,["content"])])])),_:1},8,["label","formatter"]),c(h(K),{prop:"metricType",label:h(a)("kb.knowledge.hit.test.metricType"),width:"150"},null,8,["label"]),c(h(K),{label:h(a)("kb.outline"),width:"300"},{default:p((e=>[c(h(z),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>[u("div",de,m(e.row.outline),1)])),default:p((()=>[u("div",ue,[u("div",ce,m(e.row.outline),1)])])),_:2},1024)])),_:1},8,["label"]),c(h(K),{label:h(a)("kb.textChunk"),width:"400"},{default:p((e=>[c(h(z),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>[u("div",pe,m(e.row.textChunk),1)])),default:p((()=>[u("div",ve,m(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),c(h(K),{prop:"isFiltered",label:h(a)("kb.knowledge.hit.test.is.hit"),width:"150",formatter:e=>e.isFiltered?h(a)("common.no"):h(a)("common.yes")},null,8,["label","formatter"]),c(h(K),{prop:"dimension",label:h(a)("kb.dimension"),width:"130"},null,8,["label"]),c(h(K),{prop:"embeddingModel",label:h(a)("kb.embeddingModel"),width:"150"},null,8,["label"]),c(h(K),{prop:"embeddingProvider",label:h(a)("kb.embeddingProvider"),width:"150"},null,8,["label"])])),_:1},8,["data"])),[[o,r.value]])])]),u("div",me,[c(h(O),{ref_key:"formRef",ref:n,model:t.value,"label-width":"120px"},{default:p((()=>[c(h(q),{label:"TOP-K",prop:"topK",rules:[{required:!0,message:h(a)("common.input.required")}]},{default:p((()=>[c(h(D),{class:"top-k-input",modelValue:t.value.topK,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value.topK=e),min:1,max:15,"controls-position":"right"},null,8,["modelValue"])])),_:1},8,["rules"]),c(h(q),{label:h(a)("kb.knowledge.hit.test.text"),prop:"text",class:"input-area",rules:[{required:!0,message:h(a)("common.input.required")}]},{default:p((()=>[c(h(V),{modelValue:t.value.text,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.text=e),class:"text-input",placeholder:h(a)("kb.knowledge.hit.test.text.placeholder"),type:"textarea",autosize:{minRows:5,maxRows:10},maxlength:4e3,"show-word-limit":"",onKeydown:_,onInput:y,onKeyup:x},null,8,["modelValue","placeholder"]),c(h(T),{type:"primary",onClick:g},{default:p((()=>[...l[2]||(l[2]=[v("æäº¤",-1)])])),_:1})])),_:1},8,["label","rules"])])),_:1},8,["model"])])])}}}),[["__scopeId","data-v-7839fb97"]]);const be={class:"layout-container"},fe={class:"content-wrapper"},we={class:"main-content"},ge={class:"content-area"},ke={key:1,class:"placeholder"};var _e=$(t({__name:"index",setup(e){const l=o(!1),t=o("1"),n=y(oe),r=(e,a)=>{},s=(e,a)=>{},b=(e,a)=>{if(t.value=e,"2"===e)n.value=he;else n.value=oe};return(e,o)=>(i(),d("div",be,[c(B),u("div",fe,[c(h(A),{"default-active":t.value,class:"el-menu-vertical-demo",collapse:l.value,onOpen:r,onClose:s,onSelect:b},{default:p((()=>[c(h(F),{index:"1"},{default:p((()=>[v(m(h(a)("kb.knowledge.list")),1)])),_:1}),c(h(F),{index:"2"},{default:p((()=>[v(m(h(a)("kb.knowledge.hit.test")),1)])),_:1})])),_:1},8,["default-active","collapse"]),u("main",we,[u("div",ge,[n.value?(i(),w(x(n.value),{key:0})):(i(),d("div",ke,[...o[0]||(o[0]=[u("p",null,"è¯·é€‰æ‹©ä¸€ä¸ªèœå•é¡¹",-1)])]))])])])]))}}),[["__scopeId","data-v-17842f4b"]]),ye=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{ye as a,N as d,Y as i,H as p};
