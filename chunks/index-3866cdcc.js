import{h as e,t as a,_ as t}from"../index-ed01918a.js";import{d as l,r,at as o,f as n,aa as s,o as i,c as d,a as u,X as c,M as p,a4 as v,Q as m,u as h,al as g,U as b,A as f,K as _,ab as E,n as w,s as k,O as y}from"./@vue-bb747027.js";import{g as R,p as T}from"./oem-517c1d66.js";import{_ as x}from"./plugin-vue_export-helper-3b0dab4c.js";import{f as I,d as V,p as C,q as S,r as P,s as K,i as W,a as M,t as j,m as O,c as N,u as $,g as A,v as D,w as H}from"./element-plus-d2b1cdd3.js";import{T as U}from"./topoBar-31af6b48.js";import{C as z}from"./@element-plus-ccefd8d4.js";import{R as F,g as G,p as q}from"./property.api-43ad7018.js";function B(e){if(!e||isNaN(e))return"";const a=new Date(e);let t=a.getMonth()+1;t<10&&(t="0"+t);let l=a.getDate();l<10&&(l="0"+l);let r=a.getHours();r<10&&(r="0"+r);let o=a.getMinutes();o<10&&(o="0"+o);let n=a.getSeconds();return n<10&&(n="0"+n),a.getFullYear()+"-"+t+"-"+l+" "+r+":"+o+":"+n}const X=a=>e.post(`/v1${R}rest/${T}/knowledge/delete`,a),Y=a=>e.put(`/v1${R}rest/${T}/knowledge`,a),L=()=>{window.open(`/v1${R}rest/${T}/knowledge/json-template`)},Q=a=>{const t=new FormData;return t.append("jsonTemplate",a),e.post(`/v1${R}rest/${T}/knowledge/json-template`,t)};const J={class:"kb-table-container"},Z={class:"header-actions"},ee={class:"btn-area"},ae={class:"search-area"},te={class:"table-wrapper"},le={class:"outline-preview"},re={class:"outline-full"},oe={class:"text-chunk-preview"},ne={class:"text-chunk-full"},se={class:"pagination-wrapper"};var ie=x(l({__name:"KnowledgeBaseList",setup(l){const k=r([]),y=r(!1),x=r(1),j=r(10),O=r(0),N=r(""),$=r([]),A=o((()=>t((()=>import("./KbAddDialog-569f2266.js")),["chunks/KbAddDialog-569f2266.js","assets/KbAddDialog-92b5fee8.css","index-ed01918a.js","assets/index-e387b3d1.css","chunks/@vue-bb747027.js","chunks/vue-router-6370cc0f.js","chunks/axios-ff411c8f.js","chunks/element-plus-d2b1cdd3.js","chunks/@popperjs-66964824.js","chunks/@vueuse-09ca9f25.js","chunks/@element-plus-ccefd8d4.js","chunks/lodash-es-7a4ab7c3.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/QAForm-6583651e.js","assets/QAForm-15570946.css","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/oem-517c1d66.js","chunks/topoBar-31af6b48.js","assets/topoBar-2d62cac5.css","chunks/property.api-43ad7018.js","assets/property.api-64a2c9b3.css"]))),D=o((()=>t((()=>import("./KbEditDialog-2040254d.js")),["chunks/KbEditDialog-2040254d.js","assets/KbEditDialog-acbaba86.css","index-ed01918a.js","assets/index-e387b3d1.css","chunks/@vue-bb747027.js","chunks/vue-router-6370cc0f.js","chunks/axios-ff411c8f.js","chunks/element-plus-d2b1cdd3.js","chunks/@popperjs-66964824.js","chunks/@vueuse-09ca9f25.js","chunks/@element-plus-ccefd8d4.js","chunks/lodash-es-7a4ab7c3.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/QAForm-6583651e.js","assets/QAForm-15570946.css","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/oem-517c1d66.js","chunks/topoBar-31af6b48.js","assets/topoBar-2d62cac5.css","chunks/property.api-43ad7018.js","assets/property.api-64a2c9b3.css"]))),H=r(!1),U=r(!1),z=r(null),F=async()=>{y.value=!0;try{const r=(await(a=(x.value-1)*j.value,t=j.value+1,l=N.value,e.get(`/v1${R}rest/${T}/knowledge`,{params:{offset:a,limit:t,search:l}}))).data?.data||[];r.length>j.value?(k.value=r.slice(0,j.value),O.value=(x.value+1)*j.value):(k.value=r,O.value=(x.value-1)*j.value+r.length)}catch(r){k.value=[],O.value=0}finally{y.value=!1}var a,t,l},G=e=>{j.value=e,F()},q=e=>{x.value=e,F()},Y=()=>{x.value=1,F()},L=async()=>{try{await w(),H.value=!0}catch(e){}},Q=()=>{H.value=!1,F()},ie=()=>{U.value=!1,F()},de=e=>{$.value=e},ue=()=>{0!==$.value.length&&W.confirm(`Á°ÆËÆ§Âà†Èô§ÈÄâ‰∏≠ÁöÑ ${$.value.length} È°πÊï∞ÊçÆÂêóÔºü`,"Ë≠¶Âëä",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{const e=$.value.map((e=>e.textChunkId));await X(e),M.success("Âà†Èô§ÊàêÂäü"),F()})).catch((()=>{}))};return n((()=>{F()})),(e,t)=>{const l=s("loading");return i(),d("div",J,[u("div",Z,[u("div",ee,[c(h(I),{type:"primary",onClick:F},{default:p((()=>[v(m("üîÑ "+h(a)("common.refresh")),1)])),_:1}),c(h(I),{type:"primary",onClick:L},{default:p((()=>[v(m("‚ûï "+h(a)("common.add")),1)])),_:1}),c(h(I),{type:"danger",disabled:0===$.value.length,onClick:ue},{default:p((()=>[v(m("üóëÔ∏è "+h(a)("common.delete")),1)])),_:1},8,["disabled"])]),u("div",ae,[c(h(V),{modelValue:N.value,"onUpdate:modelValue":t[0]||(t[0]=e=>N.value=e),placeholder:h(a)("common.search.placeholder.keyword"),clearable:"",style:{width:"240px"},onKeyup:g(Y,["enter"]),onClear:Y},null,8,["modelValue","placeholder"]),c(h(I),{type:"primary",onClick:Y},{default:p((()=>[v(m("üîçÔ∏è "+h(a)("common.search")),1)])),_:1})])]),u("div",te,[b((i(),f(h(P),{ref:"tableRef",data:k.value,style:{width:"100%",height:"100%"},border:"",onSelectionChange:de},{default:p((()=>[c(h(C),{type:"selection",width:"55",align:"center"}),c(h(C),{label:h(a)("kb.outline"),width:"300"},{default:p((e=>[c(h(S),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>{return[u("div",le,m((a=e.row.outline,a&&0!==a.length?a.length<=3?a.join(" | "):`${a.slice(0,3).join(", ")}... (+${a.length-3}È°π)`:"-")),1)];var a})),default:p((()=>[u("div",re,[(i(!0),d(_,null,E(e.row.outline,((e,a)=>(i(),d("div",{key:a},m(a+1)+". "+m(e),1)))),128))])])),_:2},1024)])),_:1},8,["label"]),c(h(C),{label:h(a)("kb.textChunk"),width:"300"},{default:p((e=>[c(h(S),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>[u("div",oe,m(e.row.textChunk),1)])),default:p((()=>[u("div",ne,m(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),c(h(C),{prop:"description",label:h(a)("kb.description"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),c(h(C),{prop:"dimension",label:h(a)("kb.dimension"),width:"130"},null,8,["label"]),c(h(C),{prop:"embeddingModel",label:h(a)("kb.embeddingModel"),width:"150"},null,8,["label"]),c(h(C),{prop:"embeddingProvider",label:h(a)("kb.embeddingProvider"),width:"150"},null,8,["label"]),c(h(C),{prop:"createTime",label:h(a)("common.create.time"),width:"180"},{default:p((e=>[v(m(h(B)(e.row.createTime)),1)])),_:1},8,["label"]),c(h(C),{prop:"updateTime",label:h(a)("common.update.time"),width:"180"},{default:p((e=>[v(m(h(B)(e.row.updateTime)),1)])),_:1},8,["label"]),c(h(C),{prop:"createUsername",label:h(a)("kb.create.username"),width:"150"},null,8,["label"]),c(h(C),{label:h(a)("common.action"),width:"120",align:"center",fixed:"right"},{default:p((e=>[c(h(I),{type:"primary",link:"",onClick:a=>{return t=e.row,z.value={...t,outline:t.outline?[...t.outline]:[]},void(U.value=!0);var t}},{default:p((()=>[v(m(h(a)("common.edit")),1)])),_:1},8,["onClick"]),c(h(I),{type:"danger",link:"",onClick:a=>{var t;(t=e.row)?.textChunkId&&W.confirm("Á°ÆËÆ§Âà†Èô§ËØ•Êù°Êï∞ÊçÆÂêóÔºü","Ë≠¶Âëä",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{await X([t.textChunkId]),M.success("Âà†Èô§ÊàêÂäü"),F()})).catch((()=>{}))}},{default:p((()=>[v(m(h(a)("common.delete")),1)])),_:1},8,["onClick"])])),_:1},8,["label"])])),_:1},8,["data"])),[[l,y.value]])]),u("div",se,[c(h(K),{"current-page":x.value,"onUpdate:currentPage":t[1]||(t[1]=e=>x.value=e),"page-size":j.value,"onUpdate:pageSize":t[2]||(t[2]=e=>j.value=e),"page-sizes":[10,20,50,100],total:O.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:G,onCurrentChange:q},null,8,["current-page","page-size","total"])]),c(h(A),{modelValue:H.value,"onUpdate:modelValue":t[3]||(t[3]=e=>H.value=e),onAddSuccess:Q},null,8,["modelValue"]),c(h(D),{modelValue:U.value,"onUpdate:modelValue":t[4]||(t[4]=e=>U.value=e),knowledge:z.value,onEditSuccess:ie},null,8,["modelValue","knowledge"])])}}}),[["__scopeId","data-v-6e5e5748"]]);const de={class:"hit-test-container"},ue={class:"hit-test-result"},ce={class:"table-wrapper"},pe={class:"outline-preview"},ve={class:"outline-full"},me={class:"text-chunk-full"},he={class:"header-with-tooltip"},ge={class:"text-chunk-preview"},be={class:"text-chunk-full"},fe={class:"hit-test-form"};var _e=x(l({__name:"HitTest",setup(t){const l=r({text:"",topK:5}),o=r(),n=r(!1),g=r([]),_=e=>Number.isFinite(e)?e.toFixed(4):"-",E=async()=>{o.value&&await o.value.validate((async a=>{if(a)try{n.value=!0;const a=await(t=l.value.text,r=l.value.topK,e.get(`/v1${R}rest/${T}/knowledge/retrieve`,{params:{"query-text":t,"top-k":r}}));g.value=a.data?.data||[]}catch(o){}finally{n.value=!1}var t,r}))};let w=!0;const k=e=>{"Enter"!==e.key||e.shiftKey||(w=!0,e.preventDefault())},y=()=>{w=!1},x=()=>{w&&(w=!1,E())};return(e,t)=>{const r=s("loading");return i(),d("div",de,[u("div",ue,[u("div",ce,[b((i(),f(h(P),{ref:"tableRef",data:g.value,style:{width:"100%",height:"100%"},border:""},{default:p((()=>[c(h(C),{label:h(a)("kb.outline"),width:"300"},{default:p((e=>[c(h(S),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>[u("div",pe,m(e.row.outline),1)])),default:p((()=>[u("div",ve,[u("div",me,m(e.row.outline),1)])])),_:2},1024)])),_:1},8,["label"]),c(h(C),{prop:"denseMetricType",label:h(a)("kb.knowledge.hit.test.dense.metric"),width:"170"},null,8,["label"]),c(h(C),{label:h(a)("kb.knowledge.hit.test.dense.score"),width:"170",formatter:e=>_(e.denseScore)},{header:p((()=>[u("div",he,[u("span",null,m(h(a)("kb.knowledge.hit.test.dense.score")),1),c(h(j),{effect:"dark",placement:"top","raw-content":!0,content:h(a)("kb.knowledge.hit.test.score.tip")},{default:p((()=>[c(h(O),{class:"info-icon"},{default:p((()=>[c(h(z))])),_:1})])),_:1},8,["content"])])])),_:1},8,["label","formatter"]),c(h(C),{prop:"sparseMetricType",label:h(a)("kb.knowledge.hit.test.sparse.metric"),width:"170"},null,8,["label"]),c(h(C),{label:h(a)("kb.knowledge.hit.test.sparse.score"),width:"170",formatter:e=>_(e.sparseScore)},null,8,["label","formatter"]),c(h(C),{label:h(a)("kb.knowledge.hit.test.hybrid.score"),width:"170",formatter:e=>_(e.hybridScore??e.score)},null,8,["label","formatter"]),c(h(C),{label:h(a)("kb.textChunk"),width:"400"},{default:p((e=>[c(h(S),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>[u("div",ge,m(e.row.textChunk),1)])),default:p((()=>[u("div",be,m(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),c(h(C),{prop:"isFiltered",label:h(a)("kb.knowledge.hit.test.is.hit"),width:"150",formatter:e=>e.isFiltered?h(a)("common.no"):h(a)("common.yes")},null,8,["label","formatter"]),c(h(C),{prop:"dimension",label:h(a)("kb.dimension"),width:"130"},null,8,["label"]),c(h(C),{prop:"embeddingModel",label:h(a)("kb.embeddingModel"),width:"150"},null,8,["label"]),c(h(C),{prop:"embeddingProvider",label:h(a)("kb.embeddingProvider"),width:"150"},null,8,["label"])])),_:1},8,["data"])),[[r,n.value]])])]),u("div",fe,[c(h(A),{ref_key:"formRef",ref:o,model:l.value,"label-width":"120px"},{default:p((()=>[c(h(N),{label:"TOP-K",prop:"topK",rules:[{required:!0,message:h(a)("common.input.required")}]},{default:p((()=>[c(h($),{class:"top-k-input",modelValue:l.value.topK,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.topK=e),min:1,max:15,"controls-position":"right"},null,8,["modelValue"])])),_:1},8,["rules"]),c(h(N),{label:h(a)("kb.knowledge.hit.test.text"),prop:"text",class:"input-area",rules:[{required:!0,message:h(a)("common.input.required")}]},{default:p((()=>[c(h(V),{modelValue:l.value.text,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.text=e),class:"text-input",placeholder:h(a)("kb.knowledge.hit.test.text.placeholder"),type:"textarea",autosize:{minRows:5,maxRows:10},maxlength:4e3,"show-word-limit":"",onKeydown:k,onInput:y,onKeyup:x},null,8,["modelValue","placeholder"]),c(h(I),{type:"primary",onClick:E},{default:p((()=>[...t[2]||(t[2]=[v("Êèê‰∫§",-1)])])),_:1})])),_:1},8,["label","rules"])])),_:1},8,["model"])])])}}}),[["__scopeId","data-v-dceb1c4e"]]);const Ee={class:"rag-settings-page"};var we=x(l({__name:"RagSettings",setup(e){const t=r(!1),l=r(!1),o=r({topK:5,metricType:"COSINE",metricScoreExpr:"> 0.7",denseWeight:.5,sparseWeight:.5}),u=()=>{const e=o.value.denseWeight,a=o.value.sparseWeight,t=e+a;if(!Number.isFinite(t)||t<=0)return o.value.denseWeight=.5,void(o.value.sparseWeight=.5);o.value.denseWeight=e/t,o.value.sparseWeight=a/t},p=(e,a)=>{if(null==e)return a;const t=Number(e);return Number.isFinite(t)?t:a},v=async()=>{l.value=!0;try{u(),await q([{propertyName:"RETRIEVE_TOP_K",propertyValue:String(o.value.topK)},{propertyName:"RETRIEVE_METRIC_TYPE",propertyValue:o.value.metricType},{propertyName:"RETRIEVE_METRIC_SCORE_COMPARE_EXPR",propertyValue:o.value.metricScoreExpr},{propertyName:"RETRIEVE_DENSE_WEIGHT",propertyValue:String(o.value.denseWeight)},{propertyName:"RETRIEVE_SPARSE_WEIGHT",propertyValue:String(o.value.sparseWeight)}]),M.success(a("settings.save.success"))}catch(e){M.error(a("settings.save.failed"))}finally{l.value=!1}};return n((()=>{(async()=>{t.value=!0;try{const a=(e=await G(["RETRIEVE_TOP_K","RETRIEVE_METRIC_TYPE","RETRIEVE_METRIC_SCORE_COMPARE_EXPR","RETRIEVE_DENSE_WEIGHT","RETRIEVE_SPARSE_WEIGHT"]))?.data?.data?e.data.data:e?.data??{};o.value.topK=p("RETRIEVE_TOP_K"in a?a.RETRIEVE_TOP_K:void 0,o.value.topK),o.value.metricType=a.RETRIEVE_METRIC_TYPE||o.value.metricType,o.value.metricScoreExpr=a.RETRIEVE_METRIC_SCORE_COMPARE_EXPR||o.value.metricScoreExpr,o.value.denseWeight=p("RETRIEVE_DENSE_WEIGHT"in a?a.RETRIEVE_DENSE_WEIGHT:void 0,o.value.denseWeight),o.value.sparseWeight=p("RETRIEVE_SPARSE_WEIGHT"in a?a.RETRIEVE_SPARSE_WEIGHT:void 0,o.value.sparseWeight),u()}catch(l){M.error(a("settings.load.failed"))}finally{t.value=!1}var e})()})),(e,a)=>{const r=s("loading");return b((i(),d("div",Ee,[c(F,{form:o.value,saving:l.value,"show-title":"",onSave:v},null,8,["form","saving"])])),[[r,t.value]])}}}),[["__scopeId","data-v-e686ec30"]]);const ke={class:"layout-container"},ye={class:"content-wrapper"},Re={class:"main-content"},Te={class:"content-area"},xe={key:1,class:"placeholder"};var Ie=x(l({__name:"index",setup(e){const t=r(!1),l=r("1"),o=k(ie),n=(e,a)=>{},s=(e,a)=>{},g=(e,a)=>{switch(l.value=e,e){default:o.value=ie;break;case"2":o.value=_e;break;case"3":o.value=we}};return(e,r)=>(i(),d("div",ke,[c(U),u("div",ye,[c(h(H),{"default-active":l.value,class:"el-menu-vertical-demo",collapse:t.value,onOpen:n,onClose:s,onSelect:g},{default:p((()=>[c(h(D),{index:"1"},{default:p((()=>[v(m(h(a)("kb.knowledge.list")),1)])),_:1}),c(h(D),{index:"2"},{default:p((()=>[v(m(h(a)("kb.knowledge.hit.test")),1)])),_:1}),c(h(D),{index:"3"},{default:p((()=>[v(m(h(a)("settings.rag.section")),1)])),_:1})])),_:1},8,["default-active","collapse"]),u("main",Re,[u("div",Te,[o.value?(i(),f(y(o.value),{key:0})):(i(),d("div",xe,[...r[0]||(r[0]=[u("p",null,"ËØ∑ÈÄâÊã©‰∏Ä‰∏™ËèúÂçïÈ°π",-1)])]))])])])]))}}),[["__scopeId","data-v-e012f15a"]]),Ve=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"}));export{Ve as a,L as d,Q as i,Y as p};
