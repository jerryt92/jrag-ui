import{h as e,t as a,_ as l}from"../index-c9af1b46.js";import{d as t,r as o,at as n,f as r,aa as s,o as i,c as d,a as u,X as c,M as p,a4 as v,Q as m,u as b,al as h,U as f,A as w,K as g,ab as k,n as _,s as y,O as x}from"./@vue-bb747027.js";import{g as C,p as j}from"./oem-517c1d66.js";import{_ as $}from"./plugin-vue_export-helper-3b0dab4c.js";import{f as T,d as K,p as V,q as z,r as M,s as P,i as S,a as U,t as q,m as D,c as I,u as O,g as R,v as F,w as A}from"./element-plus-82bb4bf2.js";import{T as B}from"./topoBar-9475b172.js";import{C as E}from"./@element-plus-ccefd8d4.js";function H(e){if(!e||isNaN(e))return"";const a=new Date(e);let l=a.getMonth()+1;l<10&&(l="0"+l);let t=a.getDate();t<10&&(t="0"+t);let o=a.getHours();o<10&&(o="0"+o);let n=a.getMinutes();n<10&&(n="0"+n);let r=a.getSeconds();return r<10&&(r="0"+r),a.getFullYear()+"-"+l+"-"+t+" "+o+":"+n+":"+r}const L=a=>e.put(`/v1${C}rest/${j}/knowledge`,a),N=()=>{window.open(`/v1${C}rest/${j}/knowledge/json-template`)},Q=a=>{const l=new FormData;return l.append("jsonTemplate",a),e.post(`/v1${C}rest/${j}/knowledge/json-template`,l)};const X={class:"kb-table-container"},Y={class:"header-actions"},G={class:"btn-area"},J={class:"search-area"},W={class:"table-wrapper"},Z={class:"outline-preview"},ee={class:"outline-full"},ae={class:"text-chunk-preview"},le={class:"text-chunk-full"},te={class:"pagination-wrapper"};var oe=$(t({__name:"KnowledgeBaseList",setup(t){const y=o([]),x=o(!1),$=o(1),q=o(10),D=o(0),I=o(""),O=o([]),R=n((()=>l((()=>import("./KbAddDialog-eb882208.js")),["chunks/KbAddDialog-eb882208.js","assets/KbAddDialog-afed4f14.css","index-c9af1b46.js","assets/index-e387b3d1.css","chunks/@vue-bb747027.js","chunks/vue-router-6370cc0f.js","chunks/axios-ff411c8f.js","chunks/element-plus-82bb4bf2.js","chunks/@popperjs-66964824.js","chunks/@vueuse-09ca9f25.js","chunks/@element-plus-ccefd8d4.js","chunks/lodash-es-99da8f02.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/oem-517c1d66.js","chunks/topoBar-9475b172.js","assets/topoBar-2d62cac5.css"]))),F=o(!1),A=async()=>{x.value=!0;try{const o=(await(a=($.value-1)*q.value,l=q.value+1,t=I.value,e.get(`/v1${C}rest/${j}/knowledge`,{params:{offset:a,limit:l,search:t}}))).data?.data||[];o.length>q.value?(y.value=o.slice(0,q.value),D.value=($.value+1)*q.value):(y.value=o,D.value=($.value-1)*q.value+o.length)}catch(o){y.value=[],D.value=0}finally{x.value=!1}var a,l,t},B=e=>{q.value=e,A()},E=e=>{$.value=e,A()},L=()=>{$.value=1,A()},N=async()=>{try{await _(),F.value=!0}catch(e){}},Q=()=>{F.value=!1,A()},oe=e=>{O.value=e},ne=()=>{0!==O.value.length&&S.confirm(`Á°ÆËÆ§Âà†Èô§ÈÄâ‰∏≠ÁöÑ ${O.value.length} È°πÊï∞ÊçÆÂêóÔºü`,"Ë≠¶Âëä",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{const a=O.value.map((e=>e.textChunkId));var l;await(l=a,e.post(`/v1${C}rest/${j}/knowledge/delete`,l)),U.success("Âà†Èô§ÊàêÂäü"),A()})).catch((()=>{}))};return r((()=>{A()})),(e,l)=>{const t=s("loading");return i(),d("div",X,[u("div",Y,[u("div",G,[c(b(T),{type:"primary",onClick:A},{default:p((()=>[v(m("üîÑ "+b(a)("common.refresh")),1)])),_:1}),c(b(T),{type:"primary",onClick:N},{default:p((()=>[v(m("‚ûï "+b(a)("common.add")),1)])),_:1}),c(b(T),{type:"danger",disabled:0===O.value.length,onClick:ne},{default:p((()=>[v(m("üóëÔ∏è "+b(a)("common.delete")),1)])),_:1},8,["disabled"])]),u("div",J,[c(b(K),{modelValue:I.value,"onUpdate:modelValue":l[0]||(l[0]=e=>I.value=e),placeholder:b(a)("common.search.placeholder.keyword"),clearable:"",style:{width:"240px"},onKeyup:h(L,["enter"]),onClear:L},null,8,["modelValue","placeholder"]),c(b(T),{type:"primary",onClick:L},{default:p((()=>[v(m("üîçÔ∏è "+b(a)("common.search")),1)])),_:1})])]),u("div",W,[f((i(),w(b(M),{ref:"tableRef",data:y.value,style:{width:"100%",height:"100%"},border:"",onSelectionChange:oe},{default:p((()=>[c(b(V),{type:"selection",width:"55",align:"center"}),c(b(V),{label:b(a)("kb.outline"),width:"300"},{default:p((e=>[c(b(z),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>{return[u("div",Z,m((a=e.row.outline,a&&0!==a.length?a.length<=3?a.join(" | "):`${a.slice(0,3).join(", ")}... (+${a.length-3}È°π)`:"-")),1)];var a})),default:p((()=>[u("div",ee,[(i(!0),d(g,null,k(e.row.outline,((e,a)=>(i(),d("div",{key:a},m(a+1)+". "+m(e),1)))),128))])])),_:2},1024)])),_:1},8,["label"]),c(b(V),{label:b(a)("kb.textChunk"),width:"300"},{default:p((e=>[c(b(z),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>[u("div",ae,m(e.row.textChunk),1)])),default:p((()=>[u("div",le,m(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),c(b(V),{prop:"description",label:b(a)("kb.description"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),c(b(V),{prop:"dimension",label:b(a)("kb.dimension"),width:"130"},null,8,["label"]),c(b(V),{prop:"embeddingModel",label:b(a)("kb.embeddingModel"),width:"150"},null,8,["label"]),c(b(V),{prop:"embeddingProvider",label:b(a)("kb.embeddingProvider"),width:"150"},null,8,["label"]),c(b(V),{prop:"createTime",label:b(a)("common.create.time"),width:"180"},{default:p((e=>[v(m(b(H)(e.row.createTime)),1)])),_:1},8,["label"]),c(b(V),{prop:"updateTime",label:b(a)("common.update.time"),width:"180"},{default:p((e=>[v(m(b(H)(e.row.updateTime)),1)])),_:1},8,["label"]),c(b(V),{prop:"createUsername",label:b(a)("kb.create.username"),width:"150"},null,8,["label"])])),_:1},8,["data"])),[[t,x.value]])]),u("div",te,[c(b(P),{"current-page":$.value,"onUpdate:currentPage":l[1]||(l[1]=e=>$.value=e),"page-size":q.value,"onUpdate:pageSize":l[2]||(l[2]=e=>q.value=e),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:B,onCurrentChange:E},null,8,["current-page","page-size","total"])]),c(b(R),{modelValue:F.value,"onUpdate:modelValue":l[3]||(l[3]=e=>F.value=e),onAddSuccess:Q},null,8,["modelValue"])])}}}),[["__scopeId","data-v-7fb40b10"]]);const ne={class:"hit-test-container"},re={class:"hit-test-result"},se={class:"table-wrapper"},ie={class:"header-with-tooltip"},de={class:"outline-preview"},ue={class:"outline-full"},ce={class:"text-chunk-full"},pe={class:"text-chunk-preview"},ve={class:"text-chunk-full"},me={class:"hit-test-form"};var be=$(t({__name:"HitTest",setup(l){const t=o({text:"",topK:5}),n=o(),r=o(!1),h=o([]),g=async()=>{n.value&&await n.value.validate((async a=>{if(a)try{r.value=!0;const a=await(l=t.value.text,o=t.value.topK,e.get(`/v1${C}rest/${j}/knowledge/retrieve`,{params:{"query-text":l,"top-k":o}}));h.value=a.data?.data||[]}catch(n){}finally{r.value=!1}var l,o}))};let k=!0;const _=e=>{"Enter"!==e.key||e.shiftKey||(k=!0,e.preventDefault())},y=()=>{k=!1},x=()=>{k&&(k=!1,g())};return(e,l)=>{const o=s("loading");return i(),d("div",ne,[u("div",re,[u("div",se,[f((i(),w(b(M),{ref:"tableRef",data:h.value,style:{width:"100%",height:"100%"},border:""},{default:p((()=>[c(b(V),{label:b(a)("kb.knowledge.hit.test.score"),width:"180",formatter:e=>e.score.toFixed(2)},{header:p((()=>[u("div",ie,[u("span",null,m(b(a)("kb.knowledge.hit.test.score")),1),c(b(q),{effect:"dark",placement:"top","raw-content":!0,content:b(a)("kb.knowledge.hit.test.score.tip")},{default:p((()=>[c(b(D),{class:"info-icon"},{default:p((()=>[c(b(E))])),_:1})])),_:1},8,["content"])])])),_:1},8,["label","formatter"]),c(b(V),{prop:"metricType",label:b(a)("kb.knowledge.hit.test.metricType"),width:"150"},null,8,["label"]),c(b(V),{label:b(a)("kb.outline"),width:"300"},{default:p((e=>[c(b(z),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>[u("div",de,m(e.row.outline),1)])),default:p((()=>[u("div",ue,[u("div",ce,m(e.row.outline),1)])])),_:2},1024)])),_:1},8,["label"]),c(b(V),{label:b(a)("kb.textChunk"),width:"400"},{default:p((e=>[c(b(z),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:p((()=>[u("div",pe,m(e.row.textChunk),1)])),default:p((()=>[u("div",ve,m(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),c(b(V),{prop:"isFiltered",label:b(a)("kb.knowledge.hit.test.is.hit"),width:"150",formatter:e=>e.isFiltered?b(a)("common.no"):b(a)("common.yes")},null,8,["label","formatter"]),c(b(V),{prop:"dimension",label:b(a)("kb.dimension"),width:"130"},null,8,["label"]),c(b(V),{prop:"embeddingModel",label:b(a)("kb.embeddingModel"),width:"150"},null,8,["label"]),c(b(V),{prop:"embeddingProvider",label:b(a)("kb.embeddingProvider"),width:"150"},null,8,["label"])])),_:1},8,["data"])),[[o,r.value]])])]),u("div",me,[c(b(R),{ref_key:"formRef",ref:n,model:t.value,"label-width":"120px"},{default:p((()=>[c(b(I),{label:"TOP-K",prop:"topK",rules:[{required:!0,message:b(a)("common.input.required")}]},{default:p((()=>[c(b(O),{class:"top-k-input",modelValue:t.value.topK,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value.topK=e),min:1,max:15,"controls-position":"right"},null,8,["modelValue"])])),_:1},8,["rules"]),c(b(I),{label:b(a)("kb.knowledge.hit.test.text"),prop:"text",class:"input-area",rules:[{required:!0,message:b(a)("common.input.required")}]},{default:p((()=>[c(b(K),{modelValue:t.value.text,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.text=e),class:"text-input",placeholder:b(a)("kb.knowledge.hit.test.text.placeholder"),type:"textarea",autosize:{minRows:5,maxRows:10},maxlength:4e3,"show-word-limit":"",onKeydown:_,onInput:y,onKeyup:x},null,8,["modelValue","placeholder"]),c(b(T),{type:"primary",onClick:g},{default:p((()=>[...l[2]||(l[2]=[v("Êèê‰∫§",-1)])])),_:1})])),_:1},8,["label","rules"])])),_:1},8,["model"])])])}}}),[["__scopeId","data-v-7839fb97"]]);const he={class:"layout-container"},fe={class:"content-wrapper"},we={class:"main-content"},ge={class:"content-area"},ke={key:1,class:"placeholder"};var _e=$(t({__name:"index",setup(e){const l=o(!1),t=o("1"),n=y(oe),r=(e,a)=>{},s=(e,a)=>{},h=(e,a)=>{if(t.value=e,"2"===e)n.value=be;else n.value=oe};return(e,o)=>(i(),d("div",he,[c(B),u("div",fe,[c(b(A),{"default-active":t.value,class:"el-menu-vertical-demo",collapse:l.value,onOpen:r,onClose:s,onSelect:h},{default:p((()=>[c(b(F),{index:"1"},{default:p((()=>[v(m(b(a)("kb.knowledge.list")),1)])),_:1}),c(b(F),{index:"2"},{default:p((()=>[v(m(b(a)("kb.knowledge.hit.test")),1)])),_:1})])),_:1},8,["default-active","collapse"]),u("main",we,[u("div",ge,[n.value?(i(),w(x(n.value),{key:0})):(i(),d("div",ke,[...o[0]||(o[0]=[u("p",null,"ËØ∑ÈÄâÊã©‰∏Ä‰∏™ËèúÂçïÈ°π",-1)])]))])])])]))}}),[["__scopeId","data-v-17842f4b"]]),ye=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{ye as a,N as d,Q as i,L as p};
