import{e,g as a,p as t,t as l,_ as s}from"../index-b8d32494.js";import{d as n,r,at as i,f as o,aa as d,o as u,c,a as p,X as v,M as m,a4 as h,Q as g,u as E,al as b,U as _,A as f,K as w,ab as k,n as R,j as y,s as T,O as I}from"./@vue-bb747027.js";import{_ as x}from"./plugin-vue_export-helper-3b0dab4c.js";import{f as S,d as V,p as W,q as C,r as P,s as M,i as K,a as N,t as $,u as j,m as O,c as H,v as A,g as D,w as G,x as F}from"./element-plus-06bb7c4a.js";import{T as U}from"./topoBar-627ae9ed.js";import{g as z,R as q,p as B}from"./RagSettingsPanel-9cdc9d00.js";import{C as X}from"./@element-plus-ccefd8d4.js";function Y(e){if(!e||isNaN(e))return"";const a=new Date(e);let t=a.getMonth()+1;t<10&&(t="0"+t);let l=a.getDate();l<10&&(l="0"+l);let s=a.getHours();s<10&&(s="0"+s);let n=a.getMinutes();n<10&&(n="0"+n);let r=a.getSeconds();return r<10&&(r="0"+r),a.getFullYear()+"-"+t+"-"+l+" "+s+":"+n+":"+r}const L=l=>e.post(`/v1${a}rest/${t}/knowledge/delete`,l),Q=l=>e.put(`/v1${a}rest/${t}/knowledge`,l),J=()=>{window.open(`/v1${a}rest/${t}/knowledge/json-template`)},Z=l=>{const s=new FormData;return s.append("jsonTemplate",l),e.post(`/v1${a}rest/${t}/knowledge/json-template`,s)};const ee={class:"kb-table-container"},ae={class:"header-actions"},te={class:"btn-area"},le={class:"search-area"},se={class:"table-wrapper"},ne={class:"outline-preview"},re={class:"outline-full"},ie={class:"text-chunk-preview"},oe={class:"text-chunk-full"},de={class:"pagination-wrapper"};var ue=x(n({__name:"KnowledgeBaseList",setup(n){const y=r([]),T=r(!1),I=r(1),x=r(10),$=r(0),j=r(""),O=r([]),H=i((()=>s((()=>import("./KbAddDialog-cc58df69.js")),["chunks/KbAddDialog-cc58df69.js","assets/KbAddDialog-92b5fee8.css","index-b8d32494.js","assets/index-e387b3d1.css","chunks/@vue-bb747027.js","chunks/vue-router-6370cc0f.js","chunks/axios-ff411c8f.js","chunks/element-plus-06bb7c4a.js","chunks/@popperjs-66964824.js","chunks/@vueuse-09ca9f25.js","chunks/@element-plus-ccefd8d4.js","chunks/lodash-es-7a4ab7c3.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/QAForm-099e8541.js","assets/QAForm-15570946.css","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/topoBar-627ae9ed.js","assets/topoBar-ac046675.css","chunks/RagSettingsPanel-9cdc9d00.js","assets/RagSettingsPanel-29dcc37d.css"]))),A=i((()=>s((()=>import("./KbEditDialog-31eccbc1.js")),["chunks/KbEditDialog-31eccbc1.js","assets/KbEditDialog-acbaba86.css","index-b8d32494.js","assets/index-e387b3d1.css","chunks/@vue-bb747027.js","chunks/vue-router-6370cc0f.js","chunks/axios-ff411c8f.js","chunks/element-plus-06bb7c4a.js","chunks/@popperjs-66964824.js","chunks/@vueuse-09ca9f25.js","chunks/@element-plus-ccefd8d4.js","chunks/lodash-es-7a4ab7c3.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/QAForm-099e8541.js","assets/QAForm-15570946.css","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/topoBar-627ae9ed.js","assets/topoBar-ac046675.css","chunks/RagSettingsPanel-9cdc9d00.js","assets/RagSettingsPanel-29dcc37d.css"]))),D=r(!1),G=r(!1),F=r(null),U=async()=>{T.value=!0;try{const r=(await(l=(I.value-1)*x.value,s=x.value+1,n=j.value,e.get(`/v1${a}rest/${t}/knowledge`,{params:{offset:l,limit:s,search:n}}))).data?.data||[];r.length>x.value?(y.value=r.slice(0,x.value),$.value=(I.value+1)*x.value):(y.value=r,$.value=(I.value-1)*x.value+r.length)}catch(r){y.value=[],$.value=0}finally{T.value=!1}var l,s,n},z=e=>{x.value=e,U()},q=e=>{I.value=e,U()},B=()=>{I.value=1,U()},X=async()=>{try{await R(),D.value=!0}catch(e){}},Q=()=>{D.value=!1,U()},J=()=>{G.value=!1,U()},Z=e=>{O.value=e},ue=()=>{0!==O.value.length&&K.confirm(`Á°ÆËÆ§Âà†Èô§ÈÄâ‰∏≠ÁöÑ ${O.value.length} È°πÊï∞ÊçÆÂêóÔºü`,"Ë≠¶Âëä",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{const e=O.value.map((e=>e.textChunkId));await L(e),N.success("Âà†Èô§ÊàêÂäü"),U()})).catch((()=>{}))};return o((()=>{U()})),(e,a)=>{const t=d("loading");return u(),c("div",ee,[p("div",ae,[p("div",te,[v(E(S),{type:"primary",onClick:U},{default:m((()=>[h(g("üîÑ "+E(l)("common.refresh")),1)])),_:1}),v(E(S),{type:"primary",onClick:X},{default:m((()=>[h(g("‚ûï "+E(l)("common.add")),1)])),_:1}),v(E(S),{type:"danger",disabled:0===O.value.length,onClick:ue},{default:m((()=>[h(g("üóëÔ∏è "+E(l)("common.delete")),1)])),_:1},8,["disabled"])]),p("div",le,[v(E(V),{modelValue:j.value,"onUpdate:modelValue":a[0]||(a[0]=e=>j.value=e),placeholder:E(l)("common.search.placeholder.keyword"),clearable:"",style:{width:"240px"},onKeyup:b(B,["enter"]),onClear:B},null,8,["modelValue","placeholder"]),v(E(S),{type:"primary",onClick:B},{default:m((()=>[h(g("üîçÔ∏è "+E(l)("common.search")),1)])),_:1})])]),p("div",se,[_((u(),f(E(P),{ref:"tableRef",data:y.value,style:{width:"100%",height:"100%"},border:"",onSelectionChange:Z},{default:m((()=>[v(E(W),{type:"selection",width:"55",align:"center"}),v(E(W),{label:E(l)("kb.outline"),width:"300"},{default:m((e=>[v(E(C),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:m((()=>{return[p("div",ne,g((a=e.row.outline,a&&0!==a.length?a.length<=3?a.join(" | "):`${a.slice(0,3).join(", ")}... (+${a.length-3}È°π)`:"-")),1)];var a})),default:m((()=>[p("div",re,[(u(!0),c(w,null,k(e.row.outline,((e,a)=>(u(),c("div",{key:a},g(a+1)+". "+g(e),1)))),128))])])),_:2},1024)])),_:1},8,["label"]),v(E(W),{label:E(l)("kb.textChunk"),width:"300"},{default:m((e=>[v(E(C),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:m((()=>[p("div",ie,g(e.row.textChunk),1)])),default:m((()=>[p("div",oe,g(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),v(E(W),{prop:"description",label:E(l)("kb.description"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),v(E(W),{prop:"dimension",label:E(l)("kb.dimension"),width:"130"},null,8,["label"]),v(E(W),{prop:"embeddingModel",label:E(l)("kb.embeddingModel"),width:"150"},null,8,["label"]),v(E(W),{prop:"embeddingProvider",label:E(l)("kb.embeddingProvider"),width:"150"},null,8,["label"]),v(E(W),{prop:"createTime",label:E(l)("common.create.time"),width:"180"},{default:m((e=>[h(g(E(Y)(e.row.createTime)),1)])),_:1},8,["label"]),v(E(W),{prop:"updateTime",label:E(l)("common.update.time"),width:"180"},{default:m((e=>[h(g(E(Y)(e.row.updateTime)),1)])),_:1},8,["label"]),v(E(W),{prop:"createUsername",label:E(l)("kb.create.username"),width:"150"},null,8,["label"]),v(E(W),{label:E(l)("common.action"),width:"120",align:"center",fixed:"right"},{default:m((e=>[v(E(S),{type:"primary",link:"",onClick:a=>{return t=e.row,F.value={...t,outline:t.outline?[...t.outline]:[]},void(G.value=!0);var t}},{default:m((()=>[h(g(E(l)("common.edit")),1)])),_:1},8,["onClick"]),v(E(S),{type:"danger",link:"",onClick:a=>{var t;(t=e.row)?.textChunkId&&K.confirm("Á°ÆËÆ§Âà†Èô§ËØ•Êù°Êï∞ÊçÆÂêóÔºü","Ë≠¶Âëä",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{await L([t.textChunkId]),N.success("Âà†Èô§ÊàêÂäü"),U()})).catch((()=>{}))}},{default:m((()=>[h(g(E(l)("common.delete")),1)])),_:1},8,["onClick"])])),_:1},8,["label"])])),_:1},8,["data"])),[[t,T.value]])]),p("div",de,[v(E(M),{"current-page":I.value,"onUpdate:currentPage":a[1]||(a[1]=e=>I.value=e),"page-size":x.value,"onUpdate:pageSize":a[2]||(a[2]=e=>x.value=e),"page-sizes":[10,20,50,100],total:$.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:z,onCurrentChange:q},null,8,["current-page","page-size","total"])]),v(E(H),{modelValue:D.value,"onUpdate:modelValue":a[3]||(a[3]=e=>D.value=e),onAddSuccess:Q},null,8,["modelValue"]),v(E(A),{modelValue:G.value,"onUpdate:modelValue":a[4]||(a[4]=e=>G.value=e),knowledge:F.value,onEditSuccess:J},null,8,["modelValue","knowledge"])])}}}),[["__scopeId","data-v-6e5e5748"]]);const ce={class:"hit-test-container"},pe={class:"hit-test-result"},ve={class:"table-wrapper"},me={class:"table-header"},he={class:"table-header-title"},ge={class:"rag-weight-slider compact"},Ee={class:"rag-weight-values"},be={class:"outline-preview"},_e={class:"outline-full"},fe={class:"text-chunk-full"},we={class:"header-with-tooltip"},ke={class:"header-with-tooltip"},Re={class:"text-chunk-preview"},ye={class:"text-chunk-full"},Te={class:"hit-test-form"};var Ie=x(n({__name:"HitTest",setup(s){const n=r({text:"",topK:5}),i=r(),b=r(!1),w=r([]),k=r({denseWeight:.5,sparseWeight:.5}),R=(e,a)=>{if(null==e)return a;const t=Number(e);return Number.isFinite(t)?t:a},T=y((()=>Math.round(100*k.value.denseWeight))),I=y((()=>100-T.value)),x=e=>{const a=Math.min(100,Math.max(0,Math.round(e))),t=100-a;return`${l("settings.rag.weight.dense")}: ${a}% / ${l("settings.rag.weight.sparse")}: ${t}%`},M=e=>Number.isFinite(e)?e.toFixed(4):"-",K=async()=>{i.value&&await i.value.validate((async l=>{if(l)try{b.value=!0;const l=await(s=n.value.text,r=n.value.topK,e.get(`/v1${a}rest/${t}/knowledge/retrieve`,{params:{"query-text":s,"top-k":r}}));w.value=l.data?.data||[]}catch(i){}finally{b.value=!1}var s,r}))};let N=!0;const G=e=>{"Enter"!==e.key||e.shiftKey||(N=!0,e.preventDefault())},F=()=>{N=!1},U=()=>{N&&(N=!1,K())},q=async()=>{try{const e=(e=>e?.data?.data?e.data.data:e?.data??{})(await z(["RETRIEVE_DENSE_WEIGHT","RETRIEVE_SPARSE_WEIGHT"]));k.value.denseWeight=R("RETRIEVE_DENSE_WEIGHT"in e?e.RETRIEVE_DENSE_WEIGHT:void 0,k.value.denseWeight),k.value.sparseWeight=R("RETRIEVE_SPARSE_WEIGHT"in e?e.RETRIEVE_SPARSE_WEIGHT:void 0,k.value.sparseWeight),(()=>{const e=k.value.denseWeight,a=k.value.sparseWeight,t=e+a;if(!Number.isFinite(t)||t<=0)return k.value.denseWeight=.5,void(k.value.sparseWeight=.5);k.value.denseWeight=e/t,k.value.sparseWeight=a/t})()}catch(e){}};return o((()=>{q()})),(e,a)=>{const t=d("loading");return u(),c("div",ce,[p("div",pe,[p("div",ve,[p("div",me,[p("span",he,g(E(l)("settings.rag.weight.label")),1),p("div",ge,[v(E($),{"model-value":T.value,min:0,max:100,"show-tooltip":!0,"format-tooltip":x,disabled:""},null,8,["model-value"]),p("div",Ee,[p("span",null,g(E(l)("settings.rag.weight.dense"))+": "+g(T.value)+"%",1),p("span",null,g(E(l)("settings.rag.weight.sparse"))+": "+g(I.value)+"%",1)])])]),_((u(),f(E(P),{ref:"tableRef",data:w.value,style:{width:"100%",height:"100%"},border:""},{default:m((()=>[v(E(W),{label:E(l)("kb.outline"),width:"300"},{default:m((e=>[v(E(C),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:m((()=>[p("div",be,g(e.row.outline),1)])),default:m((()=>[p("div",_e,[p("div",fe,g(e.row.outline),1)])])),_:2},1024)])),_:1},8,["label"]),v(E(W),{prop:"denseMetricType",label:E(l)("kb.knowledge.hit.test.dense.metric"),width:"170"},null,8,["label"]),v(E(W),{label:E(l)("kb.knowledge.hit.test.dense.score"),width:"170",formatter:e=>M(e.denseScore)},{header:m((()=>[p("div",we,[p("span",null,g(E(l)("kb.knowledge.hit.test.dense.score")),1),v(E(j),{effect:"dark",placement:"top","raw-content":!0,content:E(l)("kb.knowledge.hit.test.dense.score.tip")},{default:m((()=>[v(E(O),{class:"info-icon"},{default:m((()=>[v(E(X))])),_:1})])),_:1},8,["content"])])])),_:1},8,["label","formatter"]),v(E(W),{prop:"sparseMetricType",label:E(l)("kb.knowledge.hit.test.sparse.metric"),width:"170"},null,8,["label"]),v(E(W),{label:E(l)("kb.knowledge.hit.test.sparse.score"),width:"170",formatter:e=>M(e.sparseScore)},{header:m((()=>[p("div",ke,[p("span",null,g(E(l)("kb.knowledge.hit.test.sparse.score")),1),v(E(j),{effect:"dark",placement:"top","raw-content":!0,content:E(l)("kb.knowledge.hit.test.sparse.score.tip")},{default:m((()=>[v(E(O),{class:"info-icon"},{default:m((()=>[v(E(X))])),_:1})])),_:1},8,["content"])])])),_:1},8,["label","formatter"]),v(E(W),{label:E(l)("kb.knowledge.hit.test.hybrid.score"),width:"170",formatter:e=>M(e.hybridScore??e.score)},null,8,["label","formatter"]),v(E(W),{prop:"isFiltered",label:E(l)("kb.knowledge.hit.test.is.hit"),width:"150",formatter:e=>e.isFiltered?E(l)("common.no"):E(l)("common.yes")},null,8,["label","formatter"]),v(E(W),{label:E(l)("kb.textChunk"),width:"400"},{default:m((e=>[v(E(C),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:m((()=>[p("div",Re,g(e.row.textChunk),1)])),default:m((()=>[p("div",ye,g(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),v(E(W),{prop:"dimension",label:E(l)("kb.dimension"),width:"130"},null,8,["label"]),v(E(W),{prop:"embeddingModel",label:E(l)("kb.embeddingModel"),width:"150"},null,8,["label"]),v(E(W),{prop:"embeddingProvider",label:E(l)("kb.embeddingProvider"),width:"150"},null,8,["label"])])),_:1},8,["data"])),[[t,b.value]])])]),p("div",Te,[v(E(D),{ref_key:"formRef",ref:i,model:n.value,"label-width":"120px"},{default:m((()=>[v(E(H),{label:"TOP-K",prop:"topK",rules:[{required:!0,message:E(l)("common.input.required")}]},{default:m((()=>[v(E(A),{class:"top-k-input",modelValue:n.value.topK,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value.topK=e),min:1,max:15,"controls-position":"right"},null,8,["modelValue"])])),_:1},8,["rules"]),v(E(H),{label:E(l)("kb.knowledge.hit.test.text"),prop:"text",class:"input-area",rules:[{required:!0,message:E(l)("common.input.required")}]},{default:m((()=>[v(E(V),{modelValue:n.value.text,"onUpdate:modelValue":a[1]||(a[1]=e=>n.value.text=e),class:"text-input",placeholder:E(l)("kb.knowledge.hit.test.text.placeholder"),type:"textarea",autosize:{minRows:5,maxRows:10},maxlength:4e3,"show-word-limit":"",onKeydown:G,onInput:F,onKeyup:U},null,8,["modelValue","placeholder"]),v(E(S),{type:"primary",onClick:K},{default:m((()=>[...a[2]||(a[2]=[h("Êèê‰∫§",-1)])])),_:1})])),_:1},8,["label","rules"])])),_:1},8,["model"])])])}}}),[["__scopeId","data-v-5e691982"]]);const xe={class:"rag-settings-page"};var Se=x(n({__name:"RagSettings",setup(e){const a=r(!1),t=r(!1),s=r({topK:5,metricType:"COSINE",metricScoreExpr:"> 0.7",denseWeight:.5,sparseWeight:.5}),n=()=>{const e=s.value.denseWeight,a=s.value.sparseWeight,t=e+a;if(!Number.isFinite(t)||t<=0)return s.value.denseWeight=.5,void(s.value.sparseWeight=.5);s.value.denseWeight=e/t,s.value.sparseWeight=a/t},i=(e,a)=>{if(null==e)return a;const t=Number(e);return Number.isFinite(t)?t:a},p=async()=>{t.value=!0;try{n(),await B([{propertyName:"RETRIEVE_TOP_K",propertyValue:String(s.value.topK)},{propertyName:"RETRIEVE_METRIC_TYPE",propertyValue:s.value.metricType},{propertyName:"RETRIEVE_METRIC_SCORE_COMPARE_EXPR",propertyValue:s.value.metricScoreExpr},{propertyName:"RETRIEVE_DENSE_WEIGHT",propertyValue:String(s.value.denseWeight)},{propertyName:"RETRIEVE_SPARSE_WEIGHT",propertyValue:String(s.value.sparseWeight)}]),N.success(l("settings.save.success"))}catch(e){N.error(l("settings.save.failed"))}finally{t.value=!1}};return o((()=>{(async()=>{a.value=!0;try{const t=(e=await z(["RETRIEVE_TOP_K","RETRIEVE_METRIC_TYPE","RETRIEVE_METRIC_SCORE_COMPARE_EXPR","RETRIEVE_DENSE_WEIGHT","RETRIEVE_SPARSE_WEIGHT"]))?.data?.data?e.data.data:e?.data??{};s.value.topK=i("RETRIEVE_TOP_K"in t?t.RETRIEVE_TOP_K:void 0,s.value.topK),s.value.metricType=t.RETRIEVE_METRIC_TYPE||s.value.metricType,s.value.metricScoreExpr=t.RETRIEVE_METRIC_SCORE_COMPARE_EXPR||s.value.metricScoreExpr,s.value.denseWeight=i("RETRIEVE_DENSE_WEIGHT"in t?t.RETRIEVE_DENSE_WEIGHT:void 0,s.value.denseWeight),s.value.sparseWeight=i("RETRIEVE_SPARSE_WEIGHT"in t?t.RETRIEVE_SPARSE_WEIGHT:void 0,s.value.sparseWeight),n()}catch(t){N.error(l("settings.load.failed"))}finally{a.value=!1}var e})()})),(e,l)=>{const n=d("loading");return _((u(),c("div",xe,[v(q,{form:s.value,saving:t.value,"show-title":"",onSave:p},null,8,["form","saving"])])),[[n,a.value]])}}}),[["__scopeId","data-v-e686ec30"]]);const Ve={class:"layout-container"},We={class:"content-wrapper"},Ce={class:"main-content"},Pe={class:"content-area"},Me={key:1,class:"placeholder"};var Ke=x(n({__name:"index",setup(e){const a=r(!1),t=r("1"),s=T(ue),n=(e,a)=>{},i=(e,a)=>{},o=(e,a)=>{switch(t.value=e,e){default:s.value=ue;break;case"2":s.value=Ie;break;case"3":s.value=Se}};return(e,r)=>(u(),c("div",Ve,[v(U),p("div",We,[v(E(F),{"default-active":t.value,class:"el-menu-vertical-demo",collapse:a.value,onOpen:n,onClose:i,onSelect:o},{default:m((()=>[v(E(G),{index:"1"},{default:m((()=>[h(g(E(l)("kb.knowledge.list")),1)])),_:1}),v(E(G),{index:"2"},{default:m((()=>[h(g(E(l)("kb.knowledge.hit.test")),1)])),_:1}),v(E(G),{index:"3"},{default:m((()=>[h(g(E(l)("settings.rag.section")),1)])),_:1})])),_:1},8,["default-active","collapse"]),p("main",Ce,[p("div",Pe,[s.value?(u(),f(I(s.value),{key:0})):(u(),c("div",Me,[...r[0]||(r[0]=[p("p",null,"ËØ∑ÈÄâÊã©‰∏Ä‰∏™ËèúÂçïÈ°π",-1)])]))])])])]))}}),[["__scopeId","data-v-e012f15a"]]),Ne=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"}));export{Ne as a,J as d,Z as i,Q as p};
