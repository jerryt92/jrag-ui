import{h as e,t as a}from"../index-d3cc6d53.js";import{_ as l}from"./plugin-vue_export-helper-3b0dab4c.js";import{p as t,q as s,r as n,s as o,b as r,t as u,u as i}from"./element-plus-b4a76499.js";import{d,r as v,f as c,ag as p,o as f,c as m,Q as g,I as h,J as b,S as w,u as k,a as x,M as y,G as _,a7 as j,H as C,F as z,s as M,a2 as I,K as S}from"./@vue-38d44988.js";import{M as D}from"./menuCard-d19f1065.js";import"./vue-router-791a22d1.js";import"./axios-ff411c8f.js";import"./mitt-106818fe.js";import"./lodash-es-ca13b026.js";import"./@vueuse-0065b4d4.js";import"./@element-plus-84eef4aa.js";import"./async-validator-b6f94fc9.js";import"./@ctrl-d2fe7c9e.js";import"./@popperjs-19b81b33.js";import"./normalize-wheel-es-233dc293.js";const B={class:"uploader-container"},F={class:"text-chunk-preview"},J={class:"text-chunk-full"},K={class:"outline-preview"},P={class:"outline-full"};var T=l(d({__name:"KnowledgeBase",setup(l){const r=v([]),u=v(!1),i=v(1),d=v(10),C=v(0),z=async()=>{u.value=!0;try{const t=(await(a=(i.value-1)*d.value,l=d.value+1,e.get("/v1/rest/jrag/knowledge",{params:{offset:a,limit:l}}))).data?.data||[];t.length>d.value?(r.value=t.slice(0,d.value),C.value=(i.value+1)*d.value):(r.value=t,C.value=(i.value-1)*d.value+t.length)}catch(t){r.value=[],C.value=0}finally{u.value=!1}var a,l},M=e=>{d.value=e,z()},I=e=>{i.value=e,z()};return c((()=>{z()})),(e,l)=>{const v=p("loading");return f(),m("div",B,[g((f(),h(k(n),{data:r.value,style:{width:"100%"}},{default:b((()=>[w(k(t),{prop:"fileName",label:k(a)("kb.fileName")},null,8,["label"]),w(k(t),{prop:"description",label:k(a)("kb.description")},null,8,["label"]),w(k(t),{prop:"embeddingModel",label:k(a)("kb.embeddingModel")},null,8,["label"]),w(k(t),{prop:"embeddingProvider",label:k(a)("kb.embeddingProvider")},null,8,["label"]),w(k(t),{label:k(a)("kb.textChunk"),width:"300"},{default:b((e=>[w(k(s),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:b((()=>[x("div",F,y(e.row.textChunk),1)])),default:b((()=>[x("div",J,y(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),w(k(t),{label:k(a)("kb.outline"),width:"300"},{default:b((e=>[w(k(s),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:b((()=>[x("div",K,y(e.row.outline?.join(", ")),1)])),default:b((()=>[x("div",P,[(f(!0),m(_,null,j(e.row.outline,((e,a)=>(f(),m("div",{key:a},y(e),1)))),128))])])),_:2},1024)])),_:1},8,["label"])])),_:1},8,["data"])),[[v,u.value]]),w(k(o),{"current-page":i.value,"onUpdate:currentPage":l[0]||(l[0]=e=>i.value=e),"page-size":d.value,"onUpdate:pageSize":l[1]||(l[1]=e=>d.value=e),"page-sizes":[10,20,50,100],total:C.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:I},null,8,["current-page","page-size","total"])])}}}),[["__scopeId","data-v-9d468dc6"]]);const U={class:"uploader-container"},A={class:"top-bar"},N={class:"menu-button-box"},R={key:0,class:"file-info"},q={key:1,class:"error-message"},G=["disabled"];var H=l(d({__name:"MarkdownUpload",setup(a){const l=v(null);v();const t=v("未选择文件"),s=v(""),n=v(""),o=v(null),u=v(!1),i=()=>{o.value.show()},d=e=>{const a=e.target;if(a.files&&a.files.length>0){const e=a.files[0];g(e)}},c=e=>{if(e.preventDefault(),e.dataTransfer&&e.dataTransfer.files.length>0){const a=e.dataTransfer.files[0];g(a)}},p=e=>{e.preventDefault()},g=e=>{const a=e.name;["md","zip","tar.gz","tar"].some((e=>a.endsWith("."+e)))?(l.value=e,a.value=e.name,s.value=`${(e.size/1024).toFixed(2)} KB`,n.value=""):n.value="仅支持后缀为 md、zip、tar.gz、tar 的文件"},h=async()=>{l.value&&(n.value="",(a=>{const l=new FormData;return l.append("file",a),e.post("/v1/rest/jrag/knowledge/markdown",l)})(l.value).then((e=>{r.info("文件上传成功")})))};return(e,a)=>(f(),m("div",U,[x("div",A,[a[2]||(a[2]=x("h3",null,"🤖 Jrag AI",-1)),x("div",N,[x("span",{class:C(["menu-button",{active:u.value}]),onClick:i},[...a[1]||(a[1]=[x("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},[x("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),x("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),x("line",{x1:"3",y1:"18",x2:"21",y2:"18"})],-1)])],2)])]),w(D,{ref_key:"menuCardRef",ref:o,class:"menu-card",onShowChange:a[0]||(a[0]=e=>u.value=e)},null,512),x("div",{class:"drop-zone",onDragover:p,onDrop:c},[a[3]||(a[3]=x("p",null,"将文件拖拽至此区域上传",-1)),a[4]||(a[4]=x("p",{class:"file-info"},"或",-1)),x("input",{type:"file",accept:"image/*",onChange:d},null,32)],32),l.value?(f(),m("div",R,[x("p",null,"文件名："+y(t.value),1),x("p",null,"大小："+y(s.value),1)])):z("",!0),n.value?(f(),m("div",q,y(n.value),1)):z("",!0),x("button",{class:"submit-button",disabled:!l.value,onClick:h}," 提交上传 ",8,G)]))}}),[["__scopeId","data-v-953ab0bc"]]);const O={class:"layout-container"},Q={class:"top-bar"},W={class:"menu-button-box"},$={class:"content-wrapper"},E={class:"main-content"},L={class:"content-area"},V={key:1,class:"placeholder"};var X=l(d({__name:"index",setup(e){const l=v(null),t=v(!1),s=v("1-1"),n=M(null),o=(e,a)=>{},r=(e,a)=>{},d=(e,a)=>{if(s.value=e,"2"===e)n.value=H;else n.value=T},c=()=>{l.value.show()};return(e,v)=>(f(),m("div",O,[x("div",Q,[v[2]||(v[2]=x("h3",null,"🤖 Jrag AI",-1)),x("div",W,[x("span",{class:C(["menu-button",{active:e.showMenuCard}]),onClick:c},[...v[1]||(v[1]=[x("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},[x("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),x("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),x("line",{x1:"3",y1:"18",x2:"21",y2:"18"})],-1)])],2)])]),x("div",$,[w(D,{ref_key:"menuCardRef",ref:l,class:"menu-card",onShowChange:v[0]||(v[0]=a=>e.showMenuCard=a)},null,512),w(k(i),{"default-active":s.value,class:"el-menu-vertical-demo",collapse:t.value,onOpen:o,onClose:r,onSelect:d},{default:b((()=>[w(k(u),{index:"1"},{default:b((()=>[I(y(k(a)("kb.knowledge.list")),1)])),_:1}),w(k(u),{index:"2"},{default:b((()=>[I(y(k(a)("kb.knowledge.upload.markdown")),1)])),_:1})])),_:1},8,["default-active","collapse"]),x("main",E,[x("div",L,[n.value?(f(),h(S(n.value),{key:0})):(f(),m("div",V,[...v[3]||(v[3]=[x("p",null,"请选择一个菜单项",-1)])]))])])])]))}}),[["__scopeId","data-v-6018f500"]]);export{X as default};
