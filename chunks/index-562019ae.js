import{t as e}from"../index-ed01918a.js";import{T as l}from"./topoBar-31af6b48.js";import{_ as a}from"./plugin-vue_export-helper-3b0dab4c.js";import{c as o,x as t,y as s,d as n,u as i,g as m,f as u,B as d,C as p,D as r,a as v,i as g}from"./element-plus-d2b1cdd3.js";import{d as c,F as b,o as V,c as E,X as y,M as _,a as f,Q as A,u as h,a4 as R,K as N,r as T,f as U,aa as S,U as x}from"./@vue-bb747027.js";import{R as I,g as C,p as M}from"./property.api-43ad7018.js";import"./vue-router-6370cc0f.js";import"./axios-ff411c8f.js";import"./mitt-106818fe.js";import"./lodash-es-7a4ab7c3.js";import"./@popperjs-66964824.js";import"./@vueuse-09ca9f25.js";import"./@element-plus-ccefd8d4.js";import"./async-validator-b6f94fc9.js";import"./@ctrl-d2fe7c9e.js";import"./normalize-wheel-es-233dc293.js";import"./oem-517c1d66.js";const K={class:"section-title"},P={class:"section-title"},B={class:"section-desc"},W={class:"section-title"},k={class:"section-desc"},j={class:"settings-actions"};var w=a(c({__name:"EmbeddingSettingsPanel",props:{form:{},saving:{type:Boolean}},emits:["save"],setup(l,{emit:a}){const d=l,p=a,r=b(d,"form"),v=b(d,"saving");return(l,a)=>(V(),E(N,null,[y(h(m),{model:r.value,"label-width":"180px"},{default:_((()=>[f("div",K,A(h(e)("settings.basic.section")),1),y(h(o),{label:h(e)("settings.provider")},{default:_((()=>[y(h(t),{modelValue:r.value.provider,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value.provider=e),class:"settings-select"},{default:_((()=>[y(h(s),{label:h(e)("settings.provider.openai"),value:"open-ai"},null,8,["label"]),y(h(s),{label:h(e)("settings.provider.ollama"),value:"ollama"},null,8,["label"])])),_:1},8,["modelValue"])])),_:1},8,["label"]),f("div",P,A(h(e)("settings.ollama.section")),1),f("div",B,A(h(e)("settings.ollama.desc")),1),y(h(o),{label:h(e)("settings.model.name")},{default:_((()=>[y(h(n),{modelValue:r.value.ollamaModelName,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value.ollamaModelName=e)},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.base.url")},{default:_((()=>[y(h(n),{modelValue:r.value.ollamaBaseUrl,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value.ollamaBaseUrl=e)},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.keep.alive.seconds")},{default:_((()=>[y(h(i),{modelValue:r.value.ollamaKeepAliveSeconds,"onUpdate:modelValue":a[3]||(a[3]=e=>r.value.ollamaKeepAliveSeconds=e),min:1},null,8,["modelValue"])])),_:1},8,["label"]),f("div",W,A(h(e)("settings.openai.section")),1),f("div",k,A(h(e)("settings.openai.desc")),1),y(h(o),{label:h(e)("settings.model.name")},{default:_((()=>[y(h(n),{modelValue:r.value.openAiModelName,"onUpdate:modelValue":a[4]||(a[4]=e=>r.value.openAiModelName=e)},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.base.url")},{default:_((()=>[y(h(n),{modelValue:r.value.openAiBaseUrl,"onUpdate:modelValue":a[5]||(a[5]=e=>r.value.openAiBaseUrl=e)},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.embeddings.path")},{default:_((()=>[y(h(n),{modelValue:r.value.openAiEmbeddingsPath,"onUpdate:modelValue":a[6]||(a[6]=e=>r.value.openAiEmbeddingsPath=e)},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.api.key")},{default:_((()=>[y(h(n),{modelValue:r.value.openAiKey,"onUpdate:modelValue":a[7]||(a[7]=e=>r.value.openAiKey=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["model"]),f("div",j,[y(h(u),{type:"primary",loading:v.value,onClick:a[8]||(a[8]=e=>p("save"))},{default:_((()=>[R(A(h(e)("settings.save")),1)])),_:1},8,["loading"])])],64))}}),[["__scopeId","data-v-a08c580e"]]);const L={class:"section-title"},O={class:"section-title"},G={class:"section-desc"},H={class:"section-title"},D={class:"section-desc"},X={class:"settings-actions"};var q=a(c({__name:"LlmSettingsPanel",props:{form:{},saving:{type:Boolean}},emits:["save"],setup(l,{emit:a}){const p=l,r=a,v=b(p,"form"),g=b(p,"saving");return(l,a)=>(V(),E(N,null,[y(h(m),{model:v.value,"label-width":"180px"},{default:_((()=>[f("div",L,A(h(e)("settings.basic.section")),1),y(h(o),{label:h(e)("settings.provider")},{default:_((()=>[y(h(t),{modelValue:v.value.provider,"onUpdate:modelValue":a[0]||(a[0]=e=>v.value.provider=e),class:"settings-select"},{default:_((()=>[y(h(s),{label:h(e)("settings.provider.openai"),value:"open-ai"},null,8,["label"]),y(h(s),{label:h(e)("settings.provider.ollama"),value:"ollama"},null,8,["label"])])),_:1},8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.use.rag")},{default:_((()=>[y(h(d),{modelValue:v.value.useRag,"onUpdate:modelValue":a[1]||(a[1]=e=>v.value.useRag=e)},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.use.tools")},{default:_((()=>[y(h(d),{modelValue:v.value.useTools,"onUpdate:modelValue":a[2]||(a[2]=e=>v.value.useTools=e)},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.temperature")},{default:_((()=>[y(h(i),{modelValue:v.value.temperature,"onUpdate:modelValue":a[3]||(a[3]=e=>v.value.temperature=e),min:0,max:2,step:.1},null,8,["modelValue"])])),_:1},8,["label"]),f("div",O,A(h(e)("settings.ollama.section")),1),f("div",G,A(h(e)("settings.ollama.desc")),1),y(h(o),{label:h(e)("settings.model.name")},{default:_((()=>[y(h(n),{modelValue:v.value.ollamaModelName,"onUpdate:modelValue":a[4]||(a[4]=e=>v.value.ollamaModelName=e)},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.base.url")},{default:_((()=>[y(h(n),{modelValue:v.value.ollamaBaseUrl,"onUpdate:modelValue":a[5]||(a[5]=e=>v.value.ollamaBaseUrl=e)},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.keep.alive.seconds")},{default:_((()=>[y(h(i),{modelValue:v.value.ollamaKeepAliveSeconds,"onUpdate:modelValue":a[6]||(a[6]=e=>v.value.ollamaKeepAliveSeconds=e),min:1},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.context.length")},{default:_((()=>[y(h(i),{modelValue:v.value.ollamaContextLength,"onUpdate:modelValue":a[7]||(a[7]=e=>v.value.ollamaContextLength=e),min:1},null,8,["modelValue"])])),_:1},8,["label"]),f("div",H,A(h(e)("settings.openai.section")),1),f("div",D,A(h(e)("settings.openai.desc")),1),y(h(o),{label:h(e)("settings.model.name")},{default:_((()=>[y(h(n),{modelValue:v.value.openAiModelName,"onUpdate:modelValue":a[8]||(a[8]=e=>v.value.openAiModelName=e)},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.base.url")},{default:_((()=>[y(h(n),{modelValue:v.value.openAiBaseUrl,"onUpdate:modelValue":a[9]||(a[9]=e=>v.value.openAiBaseUrl=e)},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.completions.path")},{default:_((()=>[y(h(n),{modelValue:v.value.openAiCompletionsPath,"onUpdate:modelValue":a[10]||(a[10]=e=>v.value.openAiCompletionsPath=e)},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.api.key")},{default:_((()=>[y(h(n),{modelValue:v.value.openAiKey,"onUpdate:modelValue":a[11]||(a[11]=e=>v.value.openAiKey=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1},8,["label"]),y(h(o),{label:h(e)("settings.context.length")},{default:_((()=>[y(h(i),{modelValue:v.value.openAiContextLength,"onUpdate:modelValue":a[12]||(a[12]=e=>v.value.openAiContextLength=e),min:1},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["model"]),f("div",X,[y(h(u),{type:"primary",loading:g.value,onClick:a[13]||(a[13]=e=>r("save"))},{default:_((()=>[R(A(h(e)("settings.save")),1)])),_:1},8,["loading"])])],64))}}),[["__scopeId","data-v-bb4a22bc"]]);const F={class:"settings-page"},J={class:"settings-content"},Y={class:"settings-header"};var z=a(c({__name:"index",setup(a){const o=T("llm"),t=T(!1),s=T(!1),n=T({provider:"open-ai",useRag:!0,useTools:!0,temperature:0,ollamaModelName:"qwen3:14b-q8_0",ollamaBaseUrl:"http://172.16.8.107:11434",ollamaKeepAliveSeconds:3600,ollamaContextLength:32768,openAiModelName:"qwen-plus",openAiBaseUrl:"https://dashscope.aliyuncs.com",openAiCompletionsPath:"/compatible-mode/v1/chat/completions",openAiKey:"",openAiContextLength:32768}),i=T({provider:"open-ai",ollamaModelName:"nomic-embed-text:latest",ollamaBaseUrl:"http://127.0.0.1:11434",ollamaKeepAliveSeconds:3600,openAiModelName:"text-embedding-v4",openAiBaseUrl:"https://dashscope.aliyuncs.com",openAiEmbeddingsPath:"/compatible-mode/v1/embeddings",openAiKey:""}),m=T(""),u=T({topK:5,metricType:"COSINE",metricScoreExpr:"> 0.7",denseWeight:.5,sparseWeight:.5}),d=(e,l=!1)=>null==e?l:"1"===e.trim()||"true"===e.trim().toLowerCase(),c=(e,l)=>{if(null==e)return l;const a=Number(e);return Number.isFinite(a)?a:l},b=()=>{const e=u.value.denseWeight,l=u.value.sparseWeight,a=e+l;if(!Number.isFinite(a)||a<=0)return u.value.denseWeight=.5,void(u.value.sparseWeight=.5);u.value.denseWeight=e/a,u.value.sparseWeight=l/a},R=async()=>{s.value=!0;try{m.value!==JSON.stringify(i.value)&&await(async()=>{await g.confirm(e("settings.embedding.rebuild.confirm"),e("settings.embedding.rebuild.title"),{confirmButtonText:e("settings.embedding.rebuild.confirm.ok"),cancelButtonText:e("settings.embedding.rebuild.confirm.cancel"),type:"warning"})})(),await M((()=>{b();const e=e=>null==e?"":String(e);return[{propertyName:"llm-provider",propertyValue:e(n.value.provider)},{propertyName:"llm-use-rag",propertyValue:e(n.value.useRag)},{propertyName:"llm-use-tools",propertyValue:e(n.value.useTools)},{propertyName:"llm-temperature",propertyValue:e(n.value.temperature)},{propertyName:"llm-ollama-model-name",propertyValue:e(n.value.ollamaModelName)},{propertyName:"llm-ollama-base-url",propertyValue:e(n.value.ollamaBaseUrl)},{propertyName:"llm-ollama-keep-alive-seconds",propertyValue:e(n.value.ollamaKeepAliveSeconds)},{propertyName:"llm-ollama-context-length",propertyValue:e(n.value.ollamaContextLength)},{propertyName:"llm-open-ai-model-name",propertyValue:e(n.value.openAiModelName)},{propertyName:"llm-open-ai-base-url",propertyValue:e(n.value.openAiBaseUrl)},{propertyName:"llm-open-ai-completions-path",propertyValue:e(n.value.openAiCompletionsPath)},{propertyName:"llm-open-ai-key",propertyValue:e(n.value.openAiKey)},{propertyName:"llm-open-ai-context-length",propertyValue:e(n.value.openAiContextLength)},{propertyName:"embedding-provider",propertyValue:e(i.value.provider)},{propertyName:"embedding-ollama-model-name",propertyValue:e(i.value.ollamaModelName)},{propertyName:"embedding-ollama-base-url",propertyValue:e(i.value.ollamaBaseUrl)},{propertyName:"embedding-ollama-keep_alive_seconds",propertyValue:e(i.value.ollamaKeepAliveSeconds)},{propertyName:"embedding-open-ai-model-name",propertyValue:e(i.value.openAiModelName)},{propertyName:"embedding-open-ai-base-url",propertyValue:e(i.value.openAiBaseUrl)},{propertyName:"embedding-open-ai-embeddings-path",propertyValue:e(i.value.openAiEmbeddingsPath)},{propertyName:"embedding-open-ai-key",propertyValue:e(i.value.openAiKey)},{propertyName:"RETRIEVE_TOP_K",propertyValue:e(u.value.topK)},{propertyName:"RETRIEVE_METRIC_TYPE",propertyValue:e(u.value.metricType)},{propertyName:"RETRIEVE_METRIC_SCORE_COMPARE_EXPR",propertyValue:e(u.value.metricScoreExpr)},{propertyName:"RETRIEVE_DENSE_WEIGHT",propertyValue:e(u.value.denseWeight)},{propertyName:"RETRIEVE_SPARSE_WEIGHT",propertyValue:e(u.value.sparseWeight)}]})()),m.value=JSON.stringify(i.value),v.success(e("settings.save.success"))}catch(l){"cancel"!==l&&v.error(e("settings.save.failed"))}finally{s.value=!1}};return U((()=>{(async()=>{t.value=!0;try{const e=["llm-provider","llm-use-rag","llm-use-tools","llm-temperature","llm-ollama-model-name","llm-ollama-base-url","llm-ollama-keep-alive-seconds","llm-ollama-context-length","llm-open-ai-model-name","llm-open-ai-base-url","llm-open-ai-completions-path","llm-open-ai-key","llm-open-ai-context-length","embedding-provider","embedding-ollama-model-name","embedding-ollama-base-url","embedding-ollama-keep_alive_seconds","embedding-open-ai-model-name","embedding-open-ai-base-url","embedding-open-ai-embeddings-path","embedding-open-ai-key","RETRIEVE_TOP_K","RETRIEVE_METRIC_TYPE","RETRIEVE_METRIC_SCORE_COMPARE_EXPR","RETRIEVE_DENSE_WEIGHT","RETRIEVE_SPARSE_WEIGHT"],a=(l=await C(e))?.data?.data?l.data.data:l?.data??{};n.value.provider=a["llm-provider"]||n.value.provider,n.value.useRag=d(a["llm-use-rag"],n.value.useRag),n.value.useTools=d(a["llm-use-tools"],n.value.useTools),n.value.temperature=c(a["llm-temperature"],n.value.temperature),n.value.ollamaModelName=a["llm-ollama-model-name"]||n.value.ollamaModelName,n.value.ollamaBaseUrl=a["llm-ollama-base-url"]||n.value.ollamaBaseUrl,n.value.ollamaKeepAliveSeconds=c(a["llm-ollama-keep-alive-seconds"],n.value.ollamaKeepAliveSeconds),n.value.ollamaContextLength=c(a["llm-ollama-context-length"],n.value.ollamaContextLength),n.value.openAiModelName=a["llm-open-ai-model-name"]||n.value.openAiModelName,n.value.openAiBaseUrl=a["llm-open-ai-base-url"]||n.value.openAiBaseUrl,n.value.openAiCompletionsPath=a["llm-open-ai-completions-path"]||n.value.openAiCompletionsPath,n.value.openAiKey=a["llm-open-ai-key"]||n.value.openAiKey,n.value.openAiContextLength=c(a["llm-open-ai-context-length"],n.value.openAiContextLength),i.value.provider=a["embedding-provider"]||i.value.provider,i.value.ollamaModelName=a["embedding-ollama-model-name"]||i.value.ollamaModelName,i.value.ollamaBaseUrl=a["embedding-ollama-base-url"]||i.value.ollamaBaseUrl,i.value.ollamaKeepAliveSeconds=c(a["embedding-ollama-keep_alive_seconds"],i.value.ollamaKeepAliveSeconds),i.value.openAiModelName=a["embedding-open-ai-model-name"]||i.value.openAiModelName,i.value.openAiBaseUrl=a["embedding-open-ai-base-url"]||i.value.openAiBaseUrl,i.value.openAiEmbeddingsPath=a["embedding-open-ai-embeddings-path"]||i.value.openAiEmbeddingsPath,i.value.openAiKey=a["embedding-open-ai-key"]||i.value.openAiKey,m.value=JSON.stringify(i.value),u.value.topK=c("RETRIEVE_TOP_K"in a?a.RETRIEVE_TOP_K:void 0,u.value.topK),u.value.metricType=a.RETRIEVE_METRIC_TYPE||u.value.metricType,u.value.metricScoreExpr=a.RETRIEVE_METRIC_SCORE_COMPARE_EXPR||u.value.metricScoreExpr,u.value.denseWeight=c("RETRIEVE_DENSE_WEIGHT"in a?a.RETRIEVE_DENSE_WEIGHT:void 0,u.value.denseWeight),u.value.sparseWeight=c("RETRIEVE_SPARSE_WEIGHT"in a?a.RETRIEVE_SPARSE_WEIGHT:void 0,u.value.sparseWeight),b()}catch(a){v.error(e("settings.load.failed"))}finally{t.value=!1}var l})()})),(a,m)=>{const d=S("loading");return V(),E("div",F,[y(l),x((V(),E("div",J,[f("div",Y,[f("h2",null,A(h(e)("settings.title")),1)]),y(h(r),{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=e=>o.value=e),class:"settings-tabs"},{default:_((()=>[y(h(p),{label:h(e)("settings.llm.section"),name:"llm"},{default:_((()=>[y(q,{form:n.value,saving:s.value,onSave:R},null,8,["form","saving"])])),_:1},8,["label"]),y(h(p),{label:h(e)("settings.embedding.section"),name:"embedding"},{default:_((()=>[y(w,{form:i.value,saving:s.value,onSave:R},null,8,["form","saving"])])),_:1},8,["label"]),y(h(p),{label:h(e)("settings.rag.section"),name:"rag"},{default:_((()=>[y(I,{form:u.value,saving:s.value,onSave:R},null,8,["form","saving"])])),_:1},8,["label"])])),_:1},8,["modelValue"])])),[[d,t.value]])])}}}),[["__scopeId","data-v-608c70f4"]]);export{z as default};
