import{t as e}from"../index-9d93b5fd.js";import{Q as a}from"./QAForm-a9ab4e12.js";import{D as l}from"./@element-plus-ccefd8d4.js";import{d as o,i as s}from"./index-f28d93bb.js";import{_ as t}from"./plugin-vue_export-helper-3b0dab4c.js";import{f as d,m as n,G as u,a as i,H as c,F as r,D as m,h as p}from"./element-plus-06bb7c4a.js";import{d as f,r as v,o as g,c as b,a as j,X as _,M as y,a4 as h,Q as k,u as w,J as x,w as F,A as V}from"./@vue-bb747027.js";import"./vue-router-6370cc0f.js";import"./axios-ff411c8f.js";import"./mitt-106818fe.js";import"./lodash-es-7a4ab7c3.js";import"./@popperjs-66964824.js";import"./@vueuse-09ca9f25.js";import"./async-validator-b6f94fc9.js";import"./@ctrl-d2fe7c9e.js";import"./normalize-wheel-es-233dc293.js";import"./topoBar-32dbf7d9.js";import"./RagSettingsPanel-302c4134.js";const B={class:"json-template-form-container"},M={class:"download-template"},q={class:"upload-section",style:{"margin-top":"20px"}},A={class:"el-upload__text"},C={key:0,class:"file-info",style:{"margin-top":"10px"}},R={class:"submit-btn-container"};var S=t(f({__name:"JsonTemplateForm",emits:["add-success","loading-change"],setup(a,{expose:t,emit:r}){const m=r;t({clearForm:K});const p=v(!1),f=v(!1),F=v(null),V=v([]),S=v(),D=async()=>{try{p.value=!0,await o()}catch(a){i.error(e("common.download.failed"))}finally{p.value=!1}},Q=(e,a)=>{a.length>1?V.value=[e]:V.value=a,F.value=e.raw||null},z=e=>{S.value.clearFiles();const a=e[0];a.uid=c(),S.value.handleStart(a)},G=()=>{F.value=null,V.value=[]},I=async()=>{if(F.value)try{f.value=!0,m("loading-change",!0),await s(F.value),i.success(e("common.success")),m("add-success"),K()}catch(a){!a.response&&(i.error(e("common.file.change")),K())}finally{f.value=!1,m("loading-change",!1)}else i.warning(e("kb.please.select.file"))},J=e=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["Bytes","KB","MB","GB"][a]};function K(){F.value=null,V.value=[],S.value?.clearFiles()}return(a,o)=>(g(),b("div",B,[j("div",M,[_(w(d),{type:"primary",onClick:D,loading:p.value},{default:y((()=>[h(k(w(e)("kb.download.json.template")),1)])),_:1},8,["loading"])]),j("div",q,[_(w(u),{ref_key:"uploadRef",ref:S,"auto-upload":!1,multiple:!1,"on-change":Q,"on-remove":G,"on-exceed":z,"file-list":V.value,accept:".json",limit:1,drag:""},{default:y((()=>[_(w(n),{class:"el-icon--upload"},{default:y((()=>[_(w(l))])),_:1}),j("div",A,[j("em",null,k(w(e)("kb.json.template.drop.or.click.upload")),1)])])),_:1},8,["file-list"])]),F.value?(g(),b("div",C,[j("p",null,k(w(e)("common.selected.file"))+": "+k(F.value.name)+" ("+k(J(F.value.size))+") ",1)])):x("",!0),j("div",R,[_(w(d),{type:"success",disabled:!F.value,loading:f.value,onClick:I},{default:y((()=>[h(k(w(e)("common.submit")),1)])),_:1},8,["disabled","loading"])])]))}}),[["__scopeId","data-v-ddab4930"]]);const D={class:"container"};var Q=t(f({__name:"KbAddDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","add-success"],setup(l,{emit:o}){const s=v(),t=v(),d=l,n=o,u=v("qa"),i=v(d.modelValue),c=v(!1);F((()=>d.modelValue),(e=>{i.value=e}));const f=e=>{c.value=e},b=()=>{n("add-success"),h()},h=()=>{u.value="qa",s.value.clearForm(),t.value.clearForm(),n("update:modelValue",!1)};return(l,o)=>(g(),V(w(p),{title:w(e)("kb.knowledge.add"),"close-on-click-modal":!1,onClose:h,modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=e=>i.value=e),"append-to-body":"",width:"1000px",draggable:"",loading:c.value},{default:y((()=>[j("div",D,[_(w(r),{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=e=>u.value=e),type:"card"},{default:y((()=>[_(w(m),{label:w(e)("kb.knowledge.add.qa"),name:"qa"},{default:y((()=>[_(a,{ref_key:"qaFormRef",ref:s,onAddSuccess:b,onLoadingChange:f},null,512)])),_:1},8,["label"]),_(w(m),{label:w(e)("kb.knowledge.add.json.template"),name:"json"},{default:y((()=>[_(S,{ref_key:"jsonTemplateFormRef",ref:t,onAddSuccess:b,onLoadingChange:f},null,512)])),_:1},8,["label"])])),_:1},8,["modelValue"])])])),_:1},8,["title","modelValue","loading"]))}}),[["__scopeId","data-v-1c93acaf"]]);export{Q as default};
