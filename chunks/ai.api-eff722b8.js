import{S as t}from"./sse.js-610fcddf.js";import{h as e,l as a}from"../index-d85d6bab.js";const r=t=>{if("public"===a){const e={historyContextItem:{contextId:t.contextId,title:"",lastUpdateTime:Date.now()},chatContextDto:t};for(let o=0;o<t.messages.length;o++){const a=t.messages[o];if("user"===a.role){e.historyContextItem.title=a.content.length>64?a.content.substring(0,64):a.content;break}}let a=localStorage.getItem("chatContext");const r=a?JSON.parse(a):{sort:[],data:{}};r.data[t.contextId]||r.sort.unshift(t.contextId),r.data[t.contextId]=e,localStorage.setItem("chatContext",JSON.stringify(r))}return Promise.resolve()},o=e=>new t("/v1/rest/jrag/chat",{headers:{"Content-Type":"application/json"},method:"POST",payload:JSON.stringify(e)}),s=()=>e.get("/v1/rest/jrag/api/check"),n=()=>e.get("/v1/rest/jrag/context/id"),c=(t,r)=>{if("public"!==a)return e.get("/v1/rest/jrag/context/list",{params:{offset:t,limit:r}});try{let t=localStorage.getItem("chatContext");const e=t?JSON.parse(t):{sort:[],data:{}},a={data:[]};return e.sort.forEach((t=>{a.data.push(e.data[t].historyContextItem)})),Promise.resolve({data:a})}catch(o){return localStorage.removeItem("chatContext"),Promise.resolve({data:{data:[]}})}},i=t=>{if("public"===a){let e=localStorage.getItem("chatContext");const a=e?JSON.parse(e):{sort:[],data:{}};return Promise.resolve({data:a.data[t]?.chatContextDto})}return e.get("/v1/rest/jrag/context",{params:{"context-id":t}})},l=t=>"user"===a?e.post("/v1/rest/jrag/context/message/feedback",t):Promise.resolve(),d=t=>{if("public"===a){let e=localStorage.getItem("chatContext");const a=e?JSON.parse(e):{sort:[],data:{}};return Array.isArray(t)?t.forEach((t=>{delete a.data[t],a.sort=a.sort.filter((e=>e!==t))})):(delete a.data[t],a.sort=a.sort.filter((e=>e!==t))),localStorage.setItem("chatContext",JSON.stringify(a)),Promise.resolve()}return e.delete("/v1/rest/jrag/context",{params:{"context-id":Array.isArray(t)?t.join(","):t}})},g=t=>e.get("/v1/rest/jrag/qa-template",{params:{limit:t}}),m=t=>new WebSocket(window.location.origin.replace("http","ws")+"/ws/jrag/chat/alive?context-id="+t);export{o as a,g as b,s as c,d,n as e,i as f,c as g,l as h,m as o,r as s};
