import{e,g as t,p as a,t as l,_ as n}from"../index-498d2843.js";import{d as s,r,at as i,f as o,aa as d,o as u,c,a as p,X as v,M as m,a4 as g,Q as h,u as E,al as b,U as f,A as _,K as w,ab as k,n as R,j as y,s as T,O as I}from"./@vue-3d1b68dd.js";import{_ as x}from"./plugin-vue_export-helper-3b0dab4c.js";import{f as S,d as V,p as W,q as C,r as P,s as M,i as K,a as N,t as $,u as j,m as O,c as H,v as A,g as D,w as G,x as F}from"./element-plus-68af0c8f.js";import{T as U}from"./topoBar-203d5dba.js";import{g as z,R as B,p as q}from"./RagSettingsPanel-bb209d56.js";import{C as X}from"./@element-plus-0d456ff2.js";function Y(e){if(!e||isNaN(e))return"";const t=new Date(e);let a=t.getMonth()+1;a<10&&(a="0"+a);let l=t.getDate();l<10&&(l="0"+l);let n=t.getHours();n<10&&(n="0"+n);let s=t.getMinutes();s<10&&(s="0"+s);let r=t.getSeconds();return r<10&&(r="0"+r),t.getFullYear()+"-"+a+"-"+l+" "+n+":"+s+":"+r}const L=l=>e.post(`/v1${t}rest/${a}/knowledge/delete`,l),Q=l=>e.put(`/v1${t}rest/${a}/knowledge`,l),J=()=>{window.open(`/v1${t}rest/${a}/knowledge/json-template`)},Z=l=>{const n=new FormData;return n.append("jsonTemplate",l),e.post(`/v1${t}rest/${a}/knowledge/json-template`,n)};const ee={class:"kb-table-container"},te={class:"header-actions"},ae={class:"btn-area"},le={class:"search-area"},ne={class:"table-wrapper"},se={class:"outline-preview"},re={class:"outline-full"},ie={class:"text-chunk-preview"},oe={class:"text-chunk-full"},de={class:"pagination-wrapper"};var ue=x(s({__name:"KnowledgeBaseList",setup(s){const y=r([]),T=r(!1),I=r(1),x=r(10),$=r(0),j=r(""),O=r([]),H=i((()=>n((()=>import("./KbAddDialog-f6c0c1de.js")),["chunks/KbAddDialog-f6c0c1de.js","assets/KbAddDialog-92b5fee8.css","index-498d2843.js","assets/index-e387b3d1.css","chunks/@vue-3d1b68dd.js","chunks/vue-router-82f82b94.js","chunks/axios-ff411c8f.js","chunks/element-plus-68af0c8f.js","chunks/@popperjs-66964824.js","chunks/@vueuse-63a82237.js","chunks/@element-plus-0d456ff2.js","chunks/lodash-es-7a4ab7c3.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/QAForm-4c19102d.js","assets/QAForm-15570946.css","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/topoBar-203d5dba.js","assets/topoBar-ac046675.css","chunks/RagSettingsPanel-bb209d56.js","assets/RagSettingsPanel-29dcc37d.css"]))),A=i((()=>n((()=>import("./KbEditDialog-0c4c055d.js")),["chunks/KbEditDialog-0c4c055d.js","assets/KbEditDialog-acbaba86.css","index-498d2843.js","assets/index-e387b3d1.css","chunks/@vue-3d1b68dd.js","chunks/vue-router-82f82b94.js","chunks/axios-ff411c8f.js","chunks/element-plus-68af0c8f.js","chunks/@popperjs-66964824.js","chunks/@vueuse-63a82237.js","chunks/@element-plus-0d456ff2.js","chunks/lodash-es-7a4ab7c3.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/QAForm-4c19102d.js","assets/QAForm-15570946.css","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/topoBar-203d5dba.js","assets/topoBar-ac046675.css","chunks/RagSettingsPanel-bb209d56.js","assets/RagSettingsPanel-29dcc37d.css"]))),D=r(!1),G=r(!1),F=r(null),U=async()=>{T.value=!0;try{const r=(await(l=(I.value-1)*x.value,n=x.value+1,s=j.value,e.get(`/v1${t}rest/${a}/knowledge`,{params:{offset:l,limit:n,search:s}}))).data?.data||[];r.length>x.value?(y.value=r.slice(0,x.value),$.value=(I.value+1)*x.value):(y.value=r,$.value=(I.value-1)*x.value+r.length)}catch(r){y.value=[],$.value=0}finally{T.value=!1}var l,n,s},z=e=>{x.value=e,U()},B=e=>{I.value=e,U()},q=()=>{I.value=1,U()},X=async()=>{try{await R(),D.value=!0}catch(e){}},Q=()=>{D.value=!1,U()},J=()=>{G.value=!1,U()},Z=e=>{O.value=e},ue=()=>{0!==O.value.length&&K.confirm(`Á°ÆËÆ§Âà†Èô§ÈÄâ‰∏≠ÁöÑ ${O.value.length} È°πÊï∞ÊçÆÂêóÔºü`,"Ë≠¶Âëä",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{const e=O.value.map((e=>e.textChunkId));await L(e),N.success("Âà†Èô§ÊàêÂäü"),U()})).catch((()=>{}))};return o((()=>{U()})),(e,t)=>{const a=d("loading");return u(),c("div",ee,[p("div",te,[p("div",ae,[v(E(S),{type:"primary",onClick:U},{default:m((()=>[g(h("üîÑ "+E(l)("common.refresh")),1)])),_:1}),v(E(S),{type:"primary",onClick:X},{default:m((()=>[g(h("‚ûï "+E(l)("common.add")),1)])),_:1}),v(E(S),{type:"danger",disabled:0===O.value.length,onClick:ue},{default:m((()=>[g(h("üóëÔ∏è "+E(l)("common.delete")),1)])),_:1},8,["disabled"])]),p("div",le,[v(E(V),{modelValue:j.value,"onUpdate:modelValue":t[0]||(t[0]=e=>j.value=e),placeholder:E(l)("common.search.placeholder.keyword"),clearable:"",style:{width:"240px"},onKeyup:b(q,["enter"]),onClear:q},null,8,["modelValue","placeholder"]),v(E(S),{type:"primary",onClick:q},{default:m((()=>[g(h("üîçÔ∏è "+E(l)("common.search")),1)])),_:1})])]),p("div",ne,[f((u(),_(E(P),{ref:"tableRef",data:y.value,style:{width:"100%",height:"100%"},border:"",onSelectionChange:Z},{default:m((()=>[v(E(W),{type:"selection",width:"55",align:"center"}),v(E(W),{label:E(l)("kb.outline"),width:"300"},{default:m((e=>[v(E(C),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:m((()=>{return[p("div",se,h((t=e.row.outline,t&&0!==t.length?t.length<=3?t.join(" | "):`${t.slice(0,3).join(", ")}... (+${t.length-3}È°π)`:"-")),1)];var t})),default:m((()=>[p("div",re,[(u(!0),c(w,null,k(e.row.outline,((e,t)=>(u(),c("div",{key:t},h(t+1)+". "+h(e),1)))),128))])])),_:2},1024)])),_:1},8,["label"]),v(E(W),{label:E(l)("kb.textChunk"),width:"300"},{default:m((e=>[v(E(C),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:m((()=>[p("div",ie,h(e.row.textChunk),1)])),default:m((()=>[p("div",oe,h(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),v(E(W),{prop:"description",label:E(l)("kb.description"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),v(E(W),{prop:"dimension",label:E(l)("kb.dimension"),width:"130"},null,8,["label"]),v(E(W),{prop:"embeddingModel",label:E(l)("kb.embeddingModel"),width:"150"},null,8,["label"]),v(E(W),{prop:"embeddingProvider",label:E(l)("kb.embeddingProvider"),width:"150"},null,8,["label"]),v(E(W),{prop:"createTime",label:E(l)("common.create.time"),width:"180"},{default:m((e=>[g(h(E(Y)(e.row.createTime)),1)])),_:1},8,["label"]),v(E(W),{prop:"updateTime",label:E(l)("common.update.time"),width:"180"},{default:m((e=>[g(h(E(Y)(e.row.updateTime)),1)])),_:1},8,["label"]),v(E(W),{prop:"createUsername",label:E(l)("kb.create.username"),width:"150"},null,8,["label"]),v(E(W),{label:E(l)("common.action"),width:"120",align:"center",fixed:"right"},{default:m((e=>[v(E(S),{type:"primary",link:"",onClick:t=>{return a=e.row,F.value={...a,outline:a.outline?[...a.outline]:[]},void(G.value=!0);var a}},{default:m((()=>[g(h(E(l)("common.edit")),1)])),_:1},8,["onClick"]),v(E(S),{type:"danger",link:"",onClick:t=>{var a;(a=e.row)?.textChunkId&&K.confirm("Á°ÆËÆ§Âà†Èô§ËØ•Êù°Êï∞ÊçÆÂêóÔºü","Ë≠¶Âëä",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{await L([a.textChunkId]),N.success("Âà†Èô§ÊàêÂäü"),U()})).catch((()=>{}))}},{default:m((()=>[g(h(E(l)("common.delete")),1)])),_:1},8,["onClick"])])),_:1},8,["label"])])),_:1},8,["data"])),[[a,T.value]])]),p("div",de,[v(E(M),{"current-page":I.value,"onUpdate:currentPage":t[1]||(t[1]=e=>I.value=e),"page-size":x.value,"onUpdate:pageSize":t[2]||(t[2]=e=>x.value=e),"page-sizes":[10,20,50,100],total:$.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:z,onCurrentChange:B},null,8,["current-page","page-size","total"])]),v(E(H),{modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=e=>D.value=e),onAddSuccess:Q},null,8,["modelValue"]),v(E(A),{modelValue:G.value,"onUpdate:modelValue":t[4]||(t[4]=e=>G.value=e),knowledge:F.value,onEditSuccess:J},null,8,["modelValue","knowledge"])])}}}),[["__scopeId","data-v-6e5e5748"]]);const ce={class:"hit-test-container"},pe={class:"hit-test-result"},ve={class:"table-wrapper"},me={class:"table-header"},ge={class:"table-header-title"},he={class:"rag-weight-slider compact"},Ee={class:"rag-weight-values"},be={class:"outline-preview"},fe={class:"outline-full"},_e={class:"text-chunk-full"},we={class:"header-with-tooltip"},ke={class:"header-with-tooltip"},Re={class:"text-chunk-preview"},ye={class:"text-chunk-full"},Te={class:"hit-test-form"};var Ie=x(s({__name:"HitTest",setup(n){const s=r({text:"",topK:5}),i=r(),b=r(!1),w=r([]),k=r({denseWeight:.5,sparseWeight:.5}),R=(e,t)=>{if(null==e)return t;const a=Number(e);return Number.isFinite(a)?a:t},T=y((()=>Math.round(100*k.value.denseWeight))),I=y((()=>100-T.value)),x=e=>{const t=Math.min(100,Math.max(0,Math.round(e))),a=100-t;return`${l("settings.rag.weight.dense")}: ${t}% / ${l("settings.rag.weight.sparse")}: ${a}%`},M=e=>Number.isFinite(e)?e.toFixed(4):"-",K=async()=>{i.value&&await i.value.validate((async l=>{if(l)try{b.value=!0;const l=await(n=s.value.text,r=s.value.topK,e.get(`/v1${t}rest/${a}/knowledge/retrieve`,{params:{"query-text":n,"top-k":r}}));w.value=l.data?.data||[]}catch(i){}finally{b.value=!1}var n,r}))};let N=!0;const G=e=>{"Enter"!==e.key||e.shiftKey||(N=!0,e.preventDefault())},F=()=>{N=!1},U=()=>{N&&(N=!1,K())},B=async()=>{try{const e=(e=>e?.data?.data?e.data.data:e?.data??{})(await z(["RETRIEVE_DENSE_WEIGHT","RETRIEVE_SPARSE_WEIGHT"]));k.value.denseWeight=R("RETRIEVE_DENSE_WEIGHT"in e?e.RETRIEVE_DENSE_WEIGHT:void 0,k.value.denseWeight),k.value.sparseWeight=R("RETRIEVE_SPARSE_WEIGHT"in e?e.RETRIEVE_SPARSE_WEIGHT:void 0,k.value.sparseWeight),(()=>{const e=k.value.denseWeight,t=k.value.sparseWeight,a=e+t;if(!Number.isFinite(a)||a<=0)return k.value.denseWeight=.5,void(k.value.sparseWeight=.5);k.value.denseWeight=e/a,k.value.sparseWeight=t/a})()}catch(e){}};return o((()=>{B()})),(e,t)=>{const a=d("loading");return u(),c("div",ce,[p("div",pe,[p("div",ve,[p("div",me,[p("span",ge,h(E(l)("settings.rag.weight.label")),1),p("div",he,[v(E($),{"model-value":T.value,min:0,max:100,"show-tooltip":!0,"format-tooltip":x,disabled:""},null,8,["model-value"]),p("div",Ee,[p("span",null,h(E(l)("settings.rag.weight.dense"))+": "+h(T.value)+"%",1),p("span",null,h(E(l)("settings.rag.weight.sparse"))+": "+h(I.value)+"%",1)])])]),f((u(),_(E(P),{ref:"tableRef",data:w.value,style:{width:"100%",height:"100%"},border:""},{default:m((()=>[v(E(W),{label:E(l)("kb.outline"),width:"300"},{default:m((e=>[v(E(C),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:m((()=>[p("div",be,h(e.row.outline),1)])),default:m((()=>[p("div",fe,[p("div",_e,h(e.row.outline),1)])])),_:2},1024)])),_:1},8,["label"]),v(E(W),{prop:"denseMetricType",label:E(l)("kb.knowledge.hit.test.dense.metric"),width:"170"},null,8,["label"]),v(E(W),{label:E(l)("kb.knowledge.hit.test.dense.score"),width:"170",formatter:e=>M(e.denseScore)},{header:m((()=>[p("div",we,[p("span",null,h(E(l)("kb.knowledge.hit.test.dense.score")),1),v(E(j),{effect:"dark",placement:"top","raw-content":!0,content:E(l)("kb.knowledge.hit.test.dense.score.tip")},{default:m((()=>[v(E(O),{class:"info-icon"},{default:m((()=>[v(E(X))])),_:1})])),_:1},8,["content"])])])),_:1},8,["label","formatter"]),v(E(W),{prop:"sparseMetricType",label:E(l)("kb.knowledge.hit.test.sparse.metric"),width:"170"},null,8,["label"]),v(E(W),{label:E(l)("kb.knowledge.hit.test.sparse.score"),width:"170",formatter:e=>M(e.sparseScore)},{header:m((()=>[p("div",ke,[p("span",null,h(E(l)("kb.knowledge.hit.test.sparse.score")),1),v(E(j),{effect:"dark",placement:"top","raw-content":!0,content:E(l)("kb.knowledge.hit.test.sparse.score.tip")},{default:m((()=>[v(E(O),{class:"info-icon"},{default:m((()=>[v(E(X))])),_:1})])),_:1},8,["content"])])])),_:1},8,["label","formatter"]),v(E(W),{label:E(l)("kb.knowledge.hit.test.hybrid.score"),width:"170",formatter:e=>M(e.hybridScore??e.score)},null,8,["label","formatter"]),v(E(W),{prop:"isFiltered",label:E(l)("kb.knowledge.hit.test.is.hit"),width:"150",formatter:e=>e.isFiltered?E(l)("common.no"):E(l)("common.yes")},null,8,["label","formatter"]),v(E(W),{label:E(l)("kb.textChunk"),width:"400"},{default:m((e=>[v(E(C),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:m((()=>[p("div",Re,h(e.row.textChunk),1)])),default:m((()=>[p("div",ye,h(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),v(E(W),{prop:"dimension",label:E(l)("kb.dimension"),width:"130"},null,8,["label"]),v(E(W),{prop:"embeddingModel",label:E(l)("kb.embeddingModel"),width:"150"},null,8,["label"]),v(E(W),{prop:"embeddingProvider",label:E(l)("kb.embeddingProvider"),width:"150"},null,8,["label"])])),_:1},8,["data"])),[[a,b.value]])])]),p("div",Te,[v(E(D),{ref_key:"formRef",ref:i,model:s.value,"label-width":"120px"},{default:m((()=>[v(E(H),{label:"TOP-K",prop:"topK",rules:[{required:!0,message:E(l)("common.input.required")}]},{default:m((()=>[v(E(A),{class:"top-k-input",modelValue:s.value.topK,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value.topK=e),min:1,max:15,"controls-position":"right"},null,8,["modelValue"])])),_:1},8,["rules"]),v(E(H),{label:E(l)("kb.knowledge.hit.test.text"),prop:"text",class:"input-area",rules:[{required:!0,message:E(l)("common.input.required")}]},{default:m((()=>[v(E(V),{modelValue:s.value.text,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value.text=e),class:"text-input",placeholder:E(l)("kb.knowledge.hit.test.text.placeholder"),type:"textarea",autosize:{minRows:5,maxRows:10},maxlength:4e3,"show-word-limit":"",onKeydown:G,onInput:F,onKeyup:U},null,8,["modelValue","placeholder"]),v(E(S),{type:"primary",onClick:K},{default:m((()=>[...t[2]||(t[2]=[g("Êèê‰∫§",-1)])])),_:1})])),_:1},8,["label","rules"])])),_:1},8,["model"])])])}}}),[["__scopeId","data-v-5e691982"]]);const xe={class:"rag-settings-page"};var Se=x(s({__name:"RagSettings",setup(e){const t=r(!1),a=r(!1),n=r({topK:5,metricType:"COSINE",metricScoreExpr:"> 0.7",denseWeight:.5,sparseWeight:.5}),s=r(n.value.metricType),i=()=>{const e=n.value.denseWeight,t=n.value.sparseWeight,a=e+t;if(!Number.isFinite(a)||a<=0)return n.value.denseWeight=.5,void(n.value.sparseWeight=.5);n.value.denseWeight=e/a,n.value.sparseWeight=t/a},p=(e,t)=>{if(null==e)return t;const a=Number(e);return Number.isFinite(a)?a:t},m=async()=>{a.value=!0;try{s.value!==n.value.metricType&&await(async()=>{await K.confirm(l("settings.embedding.rebuild.confirm"),l("settings.embedding.rebuild.title"),{confirmButtonText:l("settings.embedding.rebuild.confirm.ok"),cancelButtonText:l("settings.embedding.rebuild.confirm.cancel"),type:"warning"})})(),i(),await q([{propertyName:"RETRIEVE_TOP_K",propertyValue:String(n.value.topK)},{propertyName:"RETRIEVE_METRIC_TYPE",propertyValue:n.value.metricType},{propertyName:"RETRIEVE_METRIC_SCORE_COMPARE_EXPR",propertyValue:n.value.metricScoreExpr},{propertyName:"RETRIEVE_DENSE_WEIGHT",propertyValue:String(n.value.denseWeight)},{propertyName:"RETRIEVE_SPARSE_WEIGHT",propertyValue:String(n.value.sparseWeight)}]),s.value=n.value.metricType,N.success(l("settings.save.success"))}catch(e){"cancel"!==e&&N.error(l("settings.save.failed"))}finally{a.value=!1}};return o((()=>{(async()=>{t.value=!0;try{const a=(e=await z(["RETRIEVE_TOP_K","RETRIEVE_METRIC_TYPE","RETRIEVE_METRIC_SCORE_COMPARE_EXPR","RETRIEVE_DENSE_WEIGHT","RETRIEVE_SPARSE_WEIGHT"]))?.data?.data?e.data.data:e?.data??{};n.value.topK=p("RETRIEVE_TOP_K"in a?a.RETRIEVE_TOP_K:void 0,n.value.topK),n.value.metricType=a.RETRIEVE_METRIC_TYPE||n.value.metricType,n.value.metricScoreExpr=a.RETRIEVE_METRIC_SCORE_COMPARE_EXPR||n.value.metricScoreExpr,n.value.denseWeight=p("RETRIEVE_DENSE_WEIGHT"in a?a.RETRIEVE_DENSE_WEIGHT:void 0,n.value.denseWeight),n.value.sparseWeight=p("RETRIEVE_SPARSE_WEIGHT"in a?a.RETRIEVE_SPARSE_WEIGHT:void 0,n.value.sparseWeight),i(),s.value=n.value.metricType}catch(a){N.error(l("settings.load.failed"))}finally{t.value=!1}var e})()})),(e,l)=>{const s=d("loading");return f((u(),c("div",xe,[v(B,{form:n.value,saving:a.value,"show-title":"",onSave:m},null,8,["form","saving"])])),[[s,t.value]])}}}),[["__scopeId","data-v-6d255d32"]]);const Ve={class:"layout-container"},We={class:"content-wrapper"},Ce={class:"main-content"},Pe={class:"content-area"},Me={key:1,class:"placeholder"};var Ke=x(s({__name:"index",setup(e){const t=r(!1),a=r("1"),n=T(ue),s=(e,t)=>{},i=(e,t)=>{},o=(e,t)=>{switch(a.value=e,e){default:n.value=ue;break;case"2":n.value=Ie;break;case"3":n.value=Se}};return(e,r)=>(u(),c("div",Ve,[v(U),p("div",We,[v(E(F),{"default-active":a.value,class:"el-menu-vertical-demo",collapse:t.value,onOpen:s,onClose:i,onSelect:o},{default:m((()=>[v(E(G),{index:"1"},{default:m((()=>[g(h(E(l)("kb.knowledge.list")),1)])),_:1}),v(E(G),{index:"2"},{default:m((()=>[g(h(E(l)("kb.knowledge.hit.test")),1)])),_:1}),v(E(G),{index:"3"},{default:m((()=>[g(h(E(l)("settings.rag.section")),1)])),_:1})])),_:1},8,["default-active","collapse"]),p("main",Ce,[p("div",Pe,[n.value?(u(),_(I(n.value),{key:0})):(u(),c("div",Me,[...r[0]||(r[0]=[p("p",null,"ËØ∑ÈÄâÊã©‰∏Ä‰∏™ËèúÂçïÈ°π",-1)])]))])])])]))}}),[["__scopeId","data-v-e012f15a"]]),Ne=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"}));export{Ne as a,J as d,Z as i,Q as p};
