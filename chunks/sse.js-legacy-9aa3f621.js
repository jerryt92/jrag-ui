!function(){function t(t){return function(t){if(Array.isArray(t))return t}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||e(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){if(t){if("string"==typeof t)return n(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}System.register([],(function(n){"use strict";return{execute:function(){var r=n("S",(function(n,s){if(!(this instanceof r))return new r(n,s);this.url=n,s=s||{},this.headers=s.headers||{},this.payload=void 0!==s.payload?s.payload:"",this.method=s.method||this.payload&&"POST"||"GET",this.withCredentials=!!s.withCredentials,this.debug=!!s.debug,this.autoReconnect=void 0!==s.autoReconnect&&s.autoReconnect,this.reconnectDelay=void 0!==s.reconnectDelay?s.reconnectDelay:3e3,this.maxRetries=void 0!==s.maxRetries?s.maxRetries:null,this.retryCount=0,this.reconnectTimer=null,this.useLastEventId=void 0===s.useLastEventId||s.useLastEventId,this.FIELD_SEPARATOR=":",this.listeners={},this.xhr=null,this.readyState=r.INITIALIZING,this.progress=0,this.chunk="",this.lastEventId="",this.addEventListener=function(t,e){void 0===this.listeners[t]&&(this.listeners[t]=[]),-1===this.listeners[t].indexOf(e)&&this.listeners[t].push(e)},this.removeEventListener=function(t,e){if(void 0!==this.listeners[t]){var n=[];this.listeners[t].forEach((function(t){t!==e&&n.push(t)})),0===n.length?delete this.listeners[t]:this.listeners[t]=n}},this.dispatchEvent=function(t){if(!t)return!0;this.debug,t.source=this;var e="on"+t.type;return(!this.hasOwnProperty(e)||(this[e].call(this,t),!t.defaultPrevented))&&(!this.listeners[t.type]||this.listeners[t.type].every((function(e){return e(t),!t.defaultPrevented})))},this._markClosed=function(){var t=this;if(this.xhr=null,this.progress=0,this.chunk="",this._setReadyState(r.CLOSED),this.autoReconnect){if(null!==this.maxRetries&&this.retryCount>=this.maxRetries)return this.debug,this.autoReconnect=!1,void this.close();this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.debug,this.reconnectTimer=setTimeout((function(){t.reconnectTimer=null,t.retryCount++,t.stream()}),this.reconnectDelay)}},this._setReadyState=function(t){var e=new CustomEvent("readystatechange");e.readyState=t,this.readyState=t,this.dispatchEvent(e)},this._onStreamFailure=function(t){var e=new CustomEvent("error");e.responseCode=t.currentTarget.status,e.data=t.currentTarget.response,this.dispatchEvent(e),this._markClosed()},this._onStreamAbort=function(){this.dispatchEvent(new CustomEvent("abort")),this._markClosed()},this._onStreamProgress=function(t){if(this.xhr)if(this.xhr.status<200||this.xhr.status>=300)this._onStreamFailure(t);else{this.retryCount=0;var e=this.xhr.responseText.substring(this.progress);this.progress+=e.length;var n=(this.chunk+e).split(/(\r\n\r\n|\r\r|\n\n)/g),r=n.pop();n.forEach(function(t){t.trim().length>0&&this.dispatchEvent(this._parseEventChunk(t))}.bind(this)),this.chunk=r}},this._onStreamLoaded=function(t){this._onStreamProgress(t),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk="",this._markClosed()},this._parseEventChunk=function(t){if(!t||0===t.length)return null;this.debug;var e={id:null,retry:null,data:null,event:null};if(t.split(/\n|\r\n|\r/).forEach(function(t){var n,r,s=t.indexOf(this.FIELD_SEPARATOR);if(s>0){var i=" "===t[s+1]?2:1;n=t.substring(0,s),r=t.substring(s+i)}else{if(!(s<0))return;n=t,r=""}n in e&&("data"===n&&null!==e[n]?e.data+="\n"+r:e[n]=r)}.bind(this)),null===e.data)return null;null!==e.id&&(this.lastEventId=e.id);var n=new CustomEvent(e.event||"message");return n.id=e.id,n.data=e.data||"",n.lastEventId=this.lastEventId,n},this._onReadyStateChange=function(){if(this.xhr&&this.xhr.readyState===XMLHttpRequest.HEADERS_RECEIVED){var n,s={},i=function(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=e(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var s=0,i=function(){};return{s:i,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,h=!0,o=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return h=t.done,t},e:function(t){o=!0,a=t},f:function(){try{h||null==r.return||r.return()}finally{if(o)throw a}}}}(this.xhr.getAllResponseHeaders().trim().split("\r\n"));try{for(i.s();!(n=i.n()).done;){var a=t(n.value.split(":")),h=a[0],o=a.slice(1).join(":").trim();s[h.trim().toLowerCase()]=s[h.trim().toLowerCase()]||[],s[h.trim().toLowerCase()].push(o)}}catch(d){i.e(d)}finally{i.f()}var u=new CustomEvent("open");u.responseCode=this.xhr.status,u.headers=s,this.dispatchEvent(u),this._setReadyState(r.OPEN)}},this.stream=function(){if(!this.xhr){for(var t in this._setReadyState(r.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._onReadyStateChange.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url),this.headers)this.xhr.setRequestHeader(t,this.headers[t]);this.useLastEventId&&this.lastEventId.length>0&&this.xhr.setRequestHeader("Last-Event-ID",this.lastEventId),this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)}},this.close=function(){this.readyState!==r.CLOSED&&(this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.autoReconnect=!1,this.xhr.abort())},(void 0===s.start||s.start)&&this.stream()}));r.INITIALIZING=-1,r.CONNECTING=0,r.OPEN=1,r.CLOSED=2,void 0!==n&&(n.SSE=r)}}}))}();
