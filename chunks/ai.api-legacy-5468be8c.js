System.register(["./sse.js-legacy-9aa3f621.js","../index-legacy-010e5fe2.js"],(function(t){"use strict";var e,r,a;return{setters:[function(t){e=t.S},function(t){r=t.h,a=t.l}],execute:function(){var o="chatContext";t("s",(function(t){if("public"===a){for(var e={historyContextItem:{contextId:t.contextId,title:"",lastUpdateTime:Date.now()},chatContextDto:t},r=0;r<t.messages.length;r++){var n=t.messages[r];if("user"===n.role){e.historyContextItem.title=n.content.length>64?n.content.substring(0,64):n.content;break}}var s=localStorage.getItem(o),i=s?JSON.parse(s):{sort:[],data:{}};i.data[t.contextId]||i.sort.unshift(t.contextId),i.data[t.contextId]=e,localStorage.setItem(o,JSON.stringify(i))}return Promise.resolve()})),t("a",(function(t){return new e("/v1/rest/jrag/chat",{headers:{"Content-Type":"application/json"},method:"POST",payload:JSON.stringify(t)})})),t("c",(function(){return r.get("/v1/rest/jrag/api/check")})),t("b",(function(){return r.get("/v1/rest/jrag/context/id")})),t("g",(function(t,e){if("public"!==a)return r.get("/v1/rest/jrag/context/list",{params:{offset:t,limit:e}});try{var n=localStorage.getItem(o),s=n?JSON.parse(n):{sort:[],data:{}},i={data:[]};return s.sort.forEach((function(t){i.data.push(s.data[t].historyContextItem)})),Promise.resolve({data:i})}catch(c){return localStorage.removeItem(o),Promise.resolve({data:{data:[]}})}})),t("e",(function(t){if("public"===a){var e,n=localStorage.getItem(o),s=n?JSON.parse(n):{sort:[],data:{}};return Promise.resolve({data:null===(e=s.data[t])||void 0===e?void 0:e.chatContextDto})}return r.get("/v1/rest/jrag/context",{params:{"context-id":t}})})),t("f",(function(t){return"user"===a?r.post("/v1/rest/jrag/context/message/feedback",t):Promise.resolve()})),t("d",(function(t){if("public"===a){var e=localStorage.getItem(o),n=e?JSON.parse(e):{sort:[],data:{}};return Array.isArray(t)?t.forEach((function(t){delete n.data[t],n.sort=n.sort.filter((function(e){return e!==t}))})):(delete n.data[t],n.sort=n.sort.filter((function(e){return e!==t}))),localStorage.setItem(o,JSON.stringify(n)),Promise.resolve()}return r.delete("/v1/rest/jrag/context",{params:{"context-id":Array.isArray(t)?t.join(","):t}})})),t("o",(function(t){return new WebSocket(window.location.origin.replace("http","ws")+"/ws/jrag/chat/alive?context-id="+t)}))}}}));
