import{e,g as t,p as a,t as l,_ as r}from"../index-6694102b.js";import{d as o,r as n,at as s,f as i,aa as d,o as u,c,a as p,X as v,M as m,a4 as h,Q as g,u as f,al as b,U as _,A as E,K as w,ab as k,n as y,s as R,O as T}from"./@vue-bb747027.js";import{_ as x}from"./plugin-vue_export-helper-3b0dab4c.js";import{f as I,d as V,p as C,q as S,r as P,s as K,i as W,a as M,t as O,m as j,c as N,u as $,g as A,v as D,w as H}from"./element-plus-310660e5.js";import{T as U}from"./topoBar-89b3efb9.js";import{C as z}from"./@element-plus-ccefd8d4.js";import{R as F,g as G,p as q}from"./property.api-15878d55.js";function B(e){if(!e||isNaN(e))return"";const t=new Date(e);let a=t.getMonth()+1;a<10&&(a="0"+a);let l=t.getDate();l<10&&(l="0"+l);let r=t.getHours();r<10&&(r="0"+r);let o=t.getMinutes();o<10&&(o="0"+o);let n=t.getSeconds();return n<10&&(n="0"+n),t.getFullYear()+"-"+a+"-"+l+" "+r+":"+o+":"+n}const X=l=>e.post(`/v1${t}rest/${a}/knowledge/delete`,l),Y=l=>e.put(`/v1${t}rest/${a}/knowledge`,l),L=()=>{window.open(`/v1${t}rest/${a}/knowledge/json-template`)},Q=l=>{const r=new FormData;return r.append("jsonTemplate",l),e.post(`/v1${t}rest/${a}/knowledge/json-template`,r)};const J={class:"kb-table-container"},Z={class:"header-actions"},ee={class:"btn-area"},te={class:"search-area"},ae={class:"table-wrapper"},le={class:"outline-preview"},re={class:"outline-full"},oe={class:"text-chunk-preview"},ne={class:"text-chunk-full"},se={class:"pagination-wrapper"};var ie=x(o({__name:"KnowledgeBaseList",setup(o){const R=n([]),T=n(!1),x=n(1),O=n(10),j=n(0),N=n(""),$=n([]),A=s((()=>r((()=>import("./KbAddDialog-63f03902.js")),["chunks/KbAddDialog-63f03902.js","assets/KbAddDialog-92b5fee8.css","index-6694102b.js","assets/index-e387b3d1.css","chunks/@vue-bb747027.js","chunks/vue-router-6370cc0f.js","chunks/axios-ff411c8f.js","chunks/element-plus-310660e5.js","chunks/@popperjs-66964824.js","chunks/@vueuse-09ca9f25.js","chunks/@element-plus-ccefd8d4.js","chunks/lodash-es-7a4ab7c3.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/QAForm-dd8f8098.js","assets/QAForm-15570946.css","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/topoBar-89b3efb9.js","assets/topoBar-ac046675.css","chunks/property.api-15878d55.js","assets/property.api-64a2c9b3.css"]))),D=s((()=>r((()=>import("./KbEditDialog-a0d0f806.js")),["chunks/KbEditDialog-a0d0f806.js","assets/KbEditDialog-acbaba86.css","index-6694102b.js","assets/index-e387b3d1.css","chunks/@vue-bb747027.js","chunks/vue-router-6370cc0f.js","chunks/axios-ff411c8f.js","chunks/element-plus-310660e5.js","chunks/@popperjs-66964824.js","chunks/@vueuse-09ca9f25.js","chunks/@element-plus-ccefd8d4.js","chunks/lodash-es-7a4ab7c3.js","chunks/async-validator-b6f94fc9.js","chunks/@ctrl-d2fe7c9e.js","chunks/normalize-wheel-es-233dc293.js","chunks/mitt-106818fe.js","chunks/QAForm-dd8f8098.js","assets/QAForm-15570946.css","chunks/plugin-vue_export-helper-3b0dab4c.js","chunks/topoBar-89b3efb9.js","assets/topoBar-ac046675.css","chunks/property.api-15878d55.js","assets/property.api-64a2c9b3.css"]))),H=n(!1),U=n(!1),z=n(null),F=async()=>{T.value=!0;try{const n=(await(l=(x.value-1)*O.value,r=O.value+1,o=N.value,e.get(`/v1${t}rest/${a}/knowledge`,{params:{offset:l,limit:r,search:o}}))).data?.data||[];n.length>O.value?(R.value=n.slice(0,O.value),j.value=(x.value+1)*O.value):(R.value=n,j.value=(x.value-1)*O.value+n.length)}catch(n){R.value=[],j.value=0}finally{T.value=!1}var l,r,o},G=e=>{O.value=e,F()},q=e=>{x.value=e,F()},Y=()=>{x.value=1,F()},L=async()=>{try{await y(),H.value=!0}catch(e){}},Q=()=>{H.value=!1,F()},ie=()=>{U.value=!1,F()},de=e=>{$.value=e},ue=()=>{0!==$.value.length&&W.confirm(`Á°ÆËÆ§Âà†Èô§ÈÄâ‰∏≠ÁöÑ ${$.value.length} È°πÊï∞ÊçÆÂêóÔºü`,"Ë≠¶Âëä",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{const e=$.value.map((e=>e.textChunkId));await X(e),M.success("Âà†Èô§ÊàêÂäü"),F()})).catch((()=>{}))};return i((()=>{F()})),(e,t)=>{const a=d("loading");return u(),c("div",J,[p("div",Z,[p("div",ee,[v(f(I),{type:"primary",onClick:F},{default:m((()=>[h(g("üîÑ "+f(l)("common.refresh")),1)])),_:1}),v(f(I),{type:"primary",onClick:L},{default:m((()=>[h(g("‚ûï "+f(l)("common.add")),1)])),_:1}),v(f(I),{type:"danger",disabled:0===$.value.length,onClick:ue},{default:m((()=>[h(g("üóëÔ∏è "+f(l)("common.delete")),1)])),_:1},8,["disabled"])]),p("div",te,[v(f(V),{modelValue:N.value,"onUpdate:modelValue":t[0]||(t[0]=e=>N.value=e),placeholder:f(l)("common.search.placeholder.keyword"),clearable:"",style:{width:"240px"},onKeyup:b(Y,["enter"]),onClear:Y},null,8,["modelValue","placeholder"]),v(f(I),{type:"primary",onClick:Y},{default:m((()=>[h(g("üîçÔ∏è "+f(l)("common.search")),1)])),_:1})])]),p("div",ae,[_((u(),E(f(P),{ref:"tableRef",data:R.value,style:{width:"100%",height:"100%"},border:"",onSelectionChange:de},{default:m((()=>[v(f(C),{type:"selection",width:"55",align:"center"}),v(f(C),{label:f(l)("kb.outline"),width:"300"},{default:m((e=>[v(f(S),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:m((()=>{return[p("div",le,g((t=e.row.outline,t&&0!==t.length?t.length<=3?t.join(" | "):`${t.slice(0,3).join(", ")}... (+${t.length-3}È°π)`:"-")),1)];var t})),default:m((()=>[p("div",re,[(u(!0),c(w,null,k(e.row.outline,((e,t)=>(u(),c("div",{key:t},g(t+1)+". "+g(e),1)))),128))])])),_:2},1024)])),_:1},8,["label"]),v(f(C),{label:f(l)("kb.textChunk"),width:"300"},{default:m((e=>[v(f(S),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:m((()=>[p("div",oe,g(e.row.textChunk),1)])),default:m((()=>[p("div",ne,g(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),v(f(C),{prop:"description",label:f(l)("kb.description"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),v(f(C),{prop:"dimension",label:f(l)("kb.dimension"),width:"130"},null,8,["label"]),v(f(C),{prop:"embeddingModel",label:f(l)("kb.embeddingModel"),width:"150"},null,8,["label"]),v(f(C),{prop:"embeddingProvider",label:f(l)("kb.embeddingProvider"),width:"150"},null,8,["label"]),v(f(C),{prop:"createTime",label:f(l)("common.create.time"),width:"180"},{default:m((e=>[h(g(f(B)(e.row.createTime)),1)])),_:1},8,["label"]),v(f(C),{prop:"updateTime",label:f(l)("common.update.time"),width:"180"},{default:m((e=>[h(g(f(B)(e.row.updateTime)),1)])),_:1},8,["label"]),v(f(C),{prop:"createUsername",label:f(l)("kb.create.username"),width:"150"},null,8,["label"]),v(f(C),{label:f(l)("common.action"),width:"120",align:"center",fixed:"right"},{default:m((e=>[v(f(I),{type:"primary",link:"",onClick:t=>{return a=e.row,z.value={...a,outline:a.outline?[...a.outline]:[]},void(U.value=!0);var a}},{default:m((()=>[h(g(f(l)("common.edit")),1)])),_:1},8,["onClick"]),v(f(I),{type:"danger",link:"",onClick:t=>{var a;(a=e.row)?.textChunkId&&W.confirm("Á°ÆËÆ§Âà†Èô§ËØ•Êù°Êï∞ÊçÆÂêóÔºü","Ë≠¶Âëä",{confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à",type:"warning"}).then((async()=>{await X([a.textChunkId]),M.success("Âà†Èô§ÊàêÂäü"),F()})).catch((()=>{}))}},{default:m((()=>[h(g(f(l)("common.delete")),1)])),_:1},8,["onClick"])])),_:1},8,["label"])])),_:1},8,["data"])),[[a,T.value]])]),p("div",se,[v(f(K),{"current-page":x.value,"onUpdate:currentPage":t[1]||(t[1]=e=>x.value=e),"page-size":O.value,"onUpdate:pageSize":t[2]||(t[2]=e=>O.value=e),"page-sizes":[10,20,50,100],total:j.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:G,onCurrentChange:q},null,8,["current-page","page-size","total"])]),v(f(A),{modelValue:H.value,"onUpdate:modelValue":t[3]||(t[3]=e=>H.value=e),onAddSuccess:Q},null,8,["modelValue"]),v(f(D),{modelValue:U.value,"onUpdate:modelValue":t[4]||(t[4]=e=>U.value=e),knowledge:z.value,onEditSuccess:ie},null,8,["modelValue","knowledge"])])}}}),[["__scopeId","data-v-6e5e5748"]]);const de={class:"hit-test-container"},ue={class:"hit-test-result"},ce={class:"table-wrapper"},pe={class:"outline-preview"},ve={class:"outline-full"},me={class:"text-chunk-full"},he={class:"header-with-tooltip"},ge={class:"header-with-tooltip"},fe={class:"text-chunk-preview"},be={class:"text-chunk-full"},_e={class:"hit-test-form"};var Ee=x(o({__name:"HitTest",setup(r){const o=n({text:"",topK:5}),s=n(),i=n(!1),b=n([]),w=e=>Number.isFinite(e)?e.toFixed(4):"-",k=async()=>{s.value&&await s.value.validate((async l=>{if(l)try{i.value=!0;const l=await(r=o.value.text,n=o.value.topK,e.get(`/v1${t}rest/${a}/knowledge/retrieve`,{params:{"query-text":r,"top-k":n}}));b.value=l.data?.data||[]}catch(s){}finally{i.value=!1}var r,n}))};let y=!0;const R=e=>{"Enter"!==e.key||e.shiftKey||(y=!0,e.preventDefault())},T=()=>{y=!1},x=()=>{y&&(y=!1,k())};return(e,t)=>{const a=d("loading");return u(),c("div",de,[p("div",ue,[p("div",ce,[_((u(),E(f(P),{ref:"tableRef",data:b.value,style:{width:"100%",height:"100%"},border:""},{default:m((()=>[v(f(C),{label:f(l)("kb.outline"),width:"300"},{default:m((e=>[v(f(S),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:m((()=>[p("div",pe,g(e.row.outline),1)])),default:m((()=>[p("div",ve,[p("div",me,g(e.row.outline),1)])])),_:2},1024)])),_:1},8,["label"]),v(f(C),{prop:"denseMetricType",label:f(l)("kb.knowledge.hit.test.dense.metric"),width:"170"},null,8,["label"]),v(f(C),{label:f(l)("kb.knowledge.hit.test.dense.score"),width:"170",formatter:e=>w(e.denseScore)},{header:m((()=>[p("div",he,[p("span",null,g(f(l)("kb.knowledge.hit.test.dense.score")),1),v(f(O),{effect:"dark",placement:"top","raw-content":!0,content:f(l)("kb.knowledge.hit.test.dense.score.tip")},{default:m((()=>[v(f(j),{class:"info-icon"},{default:m((()=>[v(f(z))])),_:1})])),_:1},8,["content"])])])),_:1},8,["label","formatter"]),v(f(C),{prop:"sparseMetricType",label:f(l)("kb.knowledge.hit.test.sparse.metric"),width:"170"},null,8,["label"]),v(f(C),{label:f(l)("kb.knowledge.hit.test.sparse.score"),width:"170",formatter:e=>w(e.sparseScore)},{header:m((()=>[p("div",ge,[p("span",null,g(f(l)("kb.knowledge.hit.test.sparse.score")),1),v(f(O),{effect:"dark",placement:"top","raw-content":!0,content:f(l)("kb.knowledge.hit.test.sparse.score.tip")},{default:m((()=>[v(f(j),{class:"info-icon"},{default:m((()=>[v(f(z))])),_:1})])),_:1},8,["content"])])])),_:1},8,["label","formatter"]),v(f(C),{label:f(l)("kb.knowledge.hit.test.hybrid.score"),width:"170",formatter:e=>w(e.hybridScore??e.score)},null,8,["label","formatter"]),v(f(C),{prop:"isFiltered",label:f(l)("kb.knowledge.hit.test.is.hit"),width:"150",formatter:e=>e.isFiltered?f(l)("common.no"):f(l)("common.yes")},null,8,["label","formatter"]),v(f(C),{label:f(l)("kb.textChunk"),width:"400"},{default:m((e=>[v(f(S),{effect:"dark",trigger:"hover",placement:"top",width:"400"},{reference:m((()=>[p("div",fe,g(e.row.textChunk),1)])),default:m((()=>[p("div",be,g(e.row.textChunk),1)])),_:2},1024)])),_:1},8,["label"]),v(f(C),{prop:"dimension",label:f(l)("kb.dimension"),width:"130"},null,8,["label"]),v(f(C),{prop:"embeddingModel",label:f(l)("kb.embeddingModel"),width:"150"},null,8,["label"]),v(f(C),{prop:"embeddingProvider",label:f(l)("kb.embeddingProvider"),width:"150"},null,8,["label"])])),_:1},8,["data"])),[[a,i.value]])])]),p("div",_e,[v(f(A),{ref_key:"formRef",ref:s,model:o.value,"label-width":"120px"},{default:m((()=>[v(f(N),{label:"TOP-K",prop:"topK",rules:[{required:!0,message:f(l)("common.input.required")}]},{default:m((()=>[v(f($),{class:"top-k-input",modelValue:o.value.topK,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value.topK=e),min:1,max:15,"controls-position":"right"},null,8,["modelValue"])])),_:1},8,["rules"]),v(f(N),{label:f(l)("kb.knowledge.hit.test.text"),prop:"text",class:"input-area",rules:[{required:!0,message:f(l)("common.input.required")}]},{default:m((()=>[v(f(V),{modelValue:o.value.text,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value.text=e),class:"text-input",placeholder:f(l)("kb.knowledge.hit.test.text.placeholder"),type:"textarea",autosize:{minRows:5,maxRows:10},maxlength:4e3,"show-word-limit":"",onKeydown:R,onInput:T,onKeyup:x},null,8,["modelValue","placeholder"]),v(f(I),{type:"primary",onClick:k},{default:m((()=>[...t[2]||(t[2]=[h("Êèê‰∫§",-1)])])),_:1})])),_:1},8,["label","rules"])])),_:1},8,["model"])])])}}}),[["__scopeId","data-v-5db4f1dd"]]);const we={class:"rag-settings-page"};var ke=x(o({__name:"RagSettings",setup(e){const t=n(!1),a=n(!1),r=n({topK:5,metricType:"COSINE",metricScoreExpr:"> 0.7",denseWeight:.5,sparseWeight:.5}),o=()=>{const e=r.value.denseWeight,t=r.value.sparseWeight,a=e+t;if(!Number.isFinite(a)||a<=0)return r.value.denseWeight=.5,void(r.value.sparseWeight=.5);r.value.denseWeight=e/a,r.value.sparseWeight=t/a},s=(e,t)=>{if(null==e)return t;const a=Number(e);return Number.isFinite(a)?a:t},p=async()=>{a.value=!0;try{o(),await q([{propertyName:"RETRIEVE_TOP_K",propertyValue:String(r.value.topK)},{propertyName:"RETRIEVE_METRIC_TYPE",propertyValue:r.value.metricType},{propertyName:"RETRIEVE_METRIC_SCORE_COMPARE_EXPR",propertyValue:r.value.metricScoreExpr},{propertyName:"RETRIEVE_DENSE_WEIGHT",propertyValue:String(r.value.denseWeight)},{propertyName:"RETRIEVE_SPARSE_WEIGHT",propertyValue:String(r.value.sparseWeight)}]),M.success(l("settings.save.success"))}catch(e){M.error(l("settings.save.failed"))}finally{a.value=!1}};return i((()=>{(async()=>{t.value=!0;try{const a=(e=await G(["RETRIEVE_TOP_K","RETRIEVE_METRIC_TYPE","RETRIEVE_METRIC_SCORE_COMPARE_EXPR","RETRIEVE_DENSE_WEIGHT","RETRIEVE_SPARSE_WEIGHT"]))?.data?.data?e.data.data:e?.data??{};r.value.topK=s("RETRIEVE_TOP_K"in a?a.RETRIEVE_TOP_K:void 0,r.value.topK),r.value.metricType=a.RETRIEVE_METRIC_TYPE||r.value.metricType,r.value.metricScoreExpr=a.RETRIEVE_METRIC_SCORE_COMPARE_EXPR||r.value.metricScoreExpr,r.value.denseWeight=s("RETRIEVE_DENSE_WEIGHT"in a?a.RETRIEVE_DENSE_WEIGHT:void 0,r.value.denseWeight),r.value.sparseWeight=s("RETRIEVE_SPARSE_WEIGHT"in a?a.RETRIEVE_SPARSE_WEIGHT:void 0,r.value.sparseWeight),o()}catch(a){M.error(l("settings.load.failed"))}finally{t.value=!1}var e})()})),(e,l)=>{const o=d("loading");return _((u(),c("div",we,[v(F,{form:r.value,saving:a.value,"show-title":"",onSave:p},null,8,["form","saving"])])),[[o,t.value]])}}}),[["__scopeId","data-v-e686ec30"]]);const ye={class:"layout-container"},Re={class:"content-wrapper"},Te={class:"main-content"},xe={class:"content-area"},Ie={key:1,class:"placeholder"};var Ve=x(o({__name:"index",setup(e){const t=n(!1),a=n("1"),r=R(ie),o=(e,t)=>{},s=(e,t)=>{},i=(e,t)=>{switch(a.value=e,e){default:r.value=ie;break;case"2":r.value=Ee;break;case"3":r.value=ke}};return(e,n)=>(u(),c("div",ye,[v(U),p("div",Re,[v(f(H),{"default-active":a.value,class:"el-menu-vertical-demo",collapse:t.value,onOpen:o,onClose:s,onSelect:i},{default:m((()=>[v(f(D),{index:"1"},{default:m((()=>[h(g(f(l)("kb.knowledge.list")),1)])),_:1}),v(f(D),{index:"2"},{default:m((()=>[h(g(f(l)("kb.knowledge.hit.test")),1)])),_:1}),v(f(D),{index:"3"},{default:m((()=>[h(g(f(l)("settings.rag.section")),1)])),_:1})])),_:1},8,["default-active","collapse"]),p("main",Te,[p("div",xe,[r.value?(u(),E(T(r.value),{key:0})):(u(),c("div",Ie,[...n[0]||(n[0]=[p("p",null,"ËØ∑ÈÄâÊã©‰∏Ä‰∏™ËèúÂçïÈ°π",-1)])]))])])])]))}}),[["__scopeId","data-v-e012f15a"]]),Ce=Object.freeze(Object.defineProperty({__proto__:null,default:Ve},Symbol.toStringTag,{value:"Module"}));export{Ce as a,L as d,Q as i,Y as p};
